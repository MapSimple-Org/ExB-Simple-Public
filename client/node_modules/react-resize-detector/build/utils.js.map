{"version":3,"file":"utils.js","sources":["../src/utils.ts"],"sourcesContent":["import * as React from 'react';\nimport debounce from 'lodash/debounce.js';\nimport throttle from 'lodash/throttle.js';\nimport type { DebouncedFunc } from 'lodash';\n\nimport { OnRefChangeType, Props } from './types.js';\n\nexport type PatchedResizeObserverCallback = DebouncedFunc<ResizeObserverCallback> | ResizeObserverCallback;\n\n/**\n * Wraps the resize callback with a lodash debounce / throttle based on the refresh mode\n */\nexport const patchResizeCallback = (\n  resizeCallback: ResizeObserverCallback,\n  refreshMode: Props['refreshMode'],\n  refreshRate: Props['refreshRate'],\n  refreshOptions: Props['refreshOptions'],\n): PatchedResizeObserverCallback => {\n  switch (refreshMode) {\n    case 'debounce':\n      return debounce(resizeCallback, refreshRate, refreshOptions);\n    case 'throttle':\n      return throttle(resizeCallback, refreshRate, refreshOptions);\n    default:\n      return resizeCallback;\n  }\n};\n\n/**\n * A custom hook that converts a callback to a ref to avoid triggering re-renders when passed as a\n * prop or avoid re-executing effects when passed as a dependency\n */\nexport const useCallbackRef =\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  <T extends (...args: any[]) => any>(callback: T | undefined): T => {\n    const callbackRef = React.useRef(callback);\n\n    React.useEffect(() => {\n      callbackRef.current = callback;\n    });\n\n    return React.useMemo(() => ((...args) => callbackRef.current?.(...args)) as T, []);\n  };\n\n/** `useRef` hook doesn't handle conditional rendering or dynamic ref changes.\n * This hook creates a proxy that ensures that `refElement` is updated whenever the ref is changed. */\nexport const useRefProxy =\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  <T extends HTMLElement = any>(targetRef: React.MutableRefObject<T | null> | undefined) => {\n    // we are going to use this ref to store the last element that was passed to the hook\n    const [refElement, setRefElement] = React.useState<T | null>(targetRef?.current || null);\n\n    // if targetRef is passed, we need to update the refElement\n    // we have to use setTimeout because ref get assigned after the hook is called\n    // in the future releases we are going to remove targetRef and force users to use ref returned by the hook\n    if (targetRef) {\n      setTimeout(() => {\n        if (targetRef.current !== refElement) {\n          setRefElement(targetRef.current);\n        }\n      }, 0);\n    }\n\n    // this is a memo that will be called every time the ref is changed\n    // This proxy will properly call setState either when the ref is called as a function or when `.current` is set\n    // we call setState inside to trigger rerender\n    const refProxy: OnRefChangeType<T> = React.useMemo(\n      () =>\n        new Proxy(\n          (node) => {\n            if (node !== refElement) {\n              setRefElement(node);\n            }\n          },\n          {\n            get(target, prop) {\n              if (prop === 'current') {\n                return refElement;\n              }\n              return target[prop];\n            },\n            set(target, prop, value) {\n              if (prop === 'current') {\n                setRefElement(value);\n              } else {\n                target[prop] = value;\n              }\n              return true;\n            },\n          },\n        ),\n      [refElement],\n    );\n\n    return { refProxy, refElement, setRefElement };\n  };\n\n/** Calculates the dimensions of the element based on the current box model.\n * @see https://developer.mozilla.org/en-US/docs/Learn/CSS/Building_blocks/The_box_model\n */\nexport const getDimensions = (entry: ResizeObserverEntry, box: ResizeObserverBoxOptions | undefined) => {\n  // Value\t          Border\t  Padding\t  Inner Content\n  // ---------------------------------------------------\n  // 'border-box'\t    Yes\t      Yes\t      Yes\n  // 'content-box'\t  No\t      No\t      Yes\n  //  undefined       No\t      No?\t      Yes\n\n  const borderBox = entry.borderBoxSize?.[0];\n  const contentBox = entry.contentBoxSize?.[0];\n\n  if (box === 'border-box' && borderBox) {\n    return {\n      width: borderBox.inlineSize,\n      height: borderBox.blockSize,\n    };\n  }\n\n  if (box === 'content-box' && contentBox) {\n    return {\n      width: contentBox.inlineSize,\n      height: contentBox.blockSize,\n    };\n  }\n\n  return {\n    width: entry.contentRect.width,\n    height: entry.contentRect.height,\n  };\n};\n"],"names":[],"mappings":"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"}