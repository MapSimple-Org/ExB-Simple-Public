/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
v4.34.3 */
import{a as u}from"./ZTJVS6I7.js";import a from"./O7NRKSDP.js";import{a as l,b as p}from"./M7RWCXDB.js";export default $arcgis.t(([{forceInteractive:m},g,{property:n,subclass:f},{ignoreAbortErrors:A},{when:O,watch:v,on:b,whenOnce:U},{a:_,b:w,c:d,d:y}])=>{var F=Object.defineProperty,T=Object.getOwnPropertyDescriptor,i=(t,s,a,r)=>{for(var o=r>1?void 0:r?T(s,a):s,c=t.length-1,h;c>=0;c--)(h=t[c])&&(o=(r?h(s,a,o):h(o))||o);return r&&o&&F(s,a,o),o},e=class extends g{constructor(){super({}),this.shouldForceInteractive=!0,this._ownsAnalysis=!1,this._operationState="inactive",this._loggedUnsupportedErrorMessage=!1,this._changeFromReconnect=!1,this._startUserOperation=null}initialize(){this._set("analysis",this.constructAnalysis()),this._ownsAnalysis=!0;let t=()=>{!this._changeFromReconnect&&!this._viewHasAnalysis&&(this._ownsAnalysis=!1);let s=!this._changeFromReconnect;this._changeFromReconnect=!1,s&&this._scheduleViewReconnect()};this.addHandles([O(()=>this.view?.ready&&!this.supported,()=>{this._loggedUnsupportedErrorMessage||console.error(this.unsupportedErrorMessage)},{sync:!0,initial:!0}),v(()=>[this.analysis,this._viewHasAnalysis],t,{sync:!0}),b(()=>this.view,"analysis-view-destroy",s=>{s.analysis===this.analysis&&t()}),v(()=>({view:this.view,ready:!!this.view?.ready,supported:this.supported}),({view:s},a)=>{let r=a?.view;s!==r&&(this._startUserOperation=l(this._startUserOperation),this._disconnectFromView(r)),this._scheduleViewReconnect()},{sync:!0,initial:!0})])}destroy(){this._reconnectViewTask=l(this._reconnectViewTask),this._startUserOperation=l(this._startUserOperation),this._analysisView!=null&&(this._analysisView.visible=void 0),this._disconnectFromView(this.view),this._set("view",null),this._ownsAnalysis&&this.analysis?.destroy()}get supported(){return this.view==null||this.supportedViewType==="both"||this.view.type===this.supportedViewType}set visible(t){this._set("visible",t),this._analysisView!=null&&(this._analysisView.visible=t)}get active(){return this._startUserOperation?.state===2}get disabled(){return!this.view?.ready||!this.supported}set analysis(t){t!==this._get("analysis")&&(this._startUserOperation=l(this._startUserOperation),this._disconnectFromView(this.view),this._setExternalAnalysis(t),this._scheduleViewReconnect())}get analysisView(){return this._analysisView}get ready(){return this._analysisView!=null&&!this.connectingToView}get connectingToView(){return this._reconnectViewTask!=null}get _viewHasAnalysis(){let{view:t}=this;return t?.analyses.includes(this.analysis)===!0}get operationState(){return this._operationState}clear(){this.clearAnalysis(),this._startUserOperation=l(this._startUserOperation)}async start(t){if(!this.visible){console.warn("Cannot start analysis when not visible");return}t?.clear!==!1&&this.clear();let s={task:null,abort:null,state:0},a=y(async r=>{if(s.state=1,await U(()=>this.ready,r),s.state=2,this._analysisView==null||this.view==null)return;this._operationState="active";let o=t?.operation?.({signal:r})??this.place({signal:r});await A(o)});return a.promise.finally(()=>{(this._startUserOperation===s||this._startUserOperation==null)&&(this._operationState="inactive")}),s.task=a,s.abort=()=>a.abort(),this._startUserOperation=s,await a.promise}stop(){this._startUserOperation=l(this._startUserOperation)}onConnectToAnalysisView(t){}onDisconnectFromAnalysisView(){}_scheduleViewReconnect(){this._reconnectViewTask=l(this._reconnectViewTask);let t=y(async s=>{try{await this._reconnectView(s)}catch(a){if(_(s),!d(a)){console.warn("Failed to use analysis in view model",a);return}throw a}finally{t===this._reconnectViewTask&&(this._reconnectViewTask=void 0)}});this._reconnectViewTask=t}async _reconnectView(t){let{view:s}=this,a=s?.ready&&this.supported,r=this.analysis;if(this._startUserOperation=V(this._startUserOperation),this._disconnectFromView(s),!a||s==null||r==null)return;this._ownsAnalysis&&(this._changeFromReconnect=!0,s.analyses.add(r));let o=await s.whenAnalysisView(r);if(this._analysisView=o,w(t)){this._startUserOperation=V(this._startUserOperation);return}o.visible=this.visible,this._forceInteractiveHandle=this.shouldForceInteractive?m(o):u(),this.addHandles(this._forceInteractiveHandle),this.onConnectToAnalysisView(o)}_disconnectFromView(t){t!=null&&this._ownsAnalysis&&t.analyses.includes(this.analysis)&&(this._changeFromReconnect=!0,this.analysis.clear(),t.analyses.remove(this.analysis)),this.onDisconnectFromAnalysisView(),this._forceInteractiveHandle=p(this._forceInteractiveHandle),this._analysisView=void 0}_setExternalAnalysis(t){this._analysisView!=null&&!this._ownsAnalysis&&(this._analysisView.visible=void 0,this._forceInteractiveHandle=p(this._forceInteractiveHandle)),this._analysisView=void 0,this._ownsAnalysis=!1,this._set("analysis",t),this._changeFromReconnect=!1}};i([n()],e.prototype,"supported",1);i([n()],e.prototype,"view",2);i([n({type:Boolean,value:!0})],e.prototype,"visible",1);i([n()],e.prototype,"active",1);i([n()],e.prototype,"disabled",1);i([n()],e.prototype,"analysis",1);i([n()],e.prototype,"_analysisView",2);i([n()],e.prototype,"shouldForceInteractive",2);i([n()],e.prototype,"analysisView",1);i([n()],e.prototype,"ready",1);i([n()],e.prototype,"connectingToView",1);i([n()],e.prototype,"_ownsAnalysis",2);i([n()],e.prototype,"_viewHasAnalysis",1);i([n()],e.prototype,"_reconnectViewTask",2);i([n()],e.prototype,"_forceInteractiveHandle",2);i([n()],e.prototype,"_operationState",2);i([n()],e.prototype,"operationState",1);e=i([f("esri.components.support.AnalysisViewModel")],e);function V(t){return t!=null&&t.state>=2?(t.abort(),null):t}return e},"applications/Components/analysisUtils","core/Accessor","core/accessorSupport/decorators","core/promiseUtils","core/reactiveUtils",a)