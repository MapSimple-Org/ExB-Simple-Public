/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
v4.34.3 */
import b from"./Q3DJ5IR7.js";import a from"./O7NRKSDP.js";import{a as T}from"./M7RWCXDB.js";import{J as C,K as k,P as M,a as A,b as m}from"./U4NXTENC.js";import"./7V34NQ5V.js";export default $arcgis.t(([{watch:K,when:Q},X,Y,Z,{compileExpression:ee},{a:x,d:j},{q:J}])=>{var te=typeof global=="object"&&global&&global.Object===Object&&global,ie=typeof self=="object"&&self&&self.Object===Object&&self,U=te||ie||Function("return this")(),b=U.Symbol,q=Object.prototype,ne=q.hasOwnProperty,ae=q.toString,y=b?b.toStringTag:void 0;function re(e){var t=ne.call(e,y),n=e[y];try{e[y]=void 0;var i=!0}catch{}var a=ae.call(e);return i&&(t?e[y]=n:delete e[y]),a}var se=Object.prototype,oe=se.toString;function le(e){return oe.call(e)}var ce="[object Null]",ue="[object Undefined]",N=b?b.toStringTag:void 0;function fe(e){return e==null?e===void 0?ue:ce:N&&N in Object(e)?re(e):le(e)}function pe(e){return e!=null&&typeof e=="object"}var de="[object Symbol]";function he(e){return typeof e=="symbol"||pe(e)&&fe(e)==de}var me=/\s/;function ve(e){for(var t=e.length;t--&&me.test(e.charAt(t)););return t}var ge=/^\s+/;function ye(e){return e&&e.slice(0,ve(e)+1).replace(ge,"")}function $(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var R=NaN,_e=/^[-+]0x[0-9a-f]+$/i,Te=/^0b[01]+$/i,xe=/^0o[0-7]+$/i,be=parseInt;function W(e){if(typeof e=="number")return e;if(he(e))return R;if($(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=$(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=ye(e);var n=Te.test(e);return n||xe.test(e)?be(e.slice(2),n?2:8):_e.test(e)?R:+e}var I=function(){return U.Date.now()},$e="Expected a function",we=Math.max,ke=Math.min;function je(e,t,n){var i,a,o,l,r,c,f=0,v=!1,p=!1,h=!0;if(typeof e!="function")throw new TypeError($e);t=W(t)||0,$(n)&&(v=!!n.leading,p="maxWait"in n,o=p?we(W(n.maxWait)||0,t):o,h="trailing"in n?!!n.trailing:h);function u(s){var d=i,g=a;return i=a=void 0,f=s,l=e.apply(g,d),l}function z(s){return f=s,r=setTimeout(_,t),v?u(s):l}function B(s){var d=s-c,g=s-f,L=t-d;return p?ke(L,o-g):L}function S(s){var d=s-c,g=s-f;return c===void 0||d>=t||d<0||p&&g>=o}function _(){var s=I();if(S(s))return E(s);r=setTimeout(_,B(s))}function E(s){return r=void 0,h&&i?u(s):(i=a=void 0,l)}function G(){r!==void 0&&clearTimeout(r),f=0,i=c=a=r=void 0}function H(){return r===void 0?l:E(I())}function w(){var s=I(),d=S(s);if(i=arguments,a=this,c=s,d){if(r===void 0)return z(c);if(p)return clearTimeout(r),r=setTimeout(_,t),u(c)}return r===void 0&&(r=setTimeout(_,t)),l}return w.cancel=G,w.flush=H,w}var Ie="Expected a function";function F(e,t,n){var i=!0,a=!0;if(typeof e!="function")throw new TypeError(Ie);return $(n)&&(i="leading"in n?!!n.leading:i,a="trailing"in n?!!n.trailing:a),je(e,t,{leading:i,maxWait:t,trailing:a})}var Oe=A`.arcgis-feature-expression__loading-container{display:flex;justify-content:center;padding:var(--calcite-spacing-md) 0;width:100%}`,V=1,D="arcgis-feature",P={base:`${D}-expression`,loadingSpinnerContainer:`${D}__loading-container`},O=class extends C{constructor(){super(...arguments),this._compileThrottled=F(this._startCompile,V),this._evaluateThrottled=F(this._startEvaluate,V),this.headingLevel=2}static{this.properties={_compileTask:16,_evaluateTask:16,values:0,fieldInfoMap:0,expressionInfo:0,graphic:0,headingLevel:9,interceptor:0,location:0,messages:0,spatialReference:0,map:0,view:0}}static{this.styles=Oe}loaded(){this.manager.onLifecycle(()=>[K(()=>[this.expressionInfo,this.graphic],()=>this._compileThrottled(),{initial:!0}),Q(()=>{if(!this._compileTask?.finished)return null;let t=this._compileTask.value,n=t?.dependencies,{view:i}=this;return[t,this.spatialReference,this.map,i,n?.has("view-scale")&&i&&"scale"in i?i.scale:null,n?.has("view-time-extent")?i?.timeExtent?.start:null,n?.has("view-time-extent")?i?.timeExtent?.end:null]},([t])=>this._evaluateThrottled(t)),{remove:()=>this._cancelThrottles()}])}_cancelThrottles(){this._compileThrottled.cancel(),this._evaluateThrottled.cancel()}_startCompile(){this._evaluateTask=T(this._evaluateTask),this._compileTask=T(this._compileTask),this._compileTask=j(async t=>{let{expressionInfo:n,graphic:i}=this,a=n?.expression;if(!a||!i)return null;let o=await ee({expression:a,graphic:i});return x(t),o})}_startEvaluate(t){this._evaluateTask=T(this._evaluateTask),this._evaluateTask=j(async n=>{let{graphic:i}=this;if(!t||!i)return null;let{interceptor:a,spatialReference:o,map:l,location:r,view:c}=this,f=await t.evaluate({graphic:i,interceptor:a,location:r,map:l,options:{signal:n},spatialReference:o,view:c});x(n);let v=f&&"castAsJsonAsync"in f&&typeof f.castAsJsonAsync=="function"?f:null;if(!v)return null;let p=await v.castAsJsonAsync(n);x(n);let h=p?.type,u=h==="media"?X.fromJSON(p):h==="text"?Z.fromJSON(p):h==="fields"?Y.fromJSON(p):null;return!u||u.type==="media"&&!u.mediaInfos||u.type==="fields"&&!u.fieldInfos||u.type==="text"&&!u.text?null:u})}render(){let t=!this._compileTask?.finished||!this._evaluateTask?.finished;return m`<div class=${k(P.base)}>${t?this._renderLoading():this._evaluateTask?.value?this._renderContent():null}</div>`}_renderContent(){let{values:t,fieldInfoMap:n}=this,i=this._evaluateTask?.value,a=i?.type;if(!a)return null;if(a==="text"){let o=J({values:t,fieldInfoMap:n??new Map,globalValues:t??{},layer:void 0,text:i.text});return m`<arcgis-feature-content .creator=${o} .graphic=${this.graphic}></arcgis-feature-content>`}else if(a==="media"){let{title:o,description:l,mediaInfos:r}=i;if(!r?.length)return null;let c={...t,...i.attributes};return m`<arcgis-feature-media .heading=${o??""} .values=${c} .formattedValues=${c} .description=${l??""} .mediaInfos=${r} .messages=${this.messages} .headingLevel=${this.headingLevel}></arcgis-feature-media>`}else if(a==="fields"){let{title:o,description:l,fieldInfos:r}=i;return r?.length?m`<arcgis-feature-fields .fieldInfos=${r} .heading=${o??""} .description=${l??""} .headingLevel=${this.headingLevel} .messages=${this.messages}></arcgis-feature-fields>`:null}return null}_renderLoading(){return m`<div class=${k(P.loadingSpinnerContainer)}><calcite-loader inline label></calcite-loader></div>`}};M("arcgis-feature-expression",O);return O},"core/reactiveUtils","popup/content/MediaContent","popup/content/FieldsContent","popup/content/TextContent","applications/Components/arcadeFeatureUtils",a,b)