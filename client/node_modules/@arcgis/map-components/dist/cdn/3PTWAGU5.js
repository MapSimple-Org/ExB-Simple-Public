/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
v4.34.3 */
import a from"./Q3DJ5IR7.js";import{a as W}from"./NZ53PAWS.js";import{d as G,e as K}from"./MGF5CCZW.js";import{e as O}from"./TC4TLAIC.js";import{I as H,J as j,K as y,M as b,P as D,a as B,b as C}from"./U4NXTENC.js";import"./7V34NQ5V.js";export default $arcgis.t(([{getColorsFromRenderer:se},{substitute:oe},{watch:le},de,ee,{renderingSanitizer:te},{f:$,g:q,h:F,i:J,j:Q,k:Z,m:z,o:N,p:P,q:L}])=>{var ce=B`.arcgis-feature-media__container{display:flex;flex-flow:row wrap;align-items:center;margin-top:var(--calcite-spacing-xs);width:100%;min-height:150px}.arcgis-feature-media__container .arcgis-feature-media__pagination-button{display:flex;align-items:center;justify-content:center;border:none;background:transparent;cursor:pointer;padding-block:var(--calcite-spacing-xs);padding-inline:var(--calcite-spacing-xs);color:var(--calcite-color-text-3)}.arcgis-feature-media__container .arcgis-feature-media__pagination-button:hover,.arcgis-feature-media__container .arcgis-feature-media__pagination-button:focus{background-color:var(--calcite-color-foreground-3);color:var(--calcite-color-text-1);fill:var(--calcite-color-text-1)}.arcgis-feature-media__item-title{margin:0;font-size:var(--calcite-font-size-md);line-height:var(--calcite-font-line-height-relative-snug)}.arcgis-feature-media__item-caption{padding-block-start:var(--calcite-spacing-xxs);font-size:var(--calcite-font-size-sm);line-height:var(--calcite-font-line-height-relative-snug)}.arcgis-feature-media__item{display:flex;align-items:flex-start;justify-content:center;margin-block:var(--calcite-spacing-xs);width:100%;height:auto}.arcgis-feature-media__item-navigation{display:flex;flex:0 1 100%;align-items:flex-start;justify-content:space-between;margin-block-end:var(--calcite-spacing-xs)}.arcgis-feature-media__item-text{margin-inline-end:var(--calcite-spacing-xs)}.arcgis-feature-media__pagination{display:flex;flex:0 0 auto;align-items:center;overflow:hidden}.arcgis-feature-media__pagination:only-child{margin-inline-start:auto}.arcgis-feature-media__pagination-text{padding-inline:var(--calcite-spacing-xxs);color:var(--calcite-color-text-3);font-size:var(--calcite-font-size-sm);line-height:var(--calcite-font-line-height-relative-normal)}.arcgis-feature-media__item-container{flex:0 1 auto;width:100%}.arcgis-feature-media__item-container img{max-width:100%}.arcgis-feature-media__item-container img[src$=".SVG"],.arcgis-feature-media__item-container img[src$=".svg"]{width:100%}.arcgis-feature-media__chart{width:100%;height:155px}`;function X(V){if(!$(V))return null;let[e,t]=V.split("/").slice(1);return{layerId:e,fieldName:t}}var M="arcgis-feature-media",v={base:M,mediaContainer:`${M}__container`,mediaItemContainer:`${M}__item-container`,mediaItem:`${M}__item`,mediaItemText:`${M}__item-text`,mediaItemTitle:`${M}__item-title`,mediaItemCaption:`${M}__item-caption`,mediaNavigation:`${M}__item-navigation`,mediaPagination:`${M}__pagination`,mediaPaginationText:`${M}__pagination-text`,mediaChart:`${M}__chart`,mediaPaginationButton:`${M}__pagination-button`,mediaPaginationIcon:`${M}__pagination-icon`,mediaChartRendered:`${M}__chart--rendered`},Y=15,w="category",T="value",me="rgba(50, 50, 50, 1)",he=250,ue=500,fe=200,E=class extends j{constructor(){super(...arguments),this._direction=K(),this._prefersReducedMotion=G("(prefers-reduced-motion)"),this.activeMediaInfoIndex=0,this.chartAnimationDisabled=!1,this.headingLevel=2}static{this.properties={_refreshIntervalInfo:16,messages:0,values:0,activeMediaInfoIndex:9,chartAnimationDisabled:5,activeMediaInfo:32,formattedMediaInfos:32,description:1,fieldInfoMap:0,layer:0,mediaInfos:0,popupTemplate:0,relatedInfos:0,formattedValues:0,heading:1,graphic:0,formattedMediaInfoCount:32,headingLevel:9}}static{this.styles=ce}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}setActiveMedia(e){this._setContentElementMedia(e)}loaded(){this.manager.onLifecycle(()=>[le(()=>[this.activeMediaInfo,this.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),{initial:!0}),{remove:()=>this._clearMediaRefreshTimer()}])}_setContentElementMedia(e){let{formattedMediaInfoCount:t}=this,a=(e+t)%t;this.activeMediaInfoIndex=a}_pageContentElementMedia(e){let{activeMediaInfoIndex:t}=this,a=t+e;this._setContentElementMedia(a)}_formatMediaInfos(){let{mediaInfos:e,layer:t}=this,a=this.values??{},i=this.formattedValues??{},r=this.fieldInfoMap??new Map;return e?.map(s=>{let n=s?.clone();if(!n)return null;if(n.title=L({values:a,fieldInfoMap:r,globalValues:i,layer:t,text:n.title}),n.caption=L({values:a,fieldInfoMap:r,globalValues:i,layer:t,text:n.caption}),n.altText=L({values:a,fieldInfoMap:r,globalValues:i,layer:t,text:n.altText}),n.type==="image"){if(!n.value)return null;let o=n.value;return this._setImageValue({value:o,formattedValues:i,layer:t}),o.sourceURL?n:void 0}if(n.type==="pie-chart"||n.type==="line-chart"||n.type==="column-chart"||n.type==="bar-chart"){if(!n.value)return null;let o=n.value;return this._setChartValue({value:o,chartType:n.type,values:a,formattedValues:i,layer:t}),n}return null}).filter(s=>s!=null)??[]}_setImageValue(e){let t=this.fieldInfoMap??new Map,{value:a,formattedValues:i,layer:r}=e,{linkURL:s,sourceURL:n}=a;if(n){let o=P(n,r);a.sourceURL=N({formattedValues:i,template:o,fieldInfoMap:t})}if(s){let o=P(s,r);a.linkURL=N({formattedValues:i,template:o,fieldInfoMap:t})}}_setChartValue(e){let{value:t,values:a,formattedValues:i,chartType:r,layer:s}=e,{popupTemplate:n,relatedInfos:o}=this,{fields:d,normalizeField:g}=t,m=s;if(t.fields=J(d,m),g&&(t.normalizeField=F(g,m)),!d.some(c=>!!(i[c]!=null||$(c)&&o?.size)))return;let l=n?.fieldInfos??[];t.series=[],d.forEach((c,u)=>{let h=t.colors?.[u];if($(c)){t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:l,fieldName:c,formattedValues:i,chartType:r,value:t,color:h})];return}let f=this._getChartOption({value:t,values:a,chartType:r,formattedValues:i,fieldName:c,fieldInfos:l,color:h});t.series.push(f)})}_getRelatedChartInfos(e){let{fieldInfos:t,fieldName:a,formattedValues:i,chartType:r,value:s,color:n}=e,o=[],d=X(a),g=d&&this.relatedInfos?.get(d.layerId);if(!g)return o;let{relatedFeatures:m,relation:l}=g;if(!l||!m)return o;let{cardinality:c}=l;return m.forEach(u=>{let h=u.attributes;h&&Object.keys(h).forEach(f=>{f===d.fieldName&&o.push(this._getChartOption({value:s,values:h,formattedValues:i,fieldName:a,chartType:r,relatedFieldName:f,hasMultipleRelatedFeatures:m?.length>1,fieldInfos:t,color:n}))})}),c&&(c==="one-to-many"||c==="many-to-many")?o:[o[0]]}_getTooltip({label:e,value:t,chartType:a}){return a==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){let{value:t,values:a,formattedValues:i,fieldName:r,relatedFieldName:s,fieldInfos:n,chartType:o,hasMultipleRelatedFeatures:d,color:g}=e,{layer:m,graphic:l}=this,c=this.fieldInfoMap??new Map,{normalizeField:u,tooltipField:h}=t,f=u?$(u)?a[X(u).fieldName]:a[u]:null,_=Q(r)&&i?.[r]!==void 0?i[r]:s&&a[s]!==void 0?a[s]:a[r]!==void 0?a[r]:i[r],I=_===void 0?null:_&&f&&typeof _=="number"&&typeof f=="number"?_/f:_,x=Z(n,r),p=F(r,m),A=(h&&i[h]!==void 0?i[h]:z({fieldInfo:x||new de({fieldName:p}),expressionInfos:this.popupTemplate?.expressionInfos,graphic:l,layer:m}))??"",R=i[p]??"",U=I!=null?typeof I=="number"?I:Number(I):null;if($(r)){let S=c.get(r.toLowerCase()),ae=h?c.get(h.toLowerCase()):null,ie=S?.fieldName??r,k=d&&h?X(h).fieldName:ae?.fieldName??h,re=(d&&k?a[k]:i[k]??(S&&z({fieldInfo:S,layer:m,graphic:l}))??S?.fieldName??s)??"",ne=(d&&s?a[s]:i[ie])??"";return new ee({fieldName:r,tooltip:this._getTooltip({label:re,value:ne,chartType:o}),color:g,value:U})}return new ee({fieldName:r,tooltip:this._getTooltip({label:A,value:R,chartType:o}),color:g,value:U})}_getRenderer(){let e=this.layer;return this.graphic?.isAggregate&&e?.featureReduction&&"renderer"in e.featureReduction?e.featureReduction.renderer:e?.renderer}async _getSeriesColors(e){let{color:t}=await import("./CSQV2J3P.js"),a=new Map;return e.forEach(i=>{i.color&&a.set(i,t(i.color.toCss(!0)))}),a}async _getRendererColors(){let{color:e}=await import("./CSQV2J3P.js"),t=new Map,a=this._getRenderer(),i="default";if(!a)return t;let r=await se(a);return r.delete(i),Array.from(r.values()).every(s=>s?.length===1)&&Array.from(r.keys()).forEach(s=>{let n=r.get(s)?.[0]?.toCss(!0);n&&t.set(s,e(n))}),t}async _createChart(e){let{activeMediaInfo:t}=this;if(!e||!t)return;let{createRoot:a}=await import("./6RNIAMXK.js").then(m=>m.default.then(e=>({createRoot:e}))),i=await a(e);this._chartRoot=i,this._renderChart({mediaInfo:t,root:i})}_handleMediaKeyup(e){let{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.next())}_canAnimateChart(){return!this.chartAnimationDisabled&&!this._prefersReducedMotion}_getChartAnimationMS(){return this._canAnimateChart()?he:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?ue:0}async _customizeChartTooltip(e,t="horizontal"){let{color:a}=await import("./CSQV2J3P.js");e.setAll({pointerOrientation:t}),e.get("background")?.setAll({stroke:a(me)}),e.label.setAll({direction:this._direction,oversizedBehavior:"wrap",maxWidth:fe})}async _createPieChart(e,t){let[{Tooltip:a},{PieChart:i,PieSeries:r}]=await Promise.all([import("./CSQV2J3P.js"),import("./UVMFC32N.js")]),{mediaInfo:s,root:n}=e,{title:o}=s,d=5,g=s?.altText||s?.title||"",m=n.container.children.push(i.new(n,{role:"figure",ariaLabel:g,focusable:!0,paddingBottom:d,paddingTop:d,paddingLeft:d,paddingRight:d})),l=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,c=a.new(n,{labelText:l}),u=m.series.push(r.new(n,{name:o,valueField:T,categoryField:w,tooltip:c}));u.ticks.template.set("forceHidden",!0),u.labels.template.set("forceHidden",!0),u.slices.template.states.create("active",{shiftRadius:d}),this._customizeChartTooltip(c),u.slices.template.setAll({ariaLabel:l,focusable:!0,templateField:"columnSettings"}),u.data.setAll(t),u.appear(this._getChartSeriesAnimationMS()),m.appear(this._getChartAnimationMS()),m.root.dom.classList.toggle(v.mediaChartRendered,!0)}_getMinSeriesValue(e){let t=0;return e.forEach(a=>t=Math.min(a.value,t)),t}async _createColumnChart(e,t,a){let[{Tooltip:i,Scrollbar:r},{CategoryAxis:s,AxisRendererX:n,AxisRendererY:o,ValueAxis:d,ColumnSeries:g}]=await Promise.all([import("./CSQV2J3P.js"),import("./Z6LTG3WZ.js")]),{mediaInfo:m,root:l}=t,{value:c,title:u}=m,{_direction:h}=this;e.setAll({wheelX:"panX",wheelY:"zoomX"});let f=e.xAxes.push(s.new(l,{renderer:n.new(l,{inversed:h==="rtl"}),categoryField:w}));f.get("renderer").labels.template.setAll({forceHidden:!0});let _=e.yAxes.push(d.new(l,{renderer:o.new(l,{inside:!1}),min:this._getMinSeriesValue(c.series)}));_.get("renderer").labels.template.setAll({direction:h});let I="{categoryX}",x=i.new(l,{labelText:I}),p=e.series.push(g.new(l,{name:u,xAxis:f,yAxis:_,valueYField:T,categoryXField:w,tooltip:x}));this._customizeChartTooltip(x),p.columns.template.setAll({ariaLabel:I,focusable:!0,templateField:"columnSettings"}),c.series.length>Y&&e.set("scrollbarX",r.new(l,{orientation:"horizontal"})),f.data.setAll(a),p.data.setAll(a),p.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createBarChart(e,t,a){let[{Tooltip:i,Scrollbar:r},{CategoryAxis:s,AxisRendererX:n,AxisRendererY:o,ValueAxis:d,ColumnSeries:g}]=await Promise.all([import("./CSQV2J3P.js"),import("./Z6LTG3WZ.js")]),{mediaInfo:m,root:l}=t,{value:c,title:u}=m,{_direction:h}=this;e.setAll({wheelX:"panY",wheelY:"zoomY"});let f=e.yAxes.push(s.new(l,{renderer:o.new(l,{inversed:!0}),categoryField:w}));f.get("renderer").labels.template.setAll({forceHidden:!0});let _=e.xAxes.push(d.new(l,{renderer:n.new(l,{inside:!1,inversed:h==="rtl"}),min:this._getMinSeriesValue(c.series)}));_.get("renderer").labels.template.setAll({direction:h});let I="{categoryY}",x=i.new(l,{labelText:I}),p=e.series.push(g.new(l,{name:u,xAxis:_,yAxis:f,valueXField:T,categoryYField:w,tooltip:x}));this._customizeChartTooltip(x,"vertical"),p.columns.template.setAll({ariaLabel:I,focusable:!0,templateField:"columnSettings"}),c.series.length>Y&&e.set("scrollbarY",r.new(l,{orientation:"vertical"})),f.data.setAll(a),p.data.setAll(a),p.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createLineChart(e,t,a){let[{Tooltip:i,Scrollbar:r},{CategoryAxis:s,AxisRendererX:n,AxisRendererY:o,ValueAxis:d,LineSeries:g}]=await Promise.all([import("./CSQV2J3P.js"),import("./Z6LTG3WZ.js")]),{root:m,mediaInfo:l}=t,{value:c,title:u}=l,{_direction:h}=this;e.setAll({wheelX:"panX",wheelY:"zoomX"});let f=e.xAxes.push(s.new(m,{renderer:n.new(m,{inversed:h==="rtl"}),categoryField:w}));f.get("renderer").labels.template.setAll({forceHidden:!0});let _=e.yAxes.push(d.new(m,{renderer:o.new(m,{inside:!1}),min:this._getMinSeriesValue(c.series)}));_.get("renderer").labels.template.setAll({direction:h});let I="{categoryX}",x=a[0]?.lineSettings?.stroke,p=i.new(m,{getFillFromSprite:!x,labelText:I});x&&p.get("background")?.setAll({fill:x});let A=e.series.push(g.new(m,{name:u,xAxis:f,yAxis:_,valueYField:T,categoryXField:w,tooltip:p}));A.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(p,"vertical"),c.series.length>Y&&e.set("scrollbarX",r.new(m,{orientation:"horizontal"})),f.data.setAll(a),A.data.setAll(a),A.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createXYChart(e,t){let{XYChart:a,XYCursor:i}=await import("./Z6LTG3WZ.js"),{root:r,mediaInfo:s}=e,{type:n}=s,o=s?.altText||s?.title||"",d=r.container.children.push(a.new(r,{role:"figure",ariaLabel:o,focusable:!0,panX:!0,panY:!0}));d.set("cursor",i.new(r,{})),n==="column-chart"&&await this._createColumnChart(d,e,t),n==="bar-chart"&&await this._createBarChart(d,e,t),n==="line-chart"&&await this._createLineChart(d,e,t),d.root.dom.classList.toggle(v.mediaChartRendered,!0)}_clearMediaRefreshTimer(){let{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=void 0)}_updateMediaInfoTimestamp(e){let t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();let{activeMediaInfo:e}=this;e?.type==="image"&&e.refreshInterval>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){let{refreshInterval:t,value:a}=e,i=t*6e4;this._updateMediaInfoTimestamp(a.sourceURL);let r=window.setInterval(()=>{this._updateMediaInfoTimestamp(a.sourceURL)},i);this._refreshTimer=r}_getImageSource(e,t){let a=e.includes("?")?"&":"?",[i,r=""]=e.split("#");return`${i}${a}timestamp=${t}${r?"#":""}${r}`}_updateChartElement(e){this._chartRoot?.dispose(),this._chartRoot=void 0,e&&this._createChart(e)}render(){return C`<div class=${y(v.base)} @keyup=${this._handleMediaKeyup}><arcgis-feature-element-info .heading=${this.heading} .description=${this.description} .headingLevel=${this.headingLevel}></arcgis-feature-element-info>${this._renderMedia()}</div>`}_renderMedia(){let{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this,a=this._renderMediaText();return e?C`<div class=${y(v.mediaContainer)}>${this._renderMediaInfo()}<div class=${y(v.mediaNavigation)}>${a}${e>1?C`<div class=${y(v.mediaPagination)}>${this._renderMediaPageButton("previous")}<span class=${y(v.mediaPaginationText)}>${oe(this.messages?.pageText??"",{index:t+1,total:e})}</span>${this._renderMediaPageButton("next")}</div>`:null}</div></div>`:null}_renderMediaText(){let{activeMediaInfo:e}=this;if(!e)return null;let t=e?.title?C`<div class=${y(v.mediaItemTitle)} .innerHTML=${te.sanitize(e.title)??""}></div>`:null,a=e?.caption?C`<div class=${y(v.mediaItemCaption)} .innerHTML=${te.sanitize(e.caption)??""}></div>`:null;return t||a?C`<div class=${y(v.mediaItemText)}>${t}${a}</div>`:null}_renderImageMediaInfo(e){if(!e.value)return null;let{_refreshIntervalInfo:t}=this,{value:a,refreshInterval:i,altText:r,title:s}=e,{sourceURL:n,linkURL:o}=a,d=q(o??void 0)?"_blank":"_self",g=d==="_blank"?"noreferrer":"",m=i?t:null,l=m?m.sourceURL:n,c=C`<img alt=${(r||s)??b} src=${l??void 0??b}>`;return(o?C`<a href=${o??b} rel=${g??b} target=${d} title=${s??b}>${c}</a>`:null)??c}_renderChartMediaInfo(e){let{activeMediaInfoIndex:t,formattedMediaInfoCount:a}=this;return W(`media-${e.type}-${t}-${a}`,C`<div class=${y(v.mediaChart)} ${H(this._updateChartElement)}></div>`)}_renderMediaInfoType(){let{activeMediaInfo:e}=this;return e?e.type==="image"?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){let{activeMediaInfo:e}=this;return e?C`<div class=${y(v.mediaItemContainer)}><div class=${y(v.mediaItem)}>${this._renderMediaInfoType()}</div></div>`:null}_renderMediaPageButton(e){if(this.formattedMediaInfoCount<2)return null;let t=e==="previous",a=t?this.messages?.previous??"":this.messages?.next??"",i=t?"chevron-left":"chevron-right",r=t?this.previous:this.next;return C`<button .ariaLabel=${a} class=${y(v.mediaPaginationButton)} @click=${r} tabindex=0 title=${a??b} type=button><calcite-icon flip-rtl class=${y(v.mediaPaginationIcon)} .icon=${i} scale=s></calcite-icon></button>`}async _renderChart(e){let{root:t,mediaInfo:a}=e,{value:i,type:r}=a,[{default:s},{default:n},{default:o},{esriChartColorSet:d},{ColorSet:g,Theme:m}]=await Promise.all([import("./VTCP2KG7.js"),import("./V2S4GZUL.js"),import("./YHPERRKT.js"),import("./PASCW4GI.js"),import("./CSQV2J3P.js")]),l=m.new(t);l.rule("ColorSet").set("colors",d),l.rule("ColorSet").set("reuse",!0);let c=[o.new(t),l];O(this.el)==="dark"&&c.push(n.new(t)),this._canAnimateChart()&&c.push(s.new(t)),t.setThemes(c);let u=await this._getRendererColors(),h=await this._getSeriesColors(i.series),f=g.new(t,{}),_=h.get(i.series[0]),I=_?{lineSettings:{stroke:_}}:void 0,x=i.series.map((p,A)=>{let R=h.get(p)||u.get(p.fieldName)||f.getIndex(A);return{[w]:p.tooltip,[T]:p.value,columnSettings:{fill:R,stroke:R},...I}}).filter(p=>r==="pie-chart"?p.value!=null&&p.value>0:!0);r==="pie-chart"?this._createPieChart(e,x):this._createXYChart(e,x)}};D("arcgis-feature-media",E);return E},"renderers/support/utils","intl","core/reactiveUtils","popup/FieldInfo","popup/content/support/ChartMediaInfoValueSeries","applications/Components/sanitizerUtils",a)