/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
v4.34.3 */
import{a as k}from"./XIZLMN6F.js";import{a as E}from"./JHAJCFXL.js";import{h as r}from"./TLMHEFBH.js";import{a as F}from"./BMZ5OG4J.js";import c from"./CDJV5WUJ.js";import a from"./GUWCFIQ4.js";import"./MHMLEVRX.js";import"./DXCHSVBP.js";import{d as g}from"./5BG7WW2E.js";import{b as y}from"./2YIVYDK5.js";import{A as o,D as b,F as v,g as C,h as s,l as d,w as n,x as h,y as u}from"./GRWAOK3Y.js";import"./UUMP6K6L.js";export default $arcgis.t(([,,,,,,,{Qa:m,i:c,lc:$},{e:P}])=>{var l={label:"label",fieldList:"field-list",fab:"fab"},w=C`:host{display:flex;flex-direction:column;width:var(--arcgis-charts-config-calcite-block-default-width);margin:var(--arcgis-charts-config-calcite-block-default-margin);margin-top:var(--arcgis-charts-top-section-margin)}.label,.disabled-label{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:var(--arcgis-charts-config-margin-minor);justify-content:space-between}.text{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);width:calc(100% - 1.5rem);height:2rem;margin-bottom:var(--arcgis-charts-config-margin-minor);justify-content:space-between}.field-list{max-height:50vh;overflow-y:auto}.disabled-label{pointer-events:none}.fab{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:1.5rem;justify-content:center}`,p=class extends u{constructor(){super(...arguments),this._messages=F(),this.pieChartPopover=null,this.sortOrderElement=n(),this.categoryElement=n(),this.numericFieldsElement=n(),this.onPieChartDataChange=async e=>{try{if(e.detail!==null&&e.detail?.value!==void 0){let{contentKind:t}=e.detail,i=[...e.detail.value];switch(t){case r.aggregation:this.model.aggregationType=i[0]!==y.NoAggregation?i[0]:"";break;case r.category:{let a=i[0]?.trim()||"";this.updateMode(a);let f=this.model.numericFields;f.length>1&&a!==c&&(this.model.numericFields=[f[0]]),this.model.category=a,this.model.colorMatch=!0;break}case r.numericFields:i.length>1&&(this.updateMode(c),this.model.category=c),this.model.numericFields=i;break;case r.sortOrder:this.model.setSortOrder(i[0]);break;default:break}}}catch(t){throw this.arcgisChartsConfigDataChangeError.emit({error:t,model:this.model}),t}this.requestUpdate()},this.onModelConfigChange=()=>{this.requestUpdate()},this.popoverClose=e=>{this.pieChartPopover===e?.target&&this.removePieChartDataPopover()},this.layerFieldsInfo=[],this.arcgisChartsConfigDataChangeError=d(),this.arcgisChartsConfigPieChartDataNumericFieldValidate=d()}static{this.properties={messageOverrides:0,model:0,layerFieldsInfo:0}}static{this.styles=w}load(){this.modelChange(this.model),this.onModelConfigChange()}willUpdate(e){e.has("model")&&this.modelChange(this.model,e.get("model"))}disconnectedCallback(){super.disconnectedCallback(),this.removePieChartDataPopover(),this.model.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}modelChange(e,t){t?.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange),e?.addEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}buildNumericFieldItem(e){return k(e,s`<calcite-list-item .label=${m(this.layerFieldsInfo,e)} .value=${e} closable @calciteListItemClose=${this.onRemoveNumericField}></calcite-list-item>`)}onSortOrderSelect(e){this.contentKind=r.sortOrder,this.setupPopover(e)}onCategorySelect(e){this.contentKind=r.category,this.setupPopover(e)}onAddNumericFields(e){this.contentKind=r.numericFields,this.setupPopover(e)}onRemoveNumericField(e){let t=e.target.value;this.model.numericFields=this.model.numericFields.filter(i=>i!==t)}onShowDataLabelsChange(e){this.model.dataLabelsVisibility=e.target.checked}updateMode(e){let t=e!==c&&e.trim()!=="";this.model.mode=t?g.Category:g.Fields}setupPopover(e){e.stopImmediatePropagation(),this.removePieChartDataPopover();let t,i,a;switch(this.contentKind){case r.category:t=this.categoryElement.value,i=this._messages.categoryHeader,a=this.model.category;break;case r.numericFields:t=this.numericFieldsElement.value,i=this._messages.numericFieldsMultipleHeader,a=this.model.numericFields;break;case r.sortOrder:t=this.sortOrderElement.value,i=this._messages.sortOrderHeader,a=this.model.getSortOrder();break}this.pieChartPopover=b(s`<arcgis-charts-config-pie-chart-popover .headingTitle=${i} .referenceElement=${t} open .contentKind=${this.contentKind} .layerFieldsInfo=${this.layerFieldsInfo} .selectedContent=${a} @arcgisChartsConfigPieChartDataPopoverChange=${this.onPieChartDataChange} @arcgisChartsConfigPopoverClose=${this.popoverClose}></arcgis-charts-config-pie-chart-popover>`),!document.body.contains(this.pieChartPopover)&&this.pieChartPopover!==null&&document.body.appendChild(this.pieChartPopover)}getCorrectedCategoryValue(){return P({fieldName:this.model.category,fieldList:this.layerFieldsInfo})?"":m(this.layerFieldsInfo,this.model.category)}removePieChartDataPopover(){this.pieChartPopover!==null&&(this.pieChartPopover.open=!1,this.pieChartPopover=E(this.pieChartPopover))}renderSorting(){return s`<arcgis-charts-config-field-select .label=${this._messages[this.model.getSortOrder()]} @click=${this.onSortOrderSelect} ${h(this.sortOrderElement)}></arcgis-charts-config-field-select>`}renderCategory(){let e=this.getCorrectedCategoryValue();return s`<arcgis-charts-config-field-select .label=${e} @click=${this.onCategorySelect} ${h(this.categoryElement)}></arcgis-charts-config-field-select>`}renderNumericFields(e){let t=$(this.layerFieldsInfo),i=[];for(let a of e)a!==t&&i.push(this.buildNumericFieldItem(a));return s`<calcite-list label class=${o(l.fieldList)} ${h(this.numericFieldsElement)}>${i}</calcite-list>`}render(){let e=this.renderCategory(),t=this.renderSorting(),i=this.renderNumericFields([...this.model.numericFields]);return s`<div><calcite-label class=${o(l.label)}>${this._messages.category}${e}</calcite-label>${[s`<calcite-label class=${o(l.label)}>${this._messages.numericFields}${i}</calcite-label>`,s`<div class=${o(l.fab)}><calcite-fab appearance=outline-fill kind=neutral scale=m .label=${this._messages.selectNumericFields} text-enabled .text=${this._messages.selectNumericFields} icon=plus @click=${this.onAddNumericFields}></calcite-fab></div>`]}<calcite-label class=${o(l.label)} layout=inline-space-between>${this._messages.showDataLabels}<calcite-switch .checked=${this.model.dataLabelsVisibility} @calciteSwitchChange=${this.onShowDataLabelsChange}></calcite-switch></calcite-label><calcite-label class=${o(l.label)}>${this._messages.sortOrder}${t}</calcite-label></div>`}};v("arcgis-charts-config-pie-chart-data",p);return p},"geometry/support/jsonUtils","rest/support/AttributeBinsQuery","rest/support/Query","rest/support/StatisticDefinition","time/TimeExtent","core/promiseUtils","request",a,c)