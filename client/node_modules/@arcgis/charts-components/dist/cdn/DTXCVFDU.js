/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
v4.34.3 */
import{a as M,c as K}from"./VZXOTDOW.js";import{a as H}from"./MWPCQM2X.js";import{a as w}from"./XIZLMN6F.js";import{a as j}from"./JHAJCFXL.js";import n from"./MSRS6EXP.js";import{g as r,m as b}from"./TLMHEFBH.js";import{a as x}from"./BMZ5OG4J.js";import l from"./JQSIPEYW.js";import"./PI2NXF2Q.js";import i from"./TNMDYW24.js";import f from"./CDJV5WUJ.js";import e from"./GUWCFIQ4.js";import{j as $,q as v}from"./MHMLEVRX.js";import"./DXCHSVBP.js";import{a as d}from"./5BG7WW2E.js";import{a as u,b as h,k as S,n as p}from"./2YIVYDK5.js";import{A as a,D as E,F as T,g as k,h as o,j as L,l as g,w as c,x as m,y as O}from"./GRWAOK3Y.js";import"./UUMP6K6L.js";export default $arcgis.t(([,,,,,,,{Ha:F,Qa:y,Ra:N,Xa:V,k:P,lc:B,ob:I,ya:D,za:_},{e:R},,z,{a:U}])=>{var l={label:"label",fieldList:"field-list",fab:"fab",disabledLabel:"disabled-label",timeBinningHeader:"time-binning-header",linkContainer:"link-container",list:"list",customSortButtons:"custom-sort-buttons",dimText:"dim-text",intervalContainer:"interval-container"},Z=k`.hide{display:none}.am5-modal{width:100%;height:100%;position:absolute;z-index:100000;top:0;left:0}.am5-modal-curtain{top:0;left:0;width:100%;height:100%;position:absolute;background:#fff!important;z-index:100}.am5-modal-wrapper{top:0;left:0;width:100%;height:100%;position:absolute;display:flex;align-items:center;justify-content:center;white-space:nowrap;background:#ffffff80;z-index:101}.am5-modal-content{display:inline-block;padding:1.2em;vertical-align:middle;text-align:start;white-space:normal;background:#fff;border-radius:4px;box-shadow:#00000073 0 0 36px;color:#000}.am5-layer-1000{z-index:1000!important}.am5-layer-30{z-index:100!important}.arcgis-charts-modal{box-shadow:none!important}.arcgis-charts-modal-header{background-color:#0000000d;font-weight:700;padding:4px;align-content:center}.show{display:block}.notifyPanel{flex:0 1 auto}.disable-interactions{pointer-events:none}.dim-text{color:var(--arcgis-charts-dim-text)}:host{display:flex;flex-direction:column;width:var(--arcgis-charts-config-calcite-block-default-width);margin:var(--arcgis-charts-config-calcite-block-default-margin);margin-top:var(--arcgis-charts-top-section-margin)}.label,.disabled-label{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:var(--arcgis-charts-config-margin-minor);justify-content:space-between}.time-binning-header{display:flex;font-weight:700;margin-left:.5rem;margin-right:.5rem;justify-content:space-between}.text{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);width:calc(100% - 1.5rem);height:2rem;margin-bottom:var(--arcgis-charts-config-margin-minor);justify-content:space-between}.field-list{max-height:50vh;overflow-y:auto}.disabled-label{pointer-events:none}.fab{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:1.5rem;justify-content:center}.link-container{display:flex;justify-content:flex-end}.list{margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:var(--arcgis-charts-config-margin-major)}.custom-sort-buttons{display:flex;justify-content:space-between;align-items:center;font-weight:var(--calcite-font-weight-medium);font-size:var(--calcite-font-size-0)}.mb-2{margin-bottom:var(--arcgis-charts-config-margin-minor)}.interval-container{margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:var(--arcgis-charts-config-margin-minor)}`,A=class extends O{constructor(){super(...arguments),this._messages=x(),this.commonStrings=x({name:"common",blocking:!0}),this.barChartPopover=null,this.sortOrderElement=c(),this.aggregationElement=c(),this.categoryElement=c(),this.numericFieldsElement=c(),this.splitByFieldElement=c(),this.enableTimeBinningSwitch=c(),this.intervalAlignmentElement=c(),this.intervalElement=c(),this.originalCustomSortLabels=[],this.isCustomSortDisabled=!1,this.onBarChartDataChange=async e=>{try{if(e.detail!==null&&e.detail?.value!==void 0){let{contentKind:i}=e.detail,t=[...e.detail.value];switch(K(M),i){case r.aggregation:this.model.aggregationType=t[0]!==h.NoAggregation?t[0]:h.NoAggregation;break;case r.category:{let s=t[0]?.trim()||"";if(this.model.xAxisField=s,this.model.getSortOrder()===d.customSort){let n=await this.updateCustomSortProps();this.model.orderByList=n,this.sortOrderResetCounter+=1}break}case r.numericFields:if(this.model.numericFields=t,(this.model.numericFields??[]).length>0&&this.model.aggregationType===h.Count&&this.model.numericFields[0]!==B(this.layerFieldsInfo)&&(this.model.aggregationType=h.Sum),this.model.getSortOrder()===d.customSort){let s=await this.updateCustomSortProps();this.model.orderByList=s,this.sortOrderResetCounter+=1}break;case r.splitByField:{let s=t[0]?.trim()||"";this.model.splitByField=s,this.model.colorMatch=!0;break}case r.sortOrder:{let s=t[0];if(s===d.customSort){let n=await this.updateCustomSortProps();this.model.setSortOrder(s,n)}else this.model.setSortOrder(s);this.sortOrderResetCounter+=1;break}case r.interval:this.model.temporalBinningSize=t[0]?.intervalSize,this.model.temporalBinningUnit=t[0]?.intervalUnits,this.arcgisChartsConfigCustomizedTimeInterval.emit();break;case r.intervalAlignment:this.model.timeAggregationType=t[0]??"";break;default:break}}}catch(i){throw this.arcgisChartsConfigDataChangeError.emit({error:i,model:this.model}),i}this.removeBarChartDataPopover(),this.requestUpdate()},this.onModelConfigChange=()=>{this.requestUpdate()},this.popoverClose=e=>{this.barChartPopover===e?.target&&this.removeBarChartDataPopover()},this.selectedCustomSortItemId="",this.sortOrderResetCounter=0,this.layerFieldsInfo=[],this.arcgisChartsConfigBarChartDataNumericFieldValidate=g(),this.arcgisChartsConfigDataChangeError=g(),this.arcgisChartsConfigResetTimeInterval=g(),this.arcgisChartsConfigCustomizedTimeInterval=g()}static{this.properties={selectedCustomSortItemId:16,aggregationLabel:16,timeAggregationLabel:16,disableSplitBy:16,sortOrderResetCounter:16,messageOverrides:0,model:0,layerFieldsInfo:0,open:7}}static{this.styles=Z}load(){this.modelChange(this.model),this.onModelConfigChange(),this.currentDataFilter=this.model.getDataFilters(),this.updateCustomSortProps()}async willUpdate(e){e.has("model")&&this.modelChange(this.model,e.get("model")),this.aggregationLabel=D(this.model.aggregationType,this.commonStrings),$(this.model.getDataFilters(),this.currentDataFilter)||(this.model.getSortOrder()===d.customSort&&await this.updateCustomSortProps(),this.currentDataFilter=this.model.getDataFilters());let i=this.model.timeAggregationType;i!==void 0&&(this.timeAggregationLabel=_(i,this.commonStrings)),this.disableSplitBy=this.model.numericFields.length>1||this.model.xAxisField===""||this.model.xAxisField===P}disconnectedCallback(){super.disconnectedCallback(),this.removeBarChartDataPopover(),this.model.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}modelChange(e,i){i?.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange),e?.addEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}onCalciteListOrderChange(e){if(e.detail!==null&&e.detail!==void 0){let{newIndex:i,oldIndex:t}=e.detail;this.model.moveCustomSortValuesInOrderByList(t,i)}}onCustomSortItemSelected(e){let{id:i}=e.target;this.selectedCustomSortItemId=this.selectedCustomSortItemId===i?"":i}onCustomSortItemMoved(e){let{id:i}=e.target,t=this.model.orderByList.length,s=this.model.orderByList.indexOf(this.selectedCustomSortItemId);i===b.Up?t=s-1:i===b.Down&&(t=s+1),s>=0&&t>=0&&t<this.model.orderByList.length&&(this.model.moveCustomSortValuesInOrderByList(s,t),this.sortOrderResetCounter+=1)}async onEnableTimeBinningChange(e){let i=e.target.checked;this.model.binTemporalData=i,this.requestUpdate()}buildNumericFieldItem(e){return w(e,o`<calcite-list-item .label=${y(this.layerFieldsInfo,e)} .value=${e} closable @calciteListItemClose=${this.onRemoveNumericField}></calcite-list-item>`)}resetTimeIntervalOriginal(e){this.popoverClose(e),this.model.resetTimeInterval!==void 0&&(this.model.resetTimeInterval(),this.arcgisChartsConfigResetTimeInterval.emit())}buildCustomSortListItems(){return H(this.model.orderByList,e=>e,e=>{let i=N(this.layerFieldsInfo,e),t=this.model.nullCategory!==void 0&&e.trim()===z.nullCategory?.text?.trim();return o`<calcite-list-item id=${e??L} .label=${e} .closed=${t} .description=${i} .value=${e} .selected=${this.selectedCustomSortItemId===e} @calciteListItemSelect=${this.onCustomSortItemSelected}><calcite-icon slot=content-end></calcite-icon></calcite-list-item>`})}buildCustomSortList(){return w(this.sortOrderResetCounter,o`<calcite-list label class=${a(l.list)} drag-enabled selection-mode=single selection-appearance=border @calciteListOrderChange=${this.onCalciteListOrderChange}>${this.buildCustomSortListItems()}</calcite-list>`)}onAggregationSelect(e){this.contentKind=r.aggregation,this.setupPopover(e)}onSortOrderSelect(e){this.contentKind=r.sortOrder,this.setupPopover(e)}onCategorySelect(e){this.contentKind=r.category,this.setupPopover(e)}onSplitBySelect(e){this.splitByFieldElement.value&&!this.splitByFieldElement.value.disabled&&(this.contentKind=r.splitByField,this.setupPopover(e))}onAddNumericFields(e){this.contentKind=r.numericFields,this.setupPopover(e)}async onRemoveNumericField(e){let i=e.target.value;if(this.model.numericFields=this.model.numericFields.filter(t=>t!==i),this.model.getSortOrder()===d.customSort){let t=await this.updateCustomSortProps();this.model.orderByList=t,this.sortOrderResetCounter+=1}}onIntervalAlignmentSelect(e){this.intervalAlignmentElement.value&&!this.intervalAlignmentElement.value.disabled&&(this.contentKind=r.intervalAlignment,this.setupPopover(e))}onIntervalSelect(e){this.intervalElement.value&&!this.intervalElement.value.disabled&&(this.contentKind=r.interval,this.setupPopover(e))}getCorrectedSplitByValue(){return this.model.splitByField===""||(this.model.numericFields??[]).length>1?"":y(this.layerFieldsInfo,this.model.splitByField)}getCorrectedCategoryValue(){return R({fieldName:this.model.xAxisField,fieldList:this.layerFieldsInfo})?"":y(this.layerFieldsInfo,this.model.xAxisField)}onShowDataLabelsChange(e){this.model.dataLabelsVisibility=e.target.checked}onTreatNullAsCategoryChange(e){this.model.fetchNULLValues=e.target.checked}async updateCustomSortProps(){let e=await this.model.getCustomSortValues();this.originalCustomSortLabels=[...e];let i=e.length>U.customSortLimit;return i&&(this.sortOrderElement.value&&(this.sortOrderElement.value.label=this._messages.xAxisAsc),this.model.setSortOrder(d.xAxisAsc)),this.isCustomSortDisabled=i,e}setupPopover(e){e.stopImmediatePropagation(),this.removeBarChartDataPopover();let i={size:this.model.temporalBinningSize??1,unit:this.model.temporalBinningUnit??S.Second},t,s,n,C=!1,f=!1;switch(this.contentKind){case r.aggregation:t=this.aggregationElement.value,s=this._messages.aggregationHeader,C=I(this.model.config.series??[])===F.BarAndLineFromFields,n=this.model.aggregationType;break;case r.category:t=this.categoryElement.value,s=this._messages.categoryHeader,n=this.model.xAxisField;break;case r.numericFields:t=this.numericFieldsElement.value,s=this._messages.numericFieldsHeader,n=this.model.numericFields;break;case r.splitByField:t=this.splitByFieldElement.value,s=this._messages.splitByFieldHeader,n=this.model.splitByField;break;case r.sortOrder:t=this.sortOrderElement.value,s=this._messages.sortOrderHeader,n=this.model.getSortOrder(),f=this.isCustomSortDisabled;break;case r.interval:t=this.intervalElement.value,s=this._messages.editInterval,n=i;break;case r.intervalAlignment:t=this.intervalAlignmentElement.value,s=this._messages.intervalAlignment,n=this.model.timeAggregationType??"";break}this.barChartPopover=E(o`<arcgis-charts-config-bar-chart-popover .headingTitle=${s} .referenceElement=${t} open .contentKind=${this.contentKind} .layerFieldsInfo=${this.layerFieldsInfo} .selectedContent=${n} .isCustomSortDisabled=${f} .isNoAggregationDisabled=${C} @arcgisChartsConfigBarChartDataPopoverChange=${this.onBarChartDataChange} @arcgisChartsConfigPopoverClose=${this.popoverClose}></arcgis-charts-config-bar-chart-popover>`),!document.body.contains(this.barChartPopover)&&this.barChartPopover!==null&&document.body.appendChild(this.barChartPopover)}removeBarChartDataPopover(){this.barChartPopover!==null&&(this.barChartPopover.open=!1,this.barChartPopover=j(this.barChartPopover))}resetToOriginalCustomSortLabels(){this.selectedCustomSortItemId="",this.model.orderByList=[...this.originalCustomSortLabels],this.sortOrderResetCounter+=1}onTrimIncompleteIntervalChange(e){this.model.trimIncompleteTimeInterval=e.target.checked}onNullPolicyChange(e){this.model.nullPolicy=e.target.selectedItem.value}shouldShowTimeBinning(){let e=this.layerFieldsInfo.find(s=>s.name===this.model.xAxisField),i=e?.type===v.Date||e?.type===v.DateOnly||e?.type===v.TimestampOffset,t=this.model.aggregationType!==h.NoAggregation;return i&&t}renderSorting(){return o`<arcgis-charts-config-field-select .disabled=${this.model.getAxisValueFormat(0)?.type===u.DateAxisFormat} .label=${this.model.getAxisValueFormat(0)?.type===u.DateAxisFormat?this._messages.xAxisAsc:this._messages[this.model.getSortOrder()]} @click=${this.onSortOrderSelect} ${m(this.sortOrderElement)}></arcgis-charts-config-field-select>`}renderAggregation(){return o`<arcgis-charts-config-field-select .label=${this.model.aggregationType===h.NoAggregation?this._messages.noAggregation:this.aggregationLabel} @click=${this.onAggregationSelect} ${m(this.aggregationElement)}></arcgis-charts-config-field-select>`}renderCategory(){let e=this.getCorrectedCategoryValue();return o`<arcgis-charts-config-field-select .label=${e} @click=${this.onCategorySelect} ${m(this.categoryElement)}></arcgis-charts-config-field-select>`}renderSplitBy(){let e=this.getCorrectedSplitByValue();return o`<arcgis-charts-config-field-select .label=${e} .disabled=${this.disableSplitBy} @click=${this.onSplitBySelect} ${m(this.splitByFieldElement)}></arcgis-charts-config-field-select>`}renderNumericFields(e){let i=B(this.layerFieldsInfo),t=[];for(let s of e)s!==i&&t.push(this.buildNumericFieldItem(s));return o`<calcite-list label class=${a(l.fieldList)} ${m(this.numericFieldsElement)}>${t}</calcite-list>`}renderCustomSortUI(){let e=this.model.getSortOrder(),i=this.model.getAxisValueFormat(0)?.type,t=this.model.orderByList.indexOf(this.selectedCustomSortItemId);return i===u.CategoryAxisFormat&&e===d.customSort&&!this.isCustomSortDisabled?o`<calcite-label class=${a(l.label)}><div class=${a(l.customSortButtons)}><div><calcite-button appearance=transparent .disabled=${t===0||t===-1||this.selectedCustomSortItemId.trim()===""} icon-start=arrow-bold-up id=${b.Up} kind=neutral scale=s @click=${this.onCustomSortItemMoved}></calcite-button><calcite-button appearance=transparent .disabled=${t===-1||t===this.model.orderByList.length-1||this.selectedCustomSortItemId.trim()===""} icon-start=arrow-bold-down id=${b.Down} kind=neutral scale=s @click=${this.onCustomSortItemMoved}></calcite-button></div><calcite-button @click=${this.resetToOriginalCustomSortLabels} .disabled=${$(this.model.orderByList,this.originalCustomSortLabels)} appearance=transparent icon-end=reset>${this._messages.reset}</calcite-button></div>${I(this.model.config.series??[])===F.BarAndLineFromFields?this._messages.values:this._messages.category}${this.buildCustomSortList()}</calcite-label>`:null}renderInterval(){let e=(this.model.temporalBinningSize??0)<=0,i=this.model.temporalBinningSize??"",t=V(this.model.temporalBinningUnit??S.Second,this._messages)??"";return[o`<calcite-list label selection-appearance=border class=${a(l.intervalContainer)}><calcite-list-item .value=${e?"":`${i} ${t}`} .label=${e?"":`${i} ${t}`} @click=${e?()=>{}:this.onIntervalSelect} ${m(this.intervalElement)}><calcite-icon slot=content-end icon=pencil></calcite-icon></calcite-list-item></calcite-list>`,o`<div class=${a(l.linkContainer)}><calcite-button appearance=transparent scale=s icon-end=reset @click=${this.resetTimeIntervalOriginal}>${this._messages.reset}</calcite-button></div>`]}renderIntervalAlignment(){return o`<arcgis-charts-config-field-select .label=${this.timeAggregationLabel} @click=${this.onIntervalAlignmentSelect} ${m(this.intervalAlignmentElement)}></arcgis-charts-config-field-select>`}renderEmptyBins(){return o`<calcite-radio-button-group name=empty-bins layout=vertical @calciteRadioButtonGroupChange=${this.onNullPolicyChange}><calcite-label layout=inline><calcite-radio-button .value=${p.Zero} .checked=${this.model.nullPolicy===p.Zero}></calcite-radio-button>${this._messages.treatAsZero}</calcite-label><calcite-label layout=inline><calcite-radio-button .value=${p.Null} .checked=${this.model.nullPolicy===p.Null}></calcite-radio-button>${this._messages.treatAsNull}</calcite-label></calcite-radio-button-group>`}render(){let e=this.renderAggregation(),i=this.renderCategory(),t=this.renderSplitBy(),s=this.renderSorting(),n=this.renderNumericFields([...this.model.numericFields??[]]),C=this.renderCustomSortUI(),f=this.renderInterval(),q=this.renderIntervalAlignment(),W=this.renderEmptyBins();return o`<calcite-label class=${a(l.label)}>${this._messages.category}${i}</calcite-label><calcite-label class=${a(l.label)}>${this._messages.aggregation}${e}</calcite-label><calcite-label class=${a(l.label)}>${this._messages.numericFields}${n}</calcite-label><div class=${a(l.fab)}><calcite-fab appearance=outline-fill kind=neutral scale=m .label=${this._messages.selectNumericFields} text-enabled .text=${this._messages.selectNumericFields} icon=plus @click=${this.onAddNumericFields}></calcite-fab></div><calcite-label class=${a(l.label)}><span class=${a(this.disableSplitBy?l.dimText:"")}>${this._messages.splitBy}</span>${t}</calcite-label><div .hidden=${!this.shouldShowTimeBinning()}><h3 class=${a(l.timeBinningHeader)}>${this._messages.timeBinningOptions}</h3><calcite-label class=${a(l.label)} layout=inline-space-between>${this._messages.enableTemporalBinning}<calcite-switch .checked=${this.model.binTemporalData} @calciteSwitchChange=${this.onEnableTimeBinningChange} ${m(this.enableTimeBinningSwitch)}></calcite-switch></calcite-label><div .hidden=${!this.model.binTemporalData||!this.shouldShowTimeBinning()}><calcite-label class=${a(l.label)}>${this._messages.interval}${f}</calcite-label><calcite-label class=${a(l.label)}>${this._messages.intervalAlignment}${q}</calcite-label><calcite-label class=${a(l.label)} layout=inline-space-between>${this._messages.trimIncompleteInterval}<calcite-switch .checked=${this.model.trimIncompleteTimeInterval} @calciteSwitchChange=${this.onTrimIncompleteIntervalChange}></calcite-switch></calcite-label><calcite-label class=${a(l.label)}>${this._messages.emptyBins}${W}</calcite-label></div></div><calcite-label class=${a(l.label)} layout=inline-space-between>${this._messages.treatNullAsCategory}<calcite-switch .checked=${this.model.fetchNULLValues} @calciteSwitchChange=${this.onTreatNullAsCategoryChange}></calcite-switch></calcite-label><calcite-label class=${a(l.label)} layout=inline-space-between>${this._messages.showDataLabels}<calcite-switch .checked=${this.model.dataLabelsVisibility} @calciteSwitchChange=${this.onShowDataLabelsChange}></calcite-switch></calcite-label><calcite-label class=${a(this.model.getAxisValueFormat(0)?.type===u.DateAxisFormat?l.disabledLabel:l.label)}>${this._messages.sortOrder}${s}</calcite-label>${C}`}};T("arcgis-charts-config-bar-chart-data",A);return A},"geometry/support/jsonUtils","rest/support/AttributeBinsQuery","rest/support/Query","rest/support/StatisticDefinition","time/TimeExtent","core/promiseUtils","request",e,f,i,l,n)