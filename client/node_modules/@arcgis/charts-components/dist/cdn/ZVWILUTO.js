/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
v4.34.3 */
import{a as m,c as K}from"./VZXOTDOW.js";import{a as I}from"./JHAJCFXL.js";import c from"./MSRS6EXP.js";import{j as o,l as h}from"./TLMHEFBH.js";import{a as E}from"./BMZ5OG4J.js";import b from"./TNMDYW24.js";import a from"./GUWCFIQ4.js";import{c as z,f as L,i as k,w as x}from"./MHMLEVRX.js";import"./DXCHSVBP.js";import"./5BG7WW2E.js";import{a as S}from"./2YIVYDK5.js";import{A as i,B as v,D as w,F as A,g as F,h as n,l as $,w as d,x as r,y as T}from"./GRWAOK3Y.js";import"./UUMP6K6L.js";export default $arcgis.t(([,,,,,,,{Ba:_,F:C,Qa:y,w:M},,{b:V,f:f,g:b,h:p,i:g,j:D}])=>{var l={label:"label",r2:"r2",numberInput:"number-input",iconSelect:"icon-select",sectionLabel:"section-label",switchElement:"switch-element",sectionContainer:"section-container",multiInputSection:"multi-input-section",dimText:"dim-text"},R=F`.hide{display:none}.am5-modal{width:100%;height:100%;position:absolute;z-index:100000;top:0;left:0}.am5-modal-curtain{top:0;left:0;width:100%;height:100%;position:absolute;background:#fff!important;z-index:100}.am5-modal-wrapper{top:0;left:0;width:100%;height:100%;position:absolute;display:flex;align-items:center;justify-content:center;white-space:nowrap;background:#ffffff80;z-index:101}.am5-modal-content{display:inline-block;padding:1.2em;vertical-align:middle;text-align:start;white-space:normal;background:#fff;border-radius:4px;box-shadow:#00000073 0 0 36px;color:#000}.am5-layer-1000{z-index:1000!important}.am5-layer-30{z-index:100!important}.arcgis-charts-modal{box-shadow:none!important}.arcgis-charts-modal-header{background-color:#0000000d;font-weight:700;padding:4px;align-content:center}.show{display:block}.notifyPanel{flex:0 1 auto}.disable-interactions{pointer-events:none}.dim-text{color:var(--arcgis-charts-dim-text)}:host{display:flex;flex-direction:column;width:var(--arcgis-charts-config-calcite-block-default-width);margin:var(--arcgis-charts-config-calcite-block-default-margin)}:host .number-input{margin-bottom:.5rem;display:flex}:host .number-input>div{width:100%}calcite-list-item{margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor)}calcite-slider{margin-top:-1.5rem}.r2{margin:var(--arcgis-charts-config-margin-major) var(--arcgis-charts-config-margin-minor)}.label{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:var(--arcgis-charts-config-margin-minor);justify-content:space-between}.text{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);width:calc(100% - 1.5rem);height:2rem;margin-bottom:var(--arcgis-charts-config-margin-minor);justify-content:space-between}.section-container{display:flex;flex-direction:column}.icon-select{cursor:pointer}.section-label{display:flex;margin:var(--arcgis-charts-config-margin-major) var(--arcgis-charts-config-margin-minor);justify-content:space-between;align-items:center;font-weight:var(--calcite-font-weight-medium);font-size:var(--calcite-font-size-0)}.switch-element{margin-right:var(--arcgis-charts-config-margin-minor)}.multi-input-section{display:flex;justify-content:space-between;align-items:center}`,P=class extends T{constructor(){super(...arguments),this._messages=E(),this.commonStrings=E({name:"common",blocking:!0}),this.scatterplotPopover=null,this.selectColorElement=d(),this.selectTrendLineElement=d(),this.xAxisElement=d(),this.yAxisElement=d(),this.tooltipFieldElement=d(),this.sizeVariableElement=d(),this.colorModeElement=d(),this.symbolSizeModeElement=d(),this.minSizeInputElement=d(),this.maxSizeInputElement=d(),this.items=[],this.setTrendLineSymbol=e=>{let t=e.detail;this.model.linearTrendSymbol=L(t)},this.setFixedSymbolRGBAColor=e=>{let t=e.detail,[a,s,c]=t,u=M*255;this.model.fixedMarkerSymbol={...this.model.fixedMarkerSymbol,color:[a,s,c,u]}},this.setXYField=e=>{try{let t=e.detail;K(m),this.contentKind===o.xAxisField?this.model.xAxisField=t:this.model.yAxisField=t,this.removeScatterplotPopover()}catch(t){throw this.arcgisChartsConfigDataChangeError.emit({error:t,model:this.model}),t}},this.setAdditionalTooltipField=e=>{let t=e.detail;this.model.additionalTooltipField=t,this.removeScatterplotPopover()},this.setSizeVariableField=e=>{try{let t=e.detail;t?this.model.sizePolicy={...this.model.sizePolicy,type:S.SizePolicy,field:t}:this.model.sizePolicy=void 0,m.scatterplotData[m.selectedChartId]={...m.scatterplotData[m.selectedChartId],sizePolicyField:this.model.sizePolicy?.field??void 0},this.removeScatterplotPopover()}catch(t){throw this.arcgisChartsConfigDataChangeError.emit({error:t,model:this.model}),t}},this.closeScatterplotPopover=e=>{this.scatterplotPopover===e?.target&&(this.contentKind=o.none,this.removeScatterplotPopover())},this.onModelConfigChange=()=>{this.requestUpdate();let{minSize:e,maxSize:t}=this.model.sizePolicy??{};this.minSizeInputElement.value!==void 0&&e!==void 0&&(this.minSizeInputElement.value.value=`${e}`,f(this.minSizeInputElement.value.value,this.minSizeInputElement.value.min,this.minSizeInputElement.value.max)?p({inputElement:this.minSizeInputElement.value,status:g.IDLE}):p({inputElement:this.minSizeInputElement.value,status:g.INVALID})),this.maxSizeInputElement.value!==void 0&&t!==void 0&&(this.maxSizeInputElement.value.value=`${t}`,f(this.maxSizeInputElement.value.value,this.maxSizeInputElement.value.min,this.maxSizeInputElement.value.max)?p({inputElement:this.maxSizeInputElement.value,status:g.IDLE}):p({inputElement:this.maxSizeInputElement.value,status:g.INVALID}))},this.segmentedControlRef=e=>{e&&(e.focus=()=>{},this.items.push(e))},this.layerFieldsInfo=[],this.arcgisChartsConfigDataChangeError=$(),this.arcgisChartsConfigScatterplotPopoverChange=$()}static{this.properties={selectedElement:16,selectedSizeType:16,messageOverrides:0,model:0,r2:11,layerFieldsInfo:0,isTableLayer:5}}static{this.styles=R}load(){this.modelChange(this.model),this.onModelConfigChange(),this.defaultR2Label=_(this.commonStrings)}willUpdate(e){e.has("model")&&(this.updateSymbolSizeInfoInAppState(),this.modelChange(this.model,e.get("model"))),e.has("selectedElement")&&this.openPopover()}async loaded(){await(async e=>await new Promise(t=>setTimeout(()=>t(),e)))(250),this.items.forEach(e=>{delete e.focus})}disconnectedCallback(){super.disconnectedCallback(),this.removeScatterplotPopover(),this.model.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}updateSymbolSizeInfoInAppState(){this.selectedSizeType=this.getCurrentSymbolSizeType(),console.log("\u{1F680} ~ ArcgisChartsConfigScatterplotData ~ load ~ this.selectedSizeType:",this.selectedSizeType),this.selectedSizeType===h.Proportional&&(m.scatterplotData[m.selectedChartId]={...m.scatterplotData[m.selectedChartId],sizePolicyField:this.model.sizePolicy?.field})}openPopover(){(typeof this.selectedElement=="string"||!k(this.selectedElement))&&this.setupPopover()}modelChange(e,t){t?.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange),e?.addEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}setShowTrendLine(e){let t=e.target.checked;this.model.showLinearTrend=t,!t&&this.contentKind===o.trendLine&&this.closeScatterplotPopover(e)}symbolSizeChange(e){let t=e.target,{value:a}=t;if(a!==void 0&&f(a,t.min,t.max)){let s=Number.parseInt(a),c=this.model.sizePolicy,u=this.model.fixedMarkerSymbol;switch(t.name){case"fixed-symbol-size":u!==void 0&&(this.model.fixedMarkerSymbol={...u,size:s});break;case"proportional-symbol-min-size":c!==void 0&&(this.model.sizePolicy={...c,minSize:s});break;case"proportional-symbol-max-size":c!==void 0&&(this.model.sizePolicy={...c,maxSize:s});break}p({inputElement:t,status:g.IDLE})}else p({inputElement:t,status:g.INVALID})}symbolSizeRangeSliderInput(e){let t=e.target,{minValue:a,maxValue:s}=t,c=this.model.sizePolicy;c!==void 0&&(this.model.sizePolicy={...c,minSize:a,maxSize:s},this.minSizeInputElement.value!==void 0&&(this.minSizeInputElement.value.value=`${a}`),this.maxSizeInputElement.value!==void 0&&(this.maxSizeInputElement.value.value=`${s}`))}changeColorTypeToggle(){let e=this.colorModeElement.value?.selectedItem?.value;this.model.colorMatch=e===this._messages.useLayerColors}changeSymbolSizeTypeToggle(){let e=this.symbolSizeModeElement.value?.value;this.selectedSizeType=e;let t=m.scatterplotData[m.selectedChartId]?.sizePolicyField;e===h.Proportional&&t!==void 0?this.model.sizePolicy={...this.model.sizePolicy,type:S.SizePolicy,field:t}:e===h.Fixed&&(this.model.sizePolicy={...this.model.sizePolicy,type:S.SizePolicy,field:""})}changeElementStyle(e){e.stopImmediatePropagation();let t=e.target;t.localName==="calcite-icon"&&(t=t.parentElement),t.value==="selectColor"?(this.contentKind=o.symbol,this.selectedElement=this.model.fixedMarkerSymbol?.color):t.value==="selectTrendLine"&&(this.contentKind=o.trendLine,this.selectedElement=this.model.linearTrendSymbol)}onXVariableSelectChange(e){e.stopImmediatePropagation(),this.contentKind=o.xAxisField,this.selectedElement=this.model.xAxisField}onYVariableSelectChange(e){e.stopImmediatePropagation(),this.contentKind=o.yAxisField,this.selectedElement=this.model.yAxisField}onAdditionalTooltipFieldSelectChange(e){e.stopImmediatePropagation(),this.contentKind=o.additionalTooltipFields,this.selectedElement=this.model.additionalTooltipField?.[0]??""}onSizeVariableSelectChange(e){e.stopImmediatePropagation(),this.contentKind=o.sizeVariable,this.selectedElement=this.model.sizePolicy?.field??""}setupPopover(){this.scatterplotPopover=I(this.scatterplotPopover);let e=[...this.layerFieldsInfo],t,a,s,c="trailing";switch(this.contentKind){case o.xAxisField:t=this.xAxisElement.value,s=this.model.xAxisField,a=this._messages.selectAField;break;case o.yAxisField:t=this.yAxisElement.value,s=this.model.yAxisField,a=this._messages.selectAField;break;case o.sizeVariable:t=this.sizeVariableElement.value,s=this.model.sizePolicy?.field??"",a=this._messages.selectAField;break;case o.additionalTooltipFields:t=this.tooltipFieldElement.value,s=this.model.additionalTooltipField?.[0]??"",a=this._messages.selectAField;break;case o.symbol:case o.trendLine:{let u=this.selectedElement;s=this.selectedElement,c="leading",Array.isArray(this.selectedElement)?t=this.selectColorElement.value:u?.type===x.SLS&&(t=this.selectTrendLineElement.value);break}default:this.contentKind=o.none,this.removeScatterplotPopover();break}this.scatterplotPopover=w(n`<arcgis-charts-config-scatter-plot-popover .headingTitle=${a} .referenceElement=${t} open .contentKind=${this.contentKind} .layerFieldsInfo=${e} .selectedContent=${s} .placement=${c} @arcgisChartsConfigPopoverClose=${this.closeScatterplotPopover} @arcgisChartsConfigScatterplotFillColorChange=${this.setFixedSymbolRGBAColor} @arcgisChartsConfigScatterplotLineStyleChange=${this.setTrendLineSymbol} @arcgisChartsConfigScatterplotXYFieldChange=${this.setXYField} @arcgisChartsConfigScatterplotSizeVariableFieldChange=${this.setSizeVariableField} @arcgisChartsConfigScatterplotAdditionalTooltipFieldChange=${this.setAdditionalTooltipField}></arcgis-charts-config-scatter-plot-popover>`),!document.body.contains(this.scatterplotPopover)&&this.scatterplotPopover!==null&&document.body.appendChild(this.scatterplotPopover)}removeScatterplotPopover(){this.scatterplotPopover!==null&&(this.scatterplotPopover=I(this.scatterplotPopover)),this.selectedElement={}}getCurrentSymbolSizeType(){let e=this.model.sizePolicy;return e===void 0||e.field===""?h.Fixed:h.Proportional}renderXVariable(){return n`<arcgis-charts-config-field-select .label=${y(this.layerFieldsInfo,this.model.xAxisField??"")} @click=${this.onXVariableSelectChange} ${r(this.xAxisElement)}></arcgis-charts-config-field-select>`}renderYVariable(){return n`<arcgis-charts-config-field-select .label=${y(this.layerFieldsInfo,this.model.yAxisField??"")} @click=${this.onYVariableSelectChange} ${r(this.yAxisElement)}></arcgis-charts-config-field-select>`}renderTooltipField(){return n`<arcgis-charts-config-field-select .disabled=${this.model.dataStore.aggregated} .label=${y(this.layerFieldsInfo,this.model.additionalTooltipField?.[0]??"")} @click=${this.onAdditionalTooltipFieldSelectChange} ${r(this.tooltipFieldElement)}></arcgis-charts-config-field-select>`}renderStatistics(){let[e,t,a,s]=[...this.model.linearTrendSymbol?.color??C(0)];return n`<div class=${i(l.sectionContainer)}><calcite-label class=${i(l.label)} layout=inline-space-between>${this._messages.showLinearTrend}<calcite-switch class=${i(l.switchElement)} .checked=${this.model.showLinearTrend} @calciteSwitchChange=${this.setShowTrendLine}></calcite-switch></calcite-label><calcite-list label selection-mode=single selection-appearance=border><calcite-list-item .label=${this._messages.trendLineStyle} value=selectTrendLine .hidden=${!this.model.showLinearTrend} .selected=${this.selectedElement?.type===x.SLS} @click=${this.changeElementStyle} ${r(this.selectTrendLineElement)}><calcite-icon slot=content-end icon=line-solid style=${v({color:`rgba(${e},${t},${a},${s/255})`})} class=${i(l.iconSelect)} @click=${this.changeElementStyle}></calcite-icon></calcite-list-item></calcite-list><div class=${i(l.r2)} .hidden=${!this.model.showLinearTrend}>${`${this._messages.r2}: ${Number.isNaN(this.r2)?this.defaultR2Label:D(this.r2,V)}`}</div></div>`}renderFixedSymbol(){return n`<calcite-label class=${i(l.label)}>${this._messages.size}<calcite-input type=number name=fixed-symbol-size class=${i(l.numberInput)} min=1 max=100 step=1 .value=${b(this.model.fixedMarkerSymbol?.size)} @calciteInputInput=${this.symbolSizeChange}></calcite-input></calcite-label>`}renderSizeVariable(){return n`<arcgis-charts-config-field-select .label=${y(this.layerFieldsInfo,this.model.sizePolicy?.field??"")} .invalid=${this.layerFieldsInfo.find(e=>e.name===this.model.sizePolicy?.field)===void 0} @click=${this.onSizeVariableSelectChange} ${r(this.sizeVariableElement)}></arcgis-charts-config-field-select>`}renderMinSizeInput(){return n`<calcite-input type=number name=proportional-symbol-min-size class=${i(l.numberInput)} min=1 .max=${this.model.sizePolicy?.maxSize??100} step=1 .value=${b(this.model.sizePolicy?.minSize)} @calciteInputInput=${this.symbolSizeChange} ${r(this.minSizeInputElement)}></calcite-input>`}renderMaxSizeInput(){return n`<calcite-input type=number name=proportional-symbol-max-size class=${i(l.numberInput)} .min=${this.model.sizePolicy?.minSize??1} max=100 step=1 .value=${b(this.model.sizePolicy?.maxSize)} @calciteInputInput=${this.symbolSizeChange} ${r(this.maxSizeInputElement)}></calcite-input>`}renderProportionalSymbol(){return n`<div class=${i(l.sectionContainer)}><calcite-label class=${i(l.label)}>${this._messages.numberRequired}${this.renderSizeVariable()}</calcite-label><div class=${i(l.multiInputSection)}><calcite-label class=${i(l.label)}>${this._messages.minSize}${this.renderMinSizeInput()}</calcite-label><calcite-label class=${i(l.label)}>${this._messages.maxSize}${this.renderMaxSizeInput()}</calcite-label></div><calcite-label><calcite-slider min=1 max=100 .minValue=${z(b(this.model.sizePolicy?.minSize))} .maxValue=${z(b(this.model.sizePolicy?.maxSize))} step=1 @calciteSliderInput=${this.symbolSizeRangeSliderInput}></calcite-slider></calcite-label></div>`}renderSymbolSizeType(){return n`<calcite-label class=${i(l.label)}>${this._messages.size}<calcite-segmented-control name=symbolSizeType layout=horizontal scale=s @calciteSegmentedControlChange=${this.changeSymbolSizeTypeToggle} ${r(this.symbolSizeModeElement)}><calcite-segmented-control-item .value=${h.Fixed} .checked=${h.Fixed===this.selectedSizeType} ${r(this.segmentedControlRef)}>${this._messages.fixed}</calcite-segmented-control-item><calcite-segmented-control-item .value=${h.Proportional} .checked=${h.Proportional===this.selectedSizeType} ${r(this.segmentedControlRef)}>${this._messages.proportional}</calcite-segmented-control-item></calcite-segmented-control></calcite-label>`}renderSymbol(){let[e,t,a,s]=[...this.model.fixedMarkerSymbol?.color??C(0)];return n`<div class=${i(l.sectionContainer)}>${this.renderSymbolSizeType()}${this.selectedSizeType===h.Proportional?this.renderProportionalSymbol():this.renderFixedSymbol()}<calcite-label class=${i(l.label)}>${this._messages.color}${this.isTableLayer!==!0?n`<calcite-segmented-control name=layerColor layout=horizontal scale=s @calciteSegmentedControlChange=${this.changeColorTypeToggle} ${r(this.colorModeElement)}><calcite-segmented-control-item .value=${this._messages.useLayerColors} .checked=${this.model.colorMatch} ${r(this.segmentedControlRef)}>${this._messages.useLayerColors}</calcite-segmented-control-item><calcite-segmented-control-item .value=${this._messages.singleColor} .checked=${!this.model.colorMatch} ${r(this.segmentedControlRef)}>${this._messages.singleColor}</calcite-segmented-control-item></calcite-segmented-control>`:null}</calcite-label><calcite-list label selection-mode=single selection-appearance=border><calcite-list-item .label=${this._messages.color} value=selectColor .hidden=${this.model.colorMatch&&this.isTableLayer!==!0} .selected=${Array.isArray(this.selectedElement)} @click=${this.changeElementStyle} ${r(this.selectColorElement)}><calcite-icon slot=content-end icon=circle-f style=${v({color:`rgba(${e},${t},${a},${s/255})`})} class=${i(l.iconSelect)} @click=${this.changeElementStyle}></calcite-icon></calcite-list-item></calcite-list></div>`}render(){return n`<div><h3 class=${i(l.sectionLabel)}>${this._messages.variables}</h3><calcite-label class=${i(l.label)}>${this._messages.xAxisNumber}${this.renderXVariable()}</calcite-label><calcite-label class=${i(l.label)}>${this._messages.yAxisNumber}${this.renderYVariable()}</calcite-label><calcite-label class=${i(l.label)}><span class=${i(this.model.dataStore.aggregated?l.dimText:"")}>${this._messages.additionalTooltipFields}</span>${this.renderTooltipField()}</calcite-label><h3 class=${i(l.sectionLabel)}>${this._messages.statistics}</h3>${this.renderStatistics()}<h3 class=${i(l.sectionLabel)}>${this._messages.symbol}</h3>${this.renderSymbol()}</div>`}};A("arcgis-charts-config-scatter-plot-data",P);return P},"geometry/support/jsonUtils","rest/support/AttributeBinsQuery","rest/support/Query","rest/support/StatisticDefinition","time/TimeExtent","core/promiseUtils","request",a,b,c)