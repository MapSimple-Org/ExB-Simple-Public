/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
v4.34.3 */
import{a as y}from"./MWPCQM2X.js";import{a as C}from"./XIZLMN6F.js";import{b as H,c as M}from"./JHAJCFXL.js";import e from"./MSRS6EXP.js";import{g as l}from"./TLMHEFBH.js";import{a as I}from"./BMZ5OG4J.js";import c from"./TNMDYW24.js";import a from"./GUWCFIQ4.js";import{j as k,q as h}from"./MHMLEVRX.js";import"./DXCHSVBP.js";import{a as p}from"./5BG7WW2E.js";import{b as A,k as m,o as b}from"./2YIVYDK5.js";import{A as o,B as w,D,F,g as S,h as s,l as $,w as u,x as d,y as P}from"./GRWAOK3Y.js";import"./UUMP6K6L.js";export default $arcgis.t(([{substitute:U},,,,,,,,{Qa:z,Xa:N,mc:B,oc:L,ya:T,za:E},{g:O},{a:f,c:v,g:_,k:g,o:K,r:j}])=>{var Y=S`.hide{display:none}.am5-modal{width:100%;height:100%;position:absolute;z-index:100000;top:0;left:0}.am5-modal-curtain{top:0;left:0;width:100%;height:100%;position:absolute;background:#fff!important;z-index:100}.am5-modal-wrapper{top:0;left:0;width:100%;height:100%;position:absolute;display:flex;align-items:center;justify-content:center;white-space:nowrap;background:#ffffff80;z-index:101}.am5-modal-content{display:inline-block;padding:1.2em;vertical-align:middle;text-align:start;white-space:normal;background:#fff;border-radius:4px;box-shadow:#00000073 0 0 36px;color:#000}.am5-layer-1000{z-index:1000!important}.am5-layer-30{z-index:100!important}.arcgis-charts-modal{box-shadow:none!important}.arcgis-charts-modal-header{background-color:#0000000d;font-weight:700;padding:4px;align-content:center}.show{display:block}.notifyPanel{flex:0 1 auto}.disable-interactions{pointer-events:none}.dim-text{color:var(--arcgis-charts-dim-text)}.name{display:flex;flex-direction:column;margin:.5rem;padding:.5rem;background:#fff;min-width:250px}.header{margin:0;font-weight:bolder}.fab{display:flex;justify-content:stretch}.pick-list-item-label{font-size:small}.sort-icon-color{color:#000}.sort-y-axis{transform:rotate(90deg)}.sort-order-pick-list{overflow-y:hidden}.panel{max-height:60vh}.panel .size-section{width:19rem;margin:1rem 0;display:flex;flex-wrap:wrap;justify-content:space-evenly}.panel .size-section calcite-label{width:8rem;margin-bottom:.25rem}.panel .apply-button{width:17rem}`,n={jsAppFlyout:"js-app-flyout",name:"bar-chart-data-popover",numericFieldPickList:"bar-chart-data-numeric-fields-pick-list",header:"header",fab:"fab",pickListItemLabel:"pick-list-item-label",rotateClass:"sort-y-axis",sortOrderPickList:"sort-order-pick-list",sizeSection:"size-section",applyButton:"apply-button",panel:"panel"},x=class extends P{constructor(){super(...arguments),this._messages=I(),this.commonStrings=I({name:"common",blocking:!0}),this.picklist=u(),this.intervalSizeElement=u(),this.intervalTypeElement=u(),this.popoverElement=u(),this.placement="leading",this.offsetDistance=-200,this.pickListHasChanged=!1,this.aggregationLabels=[],this.layerFieldsInfo=[],this.isCustomSortDisabled=!1,this.isNoAggregationDisabled=!1,this.arcgisChartsConfigBarChartDataPopoverChange=$(),this.arcgisChartsConfigPopoverClose=$()}static{this.properties={aggregationLabels:16,timeAggregationLabels:16,messageOverrides:0,headingTitle:3,referenceElement:2,open:7,contentKind:1,layerFieldsInfo:0,selectedContent:1,isCustomSortDisabled:5,isNoAggregationDisabled:5}}static{this.styles=Y}async reposition(){await this.popoverElement.value?.reposition()}willUpdate(e){e.has("selectedContent")&&this.selectedContentChange(this.selectedContent,e.get("selectedContent"));let t=v.map(a=>T(a,this.commonStrings));k(this.aggregationLabels,t)||(this.aggregationLabels=t);let i=[b.Start,b.End].map(a=>E(a,this.commonStrings));k(this.timeAggregationLabels,i)||(this.timeAggregationLabels=i)}updated(){setTimeout(async()=>{await this.picklist.value?.setFocus()},f.PopoverTimer),H(this.popoverElement.value,this.open),this.hasUpdated||setTimeout(()=>{this.popoverElement.value?.reposition()},f.PopoverTimer)}selectedContentChange(e,t){this.pickListHasChanged=M(e,t)}buildAggregationListItems(){let e=this.isNoAggregationDisabled?v.filter(t=>t!==A.NoAggregation):v;return y(e,t=>t,(t,i)=>s`<calcite-list-item .label=${this.aggregationLabels[i]} .value=${t} .selected=${g(t,this.selectedContent)}></calcite-list-item>`)}createTooltip(e){if(e.target?.label===this._messages.customSort&&this.isCustomSortDisabled){let t=e.target,i=O(t),a=new Intl.NumberFormat(i).format(f.customSortLimit),r=U(this._messages.customSortLimit??"",{totalLimit:a});this.tooltip=D(s`<calcite-tooltip style=${w({opacity:1,zIndex:"var(--calcite-floating-ui-z-index)"})} .referenceElement=${t} open placement=top>${r}</calcite-tooltip>`),document.body.appendChild(this.tooltip)}}destroyTooltip(){j(this.tooltip)}buildSortOrder(){let e=Object.keys(p),t;return y(e,i=>i,i=>{let a="";switch(i){case p.xAxisAsc:{t="a-z-down";break}case p.xAxisDesc:{t="a-z-up";break}case p.yAxisAsc:{t="sort-descending",a=n.rotateClass;break}case p.yAxisDesc:{t="sort-ascending",a=n.rotateClass;break}case p.customSort:{t="arrow-up-down";break}}return s`<calcite-list-item .disabled=${this.isCustomSortDisabled&&i===p.customSort} .label=${this._messages[i]} .selected=${this.selectedContent===i} .value=${p[i]} @mouseover=${this.createTooltip} @mouseout=${this.destroyTooltip}><calcite-icon class=${`sort-icon-color ${a}`} slot=content-start .icon=${t}></calcite-icon></calcite-list-item>`})}buildPickListItem(e){return C(e.name,s`<calcite-list-item .label=${z(this.layerFieldsInfo,e.name)} .value=${e.name} .selected=${g(e.name,this.selectedContent)}></calcite-list-item>`)}buildPickListItems(e){let t=this.layerFieldsInfo?.length??0,i=[];switch(e){case l.numericFields:{for(let a=0;a<t;a+=1){let r=this.layerFieldsInfo?.[a];r&&B(r)&&i.push(this.buildPickListItem(r))}break}case l.category:{let a=C(" ",s`<calcite-list-item label=" " value=" " .selected=${g("",this.selectedContent)}></calcite-list-item>`);i.push(a);for(let r=0;r<t;r+=1){let c=this.layerFieldsInfo?.[r];c&&(L(c)||c.type===h.String||c.type===h.Date||c.type===h.DateOnly||c.type===h.TimestampOffset)&&i.push(this.buildPickListItem(c))}break}case l.splitByField:{let a=C(" ",s`<calcite-list-item label=" " value=" " .selected=${g("",this.selectedContent)}></calcite-list-item>`);i.push(a);for(let r=0;r<t;r+=1){let c=this.layerFieldsInfo?.[r];c&&(L(c)||c.type===h.String)&&i.push(this.buildPickListItem(c))}break}}return i}closePopover(){if(this.contentKind===l.numericFields&&this.pickListHasChanged){let e={pickListElement:this.picklist.value,eventEmitter:this.arcgisChartsConfigBarChartDataPopoverChange,contentKind:this.contentKind};K(e)}this.open=!1,this.arcgisChartsConfigPopoverClose.emit()}onDataContentTypeChange(e){let t=e.target.selectedItems;this.arcgisChartsConfigBarChartDataPopoverChange.emit({contentKind:this.contentKind,value:t.map(i=>i.value)}),this.open=!1}intervalChange(){let e=Number.parseInt(this.intervalSizeElement.value?.value??""),t=this.intervalTypeElement.value?.selectedOption?.value;!Number.isNaN(e)&&e>0&&this.arcgisChartsConfigBarChartDataPopoverChange.emit({contentKind:this.contentKind,value:[{intervalSize:e,intervalUnits:t}]}),this.open=!1}onNumericFieldsChange(e){e.target!==null&&(this.selectedContent=e.target.selectedItems.map(t=>t.value))}onNumericFieldSelectionDone(){this.pickListHasChanged&&this.closePopover()}buildIntervalAlignmentPickListItems(){let e=[b.Start,b.End];return y(e,t=>t,(t,i)=>s`<calcite-list-item .label=${this.timeAggregationLabels?.[i]} .value=${t} .selected=${g(t,this.selectedContent)}></calcite-list-item>`)}renderAggregationType(){let e=this.buildAggregationListItems();return s`<calcite-list label class=${o(n.pickListItemLabel)} selection-mode=single selection-appearance=border @calciteListChange=${this.onDataContentTypeChange}>${e}</calcite-list>`}renderCategory(){let e=this.buildPickListItems(l.category);return s`<calcite-list label class=${o(n.pickListItemLabel)} selection-mode=single selection-appearance=border filter-enabled @calciteListChange=${this.onDataContentTypeChange} ${d(this.picklist)}>${e}</calcite-list>`}renderNumericFields(){let e=this.buildPickListItems(l.numericFields);return s`<calcite-list label class=${o(n.numericFieldPickList)} selection-mode=multiple filter-enabled @calciteListChange=${this.onNumericFieldsChange} ${d(this.picklist)}>${e}</calcite-list>`}renderSortOrder(){let e=this.buildSortOrder();return s`<calcite-list label class=${o(n.sortOrderPickList)} selection-mode=single selection-appearance=border @calciteListChange=${this.onDataContentTypeChange}>${e}</calcite-list>`}renderSplitByField(){let e=this.buildPickListItems(l.splitByField);return s`<calcite-list label class=${o(n.pickListItemLabel)} selection-mode=single selection-appearance=border filter-enabled @calciteListChange=${this.onDataContentTypeChange} ${d(this.picklist)}>${e}</calcite-list>`}renderIntervalAlignment(){let e=this.buildIntervalAlignmentPickListItems();return s`<calcite-list label class=${o(n.pickListItemLabel)} selection-mode=single selection-appearance=border @calciteListChange=${this.onDataContentTypeChange}>${e}</calcite-list>`}renderInterval(){let e=this.selectedContent,t=[m.Second,m.Minute,m.Hour,m.Day,m.Week,m.Month,m.Year];return s`<div><div class=${o(n.sizeSection)}><calcite-label scale=m>${this._messages.intervalSize}<calcite-input type=number scale=m min=1 step=any .value=${_(e?.size,1)} ${d(this.intervalSizeElement)}></calcite-input></calcite-label><calcite-label scale=m>${this._messages.intervalType}<calcite-select .label=${this._messages.intervalType??""} ${d(this.intervalTypeElement)}>${t.map(i=>s`<calcite-option .value=${i} .label=${N(i,this._messages)} .selected=${e?.unit===i}></calcite-option>`)}</calcite-select></calcite-label><calcite-button class=${o(n.applyButton)} appearance=outline @click=${this.intervalChange}>${this._messages.apply}</calcite-button></div></div>`}renderPopoverInfo(){let e;switch(this.contentKind){case l.aggregation:e=this.renderAggregationType();break;case l.category:e=this.renderCategory();break;case l.numericFields:e=this.renderNumericFields();break;case l.splitByField:e=this.renderSplitByField();break;case l.sortOrder:e=this.renderSortOrder();break;case l.intervalAlignment:e=this.renderIntervalAlignment();break;case l.interval:e=this.renderInterval();break}return e}render(){let e;return this.contentKind===l.numericFields&&(e=s`<div slot=footer><calcite-fab class=${o(n.fab)} appearance=outline-fill kind=neutral icon .label=${this._messages.selectionDone} scale=s text-enabled .text=${this._messages.selectionDone} @click=${this.onNumericFieldSelectionDone}></calcite-fab></div>`),s`<div class=${o(n.jsAppFlyout)}><calcite-popover class=${o(n.name)} .referenceElement=${this.referenceElement??document.body} .placement=${this.placement} .offsetDistance=${this.offsetDistance} .open=${this.open} @calcitePopoverClose=${this.closePopover} label auto-close ${d(this.popoverElement)}><calcite-panel class=${o(n.panel)} closable .closed=${!this.open} @calcitePanelClose=${this.closePopover}><div slot=header-content class=${o(n.header)}>${this.headingTitle??""}</div>${this.renderPopoverInfo()}${e}</calcite-panel></calcite-popover></div>`}};F("arcgis-charts-config-bar-chart-popover",x);return x},"intl","geometry/support/jsonUtils","rest/support/AttributeBinsQuery","rest/support/Query","rest/support/StatisticDefinition","time/TimeExtent","core/promiseUtils","request",a,c,e)