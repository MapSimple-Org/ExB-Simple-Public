/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
v4.34.3 */
import e from"./JQSIPEYW.js";import d from"./TNMDYW24.js";import c from"./NQ2FR6A4.js";import b from"./MJVNOHMT.js";import{g as Ii}from"./UM26TKF2.js";import a from"./GUWCFIQ4.js";import{A as re,a as at,f as Se,i as Zt,j as Ne,o as St,q as Ve,t as ei,w as Ge}from"./MHMLEVRX.js";import{a as v,b as T,c as H,e as Yt,f as De,h as le,i as Ft,k,n as ie,o as Q,p as Xt,v as Fe,w as R}from"./2YIVYDK5.js";export default $arcgis.t(([,,,,,,qr,Ji,He,Pr,{substitute:pe},_i,Lr,Ki,{$a:ui,$b:ce,A:ze,Ab:ut,B:xt,Bc:V,C:j,E:Bt,Ec:jt,Fb:fi,Fc:Oi,Gb:ct,Ha:p,Hb:Lt,Ja:Nt,Jb:mi,Ka:wt,Kb:gi,Lb:yi,Ma:Mt,Mb:Ot,Na:At,Nb:hi,Ob:ke,Pa:ye,Pb:pi,Qa:ot,Rb:W,Ua:X,Ub:vi,Va:st,Vb:bi,Wa:Je,Wb:Si,Xb:Fi,Yb:Ci,Zb:xi,_b:Re,a:ti,ac:Bi,b:ii,bc:Ni,c:ri,cb:Tt,cc:wi,d:ni,dc:It,e:ai,ec:K,fc:Mi,g:oi,gc:Et,hc:Ai,i:ne,ib:we,j:ge,jc:Ti,kb:J,kc:Be,lb:ue,mb:lt,mc:_e,n:ae,nb:he,ob:I,p:qe,pb:xe,pc:qi,qb:oe,r:si,rb:ci,rc:Dt,s:Ce,sb:D,sc:Pi,t:G,tb:je,tc:Vt,u:li,ub:qt,uc:Li,vb:Pt,w:Ct,wa:Pe,wb:di,xa:$e,xb:z,yc:$t,zb:se},{a:dt},Ei,{g:Di},b])=>{function Vi(i){var e,t,r=i.length;if(r===1)e=0,t=i[0][1];else{for(var n=0,a=0,o=0,s=0,u,l,c,d=0;d<r;d++)u=i[d],l=u[0],c=u[1],n+=l,a+=c,o+=l*l,s+=l*c;e=(r*s-n*a)/(r*o-n*n),t=a/r-e*n/r}return{m:e,b:t}}function $i(i){return function(e){return i.b+i.m*e}}function ji(i,e){if(i.length<2)return 1;for(var t=0,r=0;r<i.length;r++)t+=i[r][1];for(var n=t/i.length,a=0,o=0;o<i.length;o++)a+=Math.pow(n-i[o][1],2);for(var s=0,u=0;u<i.length;u++)s+=Math.pow(i[u][1]-e(i[u][0]),2);return 1-s/a}var ki=function(){this.totalCount=0,this.data={}};ki.prototype.train=function(e,t){this.data[t]||(this.data[t]={});for(var r in e){var n=e[r];this.data[t][r]===void 0&&(this.data[t][r]={}),this.data[t][r][n]===void 0&&(this.data[t][r][n]=0),this.data[t][r][n]++}this.totalCount++};ki.prototype.score=function(e){var t={},r;for(var n in e){var a=e[n];for(r in this.data)t[r]={},this.data[r][n]?t[r][n+"_"+a]=(this.data[r][n][a]||0)/this.totalCount:t[r][n+"_"+a]=0}var o={};for(r in t){o[r]=0;for(var s in t[r])o[r]+=t[r][s]}return o};var Ri=function(){this.weights=[],this.bias=0};Ri.prototype.predict=function(e){if(e.length!==this.weights.length)return null;for(var t=0,r=0;r<this.weights.length;r++)t+=this.weights[r]*e[r];return t+=this.bias,t>0?1:0};Ri.prototype.train=function(e,t){if(t!==0&&t!==1)return null;e.length!==this.weights.length&&(this.weights=e,this.bias=1);var r=this.predict(e);if(typeof r=="number"&&r!==t){for(var n=t-r,a=0;a<this.weights.length;a++)this.weights[a]+=n*e[a];this.bias+=n}return this};var jo=607/128,ko=Math.log(Math.sqrt(2*Math.PI));var Ro=Math.sqrt(2*Math.PI);var Mr=Math.sqrt(2*Math.PI);function Ar(i){for(var e=i,t=i,r=1;r<15;r++)t*=i*i/(2*r+1),e+=t;return Math.round((.5+e/Mr*Math.exp(-i*i/2))*1e4)/1e4}var Tr=[];for(ft=0;ft<=3.09;ft+=.01)Tr.push(Ar(ft));var ft;async function Or(i,e){let t=e.errors[i];throw new ct(e.modalHeaders.error,t??e.errors.simpleError)}function be(i){return i.axes?.[0]?.valueFormat?.type}function ms(i){return i.intlOptions}function U(i){return i?.type===v.NumberAxisFormat}function gs(i){return U(i)&&i.intlOptions?.style==="percent"}function ve(i){return i?.type===v.CategoryAxisFormat}function Le(i){return i?.type===v.DateAxisFormat}function ys(i){let{oldConfig:e,newConfig:t,rotationChanged:r}=i;return r?[!0,!0]:[e.horizontalAxisLabelsBehavior!==t.horizontalAxisLabelsBehavior,e.verticalAxisLabelsBehavior!==t.verticalAxisLabelsBehavior]}function Ir(i){return U(i?.[1]?.valueFormat)&&(i?.[2]?.valueFormat===void 0||U(i[2].valueFormat))}function Er(i){return U(i?.[1]?.valueFormat)&&(i?.[2]?.valueFormat===void 0||U(i[2].valueFormat))}function Dr(i){return(ve(i?.[0]?.valueFormat)||Le(i?.[0]?.valueFormat))&&U(i?.[1]?.valueFormat)&&(i?.[2]?.valueFormat===void 0||U(i[2].valueFormat))}function Vr(i){return ve(i?.[0]?.valueFormat)&&ve(i?.[1]?.valueFormat)||Le(i?.[0]?.valueFormat)&&ve(i?.[1]?.valueFormat)||Le(i?.[0]?.valueFormat)&&Le(i?.[1]?.valueFormat)}function $r(i){return(ve(i?.[0]?.valueFormat)||Le(i?.[0]?.valueFormat))&&U(i?.[1]?.valueFormat)}function jr(i){return U(i?.[0]?.valueFormat)&&U(i?.[1]?.valueFormat)}function kr(i){return U(i?.[0]?.valueFormat)&&U(i?.[1]?.valueFormat)}function Rr(i){return U(i?.[0]?.valueFormat)}async function hs(i){let{chartType:e,axesConfig:t,errorStrings:r}=i,n,a;switch(e){case v.GaugeSeries:n=Rr,a="invalidValueFormatForGauge";break;case v.ScatterSeries:n=jr,a="invalidValueFormatForScatterplot";break;case v.HistogramSeries:n=kr,a="invalidValueFormatForHistogram";break;case v.LineSeries:n=Ir,a="invalidValueFormatForLineChart";break;case v.BarSeries:n=Er,a="invalidValueFormatForBarChart";break;case v.ComboLineAndBarSeries:n=$r,a="invalidValueFormatForComboBarLineChart";break;case v.BoxPlotSeries:n=Dr,a="invalidValueFormatForBoxPlot";break;case v.HeatSeries:n=Vr,a="invalidValueFormatForHeatChart";break}n!==void 0&&a!==void 0&&(n(t)||await Or(a,r))}function _r(i){let{isXAxis:e,chartType:t,valueFormat:r,isAxisForHistogramOverlaySeries:n}=i;return e&&(ve(r)||t===v.HistogramSeries&&!n||t===v.BarSeries&&U(r))}function ps(i){let{chartConfig:e,isSecondValueAxis:t,seriesIds:r}=i,n=r;return e.axes?.length===3&&(n=e.series.map(a=>{let o="";return(r===void 0||r.includes(a.id))&&(t===!0&&"assignToSecondValueAxis"in a&&a.assignToSecondValueAxis===!0||t!==!0&&(!("assignToSecondValueAxis"in a)||a.assignToSecondValueAxis!==!0))&&({id:o}=a),o}).filter(a=>a!=="")),n}var Ui={...b,chartPadding:5,footerContainer:{...b.footerContainer,paddingTop:0,paddingBottom:0},headerContainer:{...b.headerContainer,paddingBottom:0},chartContainer:{...b.chartContainer},dataLabel:{...b.dataLabel,verticalCenter:"bottom"},scrollbarPadding:12,zIndexes:{guide:100,scatterplotTrendLine:2,bulletMarkers:1},verticalSurfaceGuideLabels:{wrap:!0},verticalLineGuideLabels:{wrap:!0,rotation:90},horizontalSurfaceGuideLabels:{wrap:!0},horizontalLineGuideLabels:{wrap:!0},overlayId:{scatterplotTrendLine:"arcgis_charts_scatter_plot_trendline",histogramMean:"arcgis_charts_histogram_mean",histogramMedian:"arcgis_charts_histogram_median",histogramStdDev:"arcgis_charts_histogram_std_dev",histogramNormalDistribution:"arcgis_charts_histogram_normal_distribution"},axisLabelSpacing:{verticalAxisLabelSidePadding:8,horizontalAxisLabelPaddingTop:6},legendPadding:20,heatChart:{gradientHeatRules:{minColor:[255,255,200,255],maxColor:[255,0,0,255],outsideRangeLowerColor:[250,250,250,255],outsideRangeUpperColor:[0,0,255,255]},legend:{position:Yt.Bottom,chartPadding:40,legendPadding:20,size:20},emptyCells:{symbol:{type:Ge.SFS,style:ei.Solid,color:b.grayColor},text:"null"}},heatChartLabelPadding:{paddingTop:2},heatChartFirstDayOfWeek:7};function Kr(i,e){return i[0].dataTransformationType!==e[0].dataTransformationType}function Wr(i,e){return i[0].binCount!==e[0].binCount}function vs(i,e){let t=!0,r=R(i?.series),n=R(e?.series);return r!==n&&(t=r===v.ComboLineAndBarSeries&&(n===v.BarSeries||n===v.LineSeries)||n===v.ComboLineAndBarSeries&&(r===v.BarSeries||r===v.LineSeries)||r===v.BarSeries&&n===v.LineSeries||r===v.LineSeries&&n===v.BarSeries),t}function kt(i,e){return i!==void 0&&e!==void 0&&e>0}function bs(i){let{chartConfig:e,queryObject:t,chartData:r}=i,n=[],a=I(e.series),o=Nt(e),s=W(t),u=e.chartRenderer??s?.renderer?.toJSON();return n=e.series.map((l,c)=>{let d=R([l]),f;return(d===v.BarSeries||d===v.LineSeries||d===v.RadarSeries)&&(l.type===v.BarSeries?f=l.fillSymbol?.color:(l.type===v.RadarSeries||l.type===v.LineSeries)&&(f=l.lineSymbol?.color),o?f=Lo({dataItem:r[0],seriesConfig:l,chartSubType:a,colorMatch:o,rendererType:u?.type})?.color:f===void 0&&(f=Bt({colorIndex:c}))),f}).filter(l=>l!==void 0),n}function Rt(i){return i!==p.PieNoAggregation&&i!==p.BarAndLineNoAggregation&&i!==p.BarAndLineSplitByNoAggregation}function Qr(i){let e=I(i.series);return e===p.BarAndLineFromFields||e===p.PieFromFields||e===p.BoxPlotMonoField||e===p.BoxPlotMultiFields||e===p.BoxPlotMonoFieldAndSplitBy||e===p.BoxPlotMultiFieldsAndSplitBy}function Ue(i){return i&&"showMean"in i&&typeof i.showMean=="boolean"?i.showMean:!1}function Hr(i){return i&&"showOutliers"in i&&typeof i.showOutliers=="boolean"?i.showOutliers:void 0}function Ss(){return`{name} {${b.originalCategoryValue}} {dateY} {valueX} {dateX} {valueY}`}function Gr(i){let e;return i?.[0]!==void 0&&(e=i.reduce((t,r)=>({...t,xmin:Math.min(t.xmin,r.xmin),xmax:Math.max(t.xmax,r.xmax),ymin:Math.min(t.ymin,r.ymin),ymax:Math.max(t.ymax,r.ymax)}),i[0])),e}function Ze(i){let{value:e,dataContext:t,specificField:r,preferLabel:n,keepNullValues:a=!1,useRendererLabel:o=!1,config:s}=i,u=e,{originalCategoryValue:l,originalDateValue:c,typeOrDomainIdValue:d}=b;if(t!==void 0){let f=o?No(t):void 0;r!==void 0&&t[r]!==void 0?u=t[r]:f!==void 0?u=f:n===!1&&t[d]!==void 0?u=t[d]:t[c]!==void 0?u=t[c]:t[l]!==void 0?u=t[l]:t[ne]!==void 0&&(u=t[ne]),!a&&u===null&&(u="null",s?.series?.[0].type===v.BarSeries&&(u=s.series?.[0]?.nullCategory?.text??Ui.nullCategory?.text??u))}return u}function zr(i){return i?.[b.typeOrDomainIdValue]!==void 0?i?.[b.typeOrDomainIdValue]:i?.[b.originalCategoryValue]}function Ye(i){let{arrayToSort:e,orderBy:t,sortingField:r,forceAscendingOrder:n,isNonAggregated:a,sortByCategory:o,preferLabel:s,isPieOrByFieldsChart:u}=i;if(e!==void 0&&e.length>1){let l=t===le.Descending&&n!==!0;e.sort((c,d)=>{let f=0,m=c[r];o===!0&&!u&&(m=Ze({value:`${c[r]?.toString()}`,dataContext:c,preferLabel:s}));let g=d[r];return o===!0&&!u&&(g=Ze({value:`${d[r]?.toString()}`,dataContext:d,preferLabel:s})),a===!0&&l&&o===!0&&(m=Number.isNaN(Number.parseFloat(`${m?.toString()}`))?m:Number.parseFloat(m),g=Number.isNaN(Number.parseFloat(`${g?.toString()}`))?g:Number.parseFloat(g)),o===!0&&(c[b.originalCategoryValue]===null||m===null)||c[ze.defaultGroupOfSlicesId]===!0?f=1:o===!0&&(d[b.originalCategoryValue]===null||g===null)||d[ze.defaultGroupOfSlicesId]===!0?f=-1:typeof m=="string"&&typeof g=="string"?(f=m.localeCompare(g,void 0,{numeric:!0}),l&&(f*=-1)):m===void 0?f=l?-1:1:g===void 0?f=l?1:-1:m!==null&&g!==null&&(m>g?f=l?-1:1:m<g&&(f=l?1:-1)),f})}}function Jr(i){let{arrayToSort:e,orderBy:t,sortingField:r,fieldList:n,isByFieldsChart:a,preferLabel:o}=i;e!==void 0&&e.length>1&&!X(r)&&t!==void 0&&t.length>0&&e.sort((s,u)=>{let l=s[r];o&&a&&typeof l=="string"&&(l=ot(n,l));let c=t.indexOf(l?.toString()??"");c===-1&&(c=t.length);let d=u[r];o&&a&&typeof d=="string"&&(d=ot(n,d));let f=t.indexOf(d?.toString()??"");return f===-1&&(f=t.length),c-f})}function Zi(i,e){let t=i;if(e?.[0]!==void 0&&I(e)===p.PieFromFields){let{x:r,y:n}=e[0];(at(i)?t:t.dataItems).forEach(a=>(ne in a&&r!==ne&&(a[r]=a[r]!==void 0?a[r]:a[ne],delete a[ne]),ge in a&&n!==ge&&(a[n]=a[n]!==void 0?a[n]:a[ge],delete a[ge]),a))}return t}function Yi(i,e){let t=R(e),r=i,n=e?.[0];if((t===v.PieSeries||t===v.BoxPlotSeries||t===v.LineSeries||t===v.RadarSeries||t===v.BarSeries||t===v.ComboLineAndBarSeries)&&n!==void 0){let a=at(i),o=a?i:i.dataItems;if(i!==void 0){let{originalCategoryValue:s,originalDateValue:u,xAxisField:l,typeOrDomainIdValue:c}=b,{x:d}=n;o=o.map(f=>{let m=f[d];f[c]!==void 0?m=f[c]:f[u]!==void 0?m=f[u]:f[s]!==void 0&&(m=f[s]);let g={...f,[d]:m};return delete g[u],delete g[c],delete g[s],delete g[l],g}),a?r=o:"dataItems"in r&&(r.dataItems=o)}}return r}function _t(i){let e={...i};delete e[b.technicalSortingFieldBySum],delete e[b.technicalSortingFieldByPercent],delete e[b.pieChart.technicalFieldSlicePercent],delete e[b.pieChart.technicalFieldGroupedSlices],delete e[b.typeOrDomainFieldName],delete e[b.lastTemporalBin],delete e[b.originalServerBinningRange],delete e[b.technicalFieldSplitByField],delete e[G.uniqueIdsName],Object.keys(e).filter(r=>r.includes(b.rendererSymbolField)).forEach(r=>delete e[r]);let t=Je(e);return t.isInItem&&delete e[t.expr??""],e}function Ur(i,e){let t=i,r=R(e),n=Pt(t);if(n!==void 0)switch(r){case v.ComboLineAndBarSeries:case v.BarSeries:case v.LineSeries:case v.RadarSeries:case v.PieSeries:{n=n.map(_t),t={dataItems:n};let{timeIntervalInfo:a,serverLimitReached:o}=i??{};Zt(a)||(t.timeIntervalInfo=a),o!==void 0&&(t.serverLimitReached=o)}break;case v.ScatterSeries:t={...t,dataItems:n.map(_t)};break}return t}function Xi(i){let{data:e,seriesConfig:t}=i,r=Se(e);return r!==void 0&&(r=Yi(r,t),r=Ur(r,t),r=Zi(r,t)),r}function er(i){let{statsMap:e,dataContext:t,chartLimits:r}=i,n=!1;if(e!==void 0){let{maxScatterPointsBeforeAggregation:a}=Pe(r),{queryNumberOfFeatures:o}=b.scatterplotAggregationFields;n=(e.get(o)??Number.NaN)>=a}else t!==void 0&&(n=b.scatterplotAggregationFields.dataContextXMinField in t);return n}function Zr(i){let e=!0,t=R(i.series);if(t===v.BarSeries||t===v.LineSeries||t===v.ComboLineAndBarSeries){let r=I(i.series);e=r!==p.BarAndLineNoAggregation&&r!==p.BarAndLineSplitByNoAggregation}return e}function Yr(i){return I(i.series)!==p.PieNoAggregation}function Xr(i){let{dataContext:e,chartConfig:t,chartLimits:r}=i,n=!0;if(t!==void 0)switch(R(t.series)){case v.BarSeries:case v.LineSeries:case v.ComboLineAndBarSeries:n=Zr(t);break;case v.ScatterSeries:n=er({dataContext:e,chartLimits:r});break;case v.PieSeries:n=Yr(t);break}return n}function en(i,e){let t=i;switch(e){case H.Log:t=`log(${i})`;break;case H.Sqrt:t=`power(CAST(${i} AS FLOAT),0.5)`;break}return t}function We(i){let e=new Date(i).valueOf();return Number.isNaN(e)||(e=new Intl.DateTimeFormat("en-US",b.dateFormatUTC).format(i).replace(",","")),e}function yt(i){let{dataToConvert:e,x:t,y:r,fieldList:n}=i,a=[];if(e){let o=e[Ce];Object.entries(e).forEach(([s])=>{if(s!==""&&s!==Ce&&s in e){let u={[t]:ot(n,s),[r]:e[s],[b.xAxisField]:s,[b.originalCategoryValue]:s};o!==void 0&&(u[Ce]=o),e[`${b.rendererSymbolField}_${s}`]!==void 0&&(u[b.rendererSymbolField]=e[`${b.rendererSymbolField}_${s}`]),a.push(u)}})}return a}function tn(i,e){return JSON.stringify(i.series[0]?.valueConversion)!==JSON.stringify(e.series[0]?.valueConversion)}function rn(i,e){return JSON.stringify(i.series[0]?.xTemporalBinning)!==JSON.stringify(e.series[0]?.xTemporalBinning)||JSON.stringify(i.series[0]?.yTemporalBinning)!==JSON.stringify(e.series[0]?.yTemporalBinning)||(i.firstDayOfWeek??7)!==(e.firstDayOfWeek??7)||i.outTimeZone!==e.outTimeZone||(i.nullPolicy??ie.Null)!==(e.nullPolicy??ie.Null)}function nn(i){let{oldConfig:e,newConfig:t,fieldList:r}=i,n=e.series[0],a=t.series[0],o=!1;if(n.type===v.ScatterSeries&&a.type===v.ScatterSeries&&r&&r.length>0){let s=new Set(n.additionalTooltipFields||[]),u=new Set(a.additionalTooltipFields||[]);if(!Ne(s,u)){let l=Array.from(u).filter(c=>!s.has(c));l.length>0&&(o=r?.some(c=>l.includes(c.name)&&!_e(c)))}}return o}function Fs(i,e){return(i.colorMatch??!1)!==(e.colorMatch??!1)}function Cs(i,e){return(i.legend?.visible??!1)!==(e.legend?.visible??!1)||JSON.stringify(i.legend?.body)!==JSON.stringify(e.legend?.body)}function xs(i,e){return JSON.stringify(i.series[0]?.gradientRules)!==JSON.stringify(e.series[0]?.gradientRules)}function Bs(i){let{oldConfig:e,newConfig:t}=i,r=!1,n=e.series[0],a=t.series[0],o=R(e.series),s=R(t.series);if(o===v.PieSeries&&s===v.PieSeries){let{slices:u,sliceGrouping:l}=n,{slices:c,sliceGrouping:d}=a,f=u?.map(h=>({sliceId:h.sliceId,label:h.label})),m=c?.map(h=>({sliceId:h.sliceId,label:h.label})),g=l?.label,y=d?.label;r=JSON.stringify(f)!==JSON.stringify(m)||JSON.stringify(g)!==JSON.stringify(y)}return r}function Wi(i,e){return e.length!==i.length}function an(i){let{oldSeries:e,newConfig:t,oldTimeIntervalInfo:r,setTimeBinningInfoWhenNotProvided:n}=i,a=t.series?.[0],o=!1,s=!1,u=!1;if(oe(a)&&xe({seriesConfig:a,xAxisValueFormatType:be(t),setTimeBinningInfoWhenNotProvided:n})){let l=e[0];o=JSON.stringify(l.temporalBinning)!==JSON.stringify(a.temporalBinning),s=r?.unit!==a.temporalBinning?.unit,u=n===!0&&(a.temporalBinning?.size??0)<=0}return{timeBinningChanged:o,timeIntervalUnitChanged:s,newTimeBinningWillBeCalculated:u}}function on(i){let{oldConfig:e,newConfig:t,behaviorAfterLimit:r}=i,n=e.series,a=t.series,o=!1,s=!1;(r===qe.RenderUpToTheLimit||e.orderOptions?.data===void 0||t.orderOptions?.data===void 0)&&(s=!Ne(e.orderOptions?.orderByFields,t.orderOptions?.orderByFields));let u=St(n.map(c=>c.query),["where","outStatistics[0].outStatisticFieldName","outStatistics[0].onStatisticField"]),l=St(a.map(c=>c.query),["where","outStatistics[0].outStatisticFieldName","outStatistics[0].onStatisticField"]);return o=!Ne(u,l),o||s}function sn(i,e){let t=!1;if(e[0].x!==i[0].x)t=!0;else{let r=R(i);if(r!==v.HistogramSeries&&r!==v.GaugeSeries){let n=se(i).sort(),a=se(e).sort();t=JSON.stringify(n)!==JSON.stringify(a)}}return t}function ln(i,e){return(i??!1)!==(e?.filterBySelection??!1)}function tr(i){let{currentSelectionOIDs:e,options:t}=i,r=!1;return t?.filterBySelection===!0&&(r=e?.length!==t?.selectionData?.selectionOIDs?.length||!Ne(e,t?.selectionData?.selectionOIDs)),r}function un(i,e){return oe(i.series[0])&&oe(e.series[0])&&(i.series[0].binTemporalData??b.binTemporalData)!==(e.series[0].binTemporalData??b.binTemporalData)}function Ns(i,e){return i?.length!==e?.length||i?.some((t,r)=>{let n=ue({where:t?.query?.where}),a=ue({where:e?.[r]?.query?.where});return n!==a})}function ws(i,e){let t=se(i),r=se(e);return JSON.stringify(t)!==JSON.stringify(r)}function cn(i,e){return Ue(i)!==Ue(e)}function dn(i,e){let t=i.axes?.[0].valueFormat.type,r=e.axes?.[0].valueFormat.type,n=I(e.series),a=n===p.BarAndLineNoAggregation||n===p.BarAndLineSplitByNoAggregation,o=t===v.DateAxisFormat&&r===v.NumberAxisFormat,s=t===v.NumberAxisFormat&&r===v.DateAxisFormat;return t!==r&&(a||o||s)}function Ms(i){let{forceDataUpdate:e,oldConfig:t,newConfig:r,options:n,formerFilterBySelection:a,timeIntervalInfo:o,currentSelectionOIDs:s,fieldList:u}=i,{series:l}=r,{series:c}=t,d=R(l),f=!1,m=!1,g=!1,y={common:{queryChanged:!1,xOrYChanged:!1,numberOfSeriesChanged:!1,configFiltersChanged:!1,filterBySelectionChanged:!1,dataForFilterBySelectionChanged:!1,binTemporalDataChanged:!1,timeBinningChanged:!1,timeIntervalUnitChanged:!1,newTimeBinningWillBeCalculated:!1,valueFormatChangeRequiresNewData:!1},histogram:{dataPropsChanged:!1},gauge:{valueConversionChanged:!1},boxPlot:{showMeanChanged:!1},heatChart:{binningChanged:!1},scatterPlot:{tooltipFieldsChanged:!1}};switch(y.common.queryChanged=on({oldConfig:t,newConfig:r,behaviorAfterLimit:n?.chartLimits?.behaviorAfterLimit}),y.common.configFiltersChanged=ci(t,r),y.common.xOrYChanged=sn(c,l),y.common.filterBySelectionChanged=ln(a,n),y.common.dataForFilterBySelectionChanged=tr({currentSelectionOIDs:s,options:n}),y.common.binTemporalDataChanged=un(t,r),y.common.valueFormatChangeRequiresNewData=dn(t,r),y.common={...y.common,...an({oldSeries:c,newConfig:r,oldTimeIntervalInfo:o,setTimeBinningInfoWhenNotProvided:n?.setTimeBinningInfoWhenNotProvided})},m=Object.values(y.common).some(h=>h),d){case v.HistogramSeries:y.histogram.dataPropsChanged=Wr(c,l)||Kr(c,l);break;case v.LineSeries:case v.BarSeries:case v.ComboLineAndBarSeries:y.common.numberOfSeriesChanged=Wi(c,l);break;case v.BoxPlotSeries:y.common.numberOfSeriesChanged=Wi(c,l),y.boxPlot.showMeanChanged=cn(t,r);break;case v.GaugeSeries:y.gauge.valueConversionChanged=tn(t,r);break;case v.HeatSeries:y.heatChart.binningChanged=rn(t,r);break;case v.ScatterSeries:y.scatterPlot.tooltipFieldsChanged=nn({oldConfig:t,newConfig:r,fieldList:u});break}return(y.gauge.valueConversionChanged||y.histogram.dataPropsChanged||y.common.numberOfSeriesChanged||y.common.binTemporalDataChanged||y.boxPlot.showMeanChanged||y.heatChart.binningChanged||y.scatterPlot.tooltipFieldsChanged)&&(g=!0),f=e===!0||m||g,{dataUpdateNeeded:f,updateNeededDetails:y}}function As(i){return i.common.timeIntervalUnitChanged||i.common.newTimeBinningWillBeCalculated||i.common.dataForFilterBySelectionChanged||i.common.filterBySelectionChanged||i.common.configFiltersChanged||i.common.numberOfSeriesChanged||i.common.queryChanged||i.common.xOrYChanged}function fn(i,e){let t=!0;if(i!==void 0&&i.length>1&&!X(e)){let r=0,n=0,a=0;i.forEach(o=>{let s=o[e];!ui(s)||s===0?a+=1:s>0?r+=1:n+=1}),t=a===i.length||r>=0&&n===0||r===0&&n>=0}return t}function mt(i){let{countTotal:e,countPerSeries:t,numberOfSeries:r}=i,n,a=[];return typeof e=="number"&&Number.isFinite(e)&&a.push(e),typeof t=="number"&&Number.isFinite(t)&&a.push(t*r),a.length>0&&(n=Math.min(...a)),n}function ir(i,e){let t,{maxBarChartSeriesCount:r,maxBarUniqueSeriesCountTotal:n,maxBarTwoSeriesCountPerSeries:a,maxBarTwoSeriesCountTotal:o,maxBarThreePlusSeriesCountPerSeries:s,maxBarThreePlusSeriesCountTotal:u,maxLineChartSeriesCount:l,maxLineUniqueSeriesCountTotal:c,maxLineTwoSeriesCountPerSeries:d,maxLineTwoSeriesCountTotal:f,maxLineThreePlusSeriesCountPerSeries:m,maxLineThreePlusSeriesCountTotal:g,maxPieChartSliceCountTotal:y,maxGaugeByFeaturesLimit:h}=Pe(e),F=R(i.series),S=i.series.length===0?1:i.series.length,C=I(i.series);switch(F){case v.ComboLineAndBarSeries:case v.BarSeries:S<=r&&(S===1?t=n:S===2?t=mt({countTotal:o,countPerSeries:a,numberOfSeries:S}):S>2&&(t=mt({countTotal:u,countPerSeries:s,numberOfSeries:S})));break;case v.LineSeries:S<=l&&(S===1?t=c:S===2?t=mt({countTotal:f,countPerSeries:d,numberOfSeries:S}):S>2&&(t=mt({countTotal:g,countPerSeries:m,numberOfSeries:S})));break;case v.PieSeries:t=y;break;case v.GaugeSeries:t=h;break;case v.ScatterSeries:case v.HistogramSeries:case v.BoxPlotSeries:}return(C===p.BarAndLineNoAggregation||C===p.BarAndLineMultiFields)&&t!==void 0&&(t=Math.ceil(t/S)),t}function Qi(i,e){let t=i;if(Number.isFinite(i)){let{factor:r,offset:n}=e??{};Number.isFinite(r)&&(t*=r),Number.isFinite(n)&&(t+=n)}return t}function mn(i){let e=!1;if(i!==void 0){let t=i.replace(" ",""),r=/^%(0*100{1,1}\.?((?:\.)0*)?$)|(^%0*\d{0,2}\.?((?:\.)\d*)?)$/u,n=/^(0*100{1,1}\.?((?:\.)0*)?%$)|(^0*\d{0,2}\.?((?:\.)\d*)?%)$/u;e=r.test(t)||n.test(t)}return e}function Ts(i){let e;if(mn(i)){let t=/%(\d{1,3}(.\d+)?)$/u,r=/(\d{1,3}(.\d+)?)%$/u,n=i.replace(" ",""),a=t.exec(n)?.[1]??r.exec(n)?.[1];a!==void 0&&(e=Number(a))}return e}var de={DataProcessComplete:"arcgisChartsJSDataProcessComplete",DataFetchComplete:"arcgisChartsJSDataFetchComplete",LegendItemVisibilityChange:"arcgisChartsJSLegendItemVisibilityChange",UpdateComplete:"arcgisChartsJSUpdateComplete",RenderingComplete:"arcgisChartsJSRenderingComplete",SeriesColorsChange:"arcgisChartsJSSeriesColorChange",AxesMinMaxChange:"arcgisChartsJSAxesMinMaxChange",SelectionComplete:"arcgisChartsJSSelectionComplete",TooManySelectedElements:"arcgisChartsJSTooManySelectedElements",BadDataWarningRaise:"arcgisChartsJSBadDataWarningRaise",SeriesOrder:"arcgisChartsJSSeriesOrder"};function fe(i){return{detail:i,composed:!0,cancelable:!0,bubbles:!0}}function qs(i){let{data:e,seriesConfig:t,htmlContainer:r}=i;if(r&&e){let n=Xi({data:e,seriesConfig:t});r.dispatchEvent(new window.CustomEvent(de.DataProcessComplete,fe(n)))}}function Ps(i){let{data:e,chartConfig:t,htmlContainer:r}=i;if(r&&e){let n=vo(e,t);r.dispatchEvent(new window.CustomEvent(de.DataFetchComplete,fe(n)))}}function Ls(i,e){e&&e.dispatchEvent(new window.CustomEvent(de.LegendItemVisibilityChange,fe(i)))}function Os(i,e){e&&e.dispatchEvent(new window.CustomEvent(de.UpdateComplete,fe(i)))}function Is(i){i&&i.dispatchEvent(new window.CustomEvent(de.RenderingComplete,fe()))}function Es(i){let{data:e,seriesConfig:t,htmlContainer:r}=i;if(r){let n=e,a=Se(e.selectionItems);a&&(a=Yi(a,t),a=a.map(_t),a=Zi(a,t),n.selectionItems=a),r.dispatchEvent(new window.CustomEvent(de.SelectionComplete,fe(n)))}}function Ds(i){i&&i.dispatchEvent(new window.CustomEvent(de.TooManySelectedElements,fe()))}function Vs(i){let{data:e,htmlContainer:t,chartId:r,colorMatchApplied:n}=i;t&&t.dispatchEvent(new window.CustomEvent(de.SeriesColorsChange,fe({chartId:r,data:e,colorMatchApplied:n})))}function $s(i,e){e&&e.dispatchEvent(new window.CustomEvent(de.AxesMinMaxChange,fe(i)))}function js(i,e){e&&e.dispatchEvent(new window.CustomEvent(de.BadDataWarningRaise,fe(i)))}function gn(i){let{data:e,htmlContainer:t}=i;t&&e&&t.dispatchEvent(new window.CustomEvent(de.SeriesOrder,fe(e)))}function ks(i,e){let t,r,n,a;return oe(i.series[0])&&(t=i.series[0].temporalBinning?.unit,n=i.series[0].temporalBinning?.size),oe(e.series[0])&&(r=e.series[0].temporalBinning?.unit,a=e.series[0].temporalBinning?.size),kt(t,n)&&!kt(r,a)}function Rs(i,e){return i.axes?.length===3&&e.axes?.length===2||i.axes?.length===2&&e.axes?.length===3}function _s(i,e){return JSON.stringify(i.series.map(t=>t.assignToSecondValueAxis??!1))!==JSON.stringify(e.series.map(t=>t.assignToSecondValueAxis??!1))}function Ks(i,e){let t=i.axes?.map(n=>n?.guides?.map(a=>a?.above===!0)),r=e.axes?.map(n=>n?.guides?.map(a=>a?.above===!0));return JSON.stringify(t)!==JSON.stringify(r)}function Ws(i,e){return wt(i)!==wt(e)}function Qs(i){return R(i.series)!==v.BoxPlotSeries?b.xAxisField:i.series[0].x}function Hs(i){let e=Mt(i);return e===De.Stacked||e===De.Stacked100}function Gs(i,e){return(i.showOutliers??b.boxPlot.boxPlotOutliersVisibility)!==(e.showOutliers??b.boxPlot.boxPlotOutliersVisibility)}function zs(i,e){return(i.standardizeValues??b.boxPlot.boxPlotStandardizeValuesVisibility)!==(e.standardizeValues??b.boxPlot.boxPlotStandardizeValuesVisibility)}function Js(i,e){return JSON.stringify(i.chartRenderer)!==JSON.stringify(e.chartRenderer)}function Us(i,e){let t=i.axes?.[0].valueFormat.type===v.DateAxisFormat?i.axes[0].valueFormat.intlOptions.timeZone:void 0,r=e.axes?.[0].valueFormat.type===v.DateAxisFormat?e.axes[0].valueFormat.intlOptions.timeZone:void 0;return t!==r}function yn(i,e){return i.series.map(t=>t.name).join()!==e.series.map(t=>t.name).join()}function hn(i,e){let t=i.orderOptions?.series,r=e.orderOptions?.series,n=(t?.orderBy??le.Ascending)!==(r?.orderBy??le.Ascending),a=(t?.preferLabel??!0)!==(r?.preferLabel??!0);return n||a}function Zs(i,e){return hn(i,e)||yn(i,e)}function pn(i){let e=I(i.series),t;if(i.orderOptions?.data!==void 0){let r=i.orderOptions?.data?.orderType??Fe.Category,n=i.orderOptions?.data?.orderBy;if(r===Fe.Category)r=i.series[0].x;else{r===Fe.Mean?r=D.Average:r===Fe.Median&&(r=D.Median);let a=e===p.BoxPlotMultiFieldsAndCategory&&typeof i.series[0].y=="string"?i.series[0].y:void 0,o=J(i.series[0].query?.where),s=ue({where:i.series[0].query?.where});r=z({key:r,y:a,chartSubType:e,splitBy:o,splitByValue:s}),Array.isArray(n)&&(n=le.Ascending)}t={sortingField:r,orderBy:n??le.Ascending,preferLabel:i.orderOptions.data.preferLabel??!0}}return t}function vn(i){let e;if(!rr(i)&&i.series?.length>0&&i.orderOptions?.data?.orderType===Fe.Category){let t;ve(i.axes?.[0]?.valueFormat)?t=j.xField:ve(i.axes?.[1]?.valueFormat)&&(t=j.yField),t&&(e={sortingField:t,orderBy:i.orderOptions?.data?.orderBy??le.Ascending})}return e}function bn(i){let e=i.series[0],{x:t,y:r}=e,n=I(i.series)===p.PieFromFields,a=I(i.series)===p.BarAndLineFromFields,o,s="",u;if(i.orderOptions?.data!==void 0){if(s=i.orderOptions?.data?.orderType??Fe.Category,u=i.orderOptions?.data?.orderBy,s===Fe.Category?s=n?ne:t:s=n?ge:[r].flat()[0],s!==void 0&&s!==""){let l=Mt(i);if(R(i.series)!==v.PieSeries&&s!==t&&i.series?.length>1)switch(l){case De.Stacked:s=b.technicalSortingFieldBySum;break;case De.Stacked100:s=b.technicalSortingFieldByPercent;break;case De.Side:typeof r=="string"&&(s=r);break}o={sortingField:s,orderBy:u??le.Ascending,preferLabel:i.orderOptions.data.preferLabel??!0}}}else(a||n)&&i.series[0].query?.outStatistics&&(u=i.series[0].query.outStatistics.map(l=>l.onStatisticField),u?.length>1&&(o={sortingField:Ui.originalCategoryValue,orderBy:u,preferLabel:!1}));return o}function Kt(i){let e,t=R(i.series);if(t===v.HeatSeries)e=vn(i);else if(i.series?.length>0)switch(t){case v.BoxPlotSeries:e=pn(i);break;case v.LineSeries:case v.BarSeries:case v.PieSeries:e=bn(i);break}return e}function Ys(i){let{oldConfig:e,newConfig:t,dataUpdateNeeded:r}=i,n=I(t.series),a=!1,o=!1;if(n!==p.BoxPlotMonoField&&n!==p.BoxPlotMonoFieldAndSplitBy&&t.orderOptions?.data!==void 0){let s=Kt(e),u=Kt(t);o=e.orderOptions?.data?.orderType!==t.orderOptions?.data?.orderType||s?.sortingField!==u?.sortingField||s?.orderBy!==u?.orderBy||(s?.preferLabel??!0)!==(u?.preferLabel??!0),a=o||r}return a}function Xs(i,e){let t=[],r=new Map,n=new Map;return i.forEach((a,o)=>n.set(a.id,o)),e.forEach((a,o)=>{let s=n.get(a.id);if(s!==void 0){let u=new Set;for(;r.has(s)&&!u.has(s);)u.add(s),s=r.get(s)??s;s!==o&&(t.push([s,o]),r.set(o,s))}}),t}function el(i,e){let t=Se(i);if(t&&t.series.length>1){let{preferLabel:r,orderBy:n}=t.orderOptions?.series??{};if(n!==void 0){let a;if(r===!1){let o=I(t.series);a=Tt(o)?"splitByValue":"name"}else a="name";t.series.sort((o,s)=>{let u,l;a==="splitByValue"?(u=ue({where:o.query?.where})??"",l=ue({where:s.query?.where})??""):(u=o.name,l=s.name);let[c,d]=n.toUpperCase()===le.Descending?[l,u]:[u,l];return typeof c=="string"&&typeof d=="string"?c.localeCompare(d):Number(c)-Number(d)})}}return gn({data:t?.series.map(r=>r.id),htmlContainer:e}),t}function Sn(i){let e={...i};return i.showMean===!0&&(e.series=[e.series[0]],e.series[0].query?.where!==void 0&&delete e.series[0].query.where),e}function rr(i){let e=!1;return i&&(e=i.series[0].type===v.HeatSeries&&ve(i.axes?.[0]?.valueFormat)&&ve(i.axes?.[1]?.valueFormat)),e}function ht(i){let{dataInfo:e,chartType:t,subError:r}=i;switch(e.valid=!1,t){case v.BarSeries:case v.ComboLineAndBarSeries:e.invalidType=V.BarElementExceedsLimit;break;case v.LineSeries:e.invalidType=V.LineChartExceedsLimit;break;case v.PieSeries:e.invalidType=V.PieChartExceedsLimit;break;case v.GaugeSeries:e.invalidType=V.GaugeExceedsLimit;break;case v.BoxPlotSeries:r?.outlierLimit===!0?e.invalidType=V.BoxPlotOutliersExceedsLimit:e.invalidType=V.BoxPlotExceedsLimit;break;case v.HeatSeries:e.invalidType=V.HeatChartExceedsLimit;break}}function Fn(i,e){i.valid=!1,i.invalidType=e}async function tl(i){let{invalidType:e,chartLimits:t,elementCount:r,seriesCount:n,queryObject:a,filterBySelection:o,formatLocale:s=Di(document.documentElement),isTemporalLineChart:u,errorStrings:l}=i,c=l.errors.defaultInvalidChart,d,f=new Intl.NumberFormat(s),m=Pe(t),{maxCategoryCount:g}=m,y=l.modalHeaders.invalidChart;switch(e){case V.BarElementExceedsLimit:{y=l.modalHeaders.tooManyFeatures;let h=Number.NaN,F=Number.NaN,S="";n!==void 0&&(n<=m.maxBarChartSeriesCount?n===1?(S=l.errors.uniqueSeriesBarCountCannotExceedLimit,h=m.maxBarUniqueSeriesCountTotal):n===2?(S=l.errors.twoSeriesBarCountCannotExceedLimit,h=m.maxBarTwoSeriesCountTotal,F=m.maxBarTwoSeriesCountPerSeries):n>2&&(S=l.errors.threePlusSeriesBarCountCannotExceedLimit,h=m.maxBarThreePlusSeriesCountTotal,F=m.maxBarThreePlusSeriesCountPerSeries):(S=l.errors.barSeriesCountCannotExceedLimit,F=m.maxBarChartSeriesCount));let C=f.format(h),x=f.format(F),B=r!==void 0?f.format(r):"";c=pe(S,{totalLimit:C,seriesLimit:x,elementCount:B}),d={actualCount:r??Number.NaN,totalLimit:h,seriesLimit:F};break}case V.LineChartExceedsLimit:{y=l.modalHeaders.tooManyFeatures;let h=Number.NaN,F=Number.NaN,S="";n!==void 0&&(n<=m.maxLineChartSeriesCount?n===1?(S=u?l.errors.uniqueTemporalSeriesLineCountCannotExceedLimit:l.errors.uniqueSeriesLineCountCannotExceedLimit,h=m.maxLineUniqueSeriesCountTotal):n===2?(S=u?l.errors.twoTemporalSeriesLineCountCannotExceedLimit:l.errors.twoSeriesLineCountCannotExceedLimit,h=m.maxLineTwoSeriesCountTotal,F=m.maxLineTwoSeriesCountPerSeries):n>2&&(S=u?l.errors.threePlusTemporalSeriesLineCountCannotExceedLimit:l.errors.threePlusSeriesLineCountCannotExceedLimit,h=m.maxLineThreePlusSeriesCountTotal,F=m.maxLineThreePlusSeriesCountPerSeries):(S=l.errors.lineSeriesCountCannotExceedLimit,F=m.maxLineChartSeriesCount));let C=f.format(h),x=f.format(F),B=r!==void 0?f.format(r):"";c=pe(S,{elementCount:B,seriesLimit:x,totalLimit:C}),d={actualCount:r??Number.NaN,totalLimit:h,seriesLimit:F}}break;case V.BoxPlotExceedsLimit:{y=l.modalHeaders.tooManyFeatures;let h=Number.NaN,F=Number.NaN,S="";n!==void 0&&(n<=m.maxBoxPlotSeriesCount?n===1?(S=l.errors.uniqueSeriesBoxCountCannotExceedLimit,h=m.maxBoxUniqueSeriesCountTotal):n===2?(S=l.errors.twoSeriesBoxCountCannotExceedLimit,h=m.maxBoxTwoSeriesCountTotal,F=m.maxBoxTwoSeriesCountPerSeries):n>2&&(S=l.errors.threePlusBoxLineCountCannotExceedLimit,h=m.maxBoxThreePlusSeriesCountTotal,F=m.maxBoxThreePlusSeriesCountPerSeries):(S=l.errors.boxSeriesCountCannotExceedLimit,F=m.maxBoxPlotSeriesCount));let C=f.format(h),x=f.format(F),B=r!==void 0?f.format(r):"";c=pe(S,{elementCount:B,seriesLimit:x,totalLimit:C}),d={actualCount:r??Number.NaN,totalLimit:h,seriesLimit:F}}break;case V.BoxPlotOutliersExceedsLimit:{y=l.modalHeaders.tooManyFeatures;let h=l.errors.boxSeriesOutlierCannotExceedLimit,F=m.maxBoxPlotOutlierLimit,S=f.format(F);c=pe(h,{totalLimit:S}),d={actualCount:r??Number.NaN,totalLimit:F}}break;case V.HeatChartExceedsLimit:{y=l.modalHeaders.tooManyFeatures;let h=l.errors.heatChartCannotExceedLimit,F=m.maxHeatChartCellLimit,S=f.format(F),C=r!==void 0?f.format(r):"";c=pe(h,{featureCount:C,totalLimit:S}),d={actualCount:r??Number.NaN,totalLimit:F}}break;case V.PieChartExceedsLimit:{y=l.modalHeaders.tooManyFeatures;let h=l.errors.pieChartSlicesCannotExceedLimit,F=m.maxPieChartSliceCountTotal,S=f.format(F),C=r!==void 0?f.format(r):"";c=pe(h,{sliceCount:C,totalLimit:S}),d={actualCount:r??Number.NaN,totalLimit:F}}break;case V.GaugeExceedsLimit:{y=l.modalHeaders.tooManyFeatures;let h=l.errors.gaugeCannotExceedLimit,F=m.maxGaugeByFeaturesLimit,S=f.format(F),C=r!==void 0?f.format(r):"";c=pe(h,{featureCount:C,totalLimit:S}),d={actualCount:r??Number.NaN,totalLimit:F}}break;case V.PieChartMixOfNegativePositiveSlices:y=l.modalHeaders.cannotCombineNegativeAndPositiveSlices,c=l.errors.pieChartCannotHaveMixtureOfPositiveAndNegativeSlices;break;case V.NegativeValueInSqrtCalculation:y=l.modalHeaders.invalidData,c=l.errors.negativeValueInDataForSqrtTransformation;break;case V.NegativeValueInLogCalculation:y=l.modalHeaders.invalidData,c=l.errors.negativeValueInDataForLogTransformation;break;case V.HistogramEmptyField:c=l.errors.histogramEmptyField;break;case V.EmptyDataSet:y=l.modalHeaders.noDataAvailable,o===!0?c=l.errors.noDataFBSMessage:mi(a)?c=l.errors.noDataFBEMessage:c=l.errors.noDataMessage;break;case V.NegativeValueInXAxisLogScale:c=l.errors.logarithmicXAxisNotPossible;break;case V.NegativeValueInYAxisLogScale:c=l.errors.logarithmicYAxisNotPossible;break;case V.BadData:}if(c===l.errors.defaultInvalidChart&&(e===V.BarElementExceedsLimit||e===V.LineChartExceedsLimit||e===V.HeatChartExceedsLimit||e===V.PieChartExceedsLimit||e===V.GaugeExceedsLimit||e===V.BoxPlotExceedsLimit)&&typeof r=="number"&&typeof n=="number"&&r/n>g){let h=r/n;c=pe(l.errors.categoryCountCannotExceedLimit,{categoryCount:f.format(h),maxCategoryCount:f.format(g)})}return{keyword:e??V.BadData,header:y,message:c,params:d}}function Qe(i,e){return`${e}_${i}`}function Wt(i){let{value:e,mean:t,stdDev:r}=i;return(e-t)/r}function Ht(i){let{dataItem:e,chartSubType:t,y:r,splitByValue:n,meanPerField:a,stdDevPerField:o}=i,s=e,u={chartSubType:t,y:r,splitByValue:n},l=z({...u,key:D.Average}),c=z({...u,key:D.StandardDeviation}),d=a??Number(e[l]),f=o??Number(e[c]);return Number.isFinite(d)&&Number.isFinite(f)&&Object.values(D).forEach(m=>{let g=z({key:m,y:r,chartSubType:t,splitByValue:n}),y=e[g];if(y!=null){let h=Number(y);if(Number.isFinite(h)){u={...u,key:m,showOutliers:!1,standardizeValues:!0};let F=z(u);if(s[F]=Wt({mean:d,stdDev:f,value:h}),m===D.Min||m===D.Max){u={...u,key:m,showOutliers:!0,standardizeValues:!0},F=z(u),u={...u,standardizeValues:!1,splitByValue:n};let S=z(u);h=Number(e[S]),Number.isFinite(h)&&(s[F]=Wt({mean:d,stdDev:f,value:h}))}}}}),s}function Cn(i){let{data:e,yList:t,calculateZScore:r=!1}=i,n=e[0],a=new Map;return t.forEach(o=>{let s={};Object.keys(n).forEach(u=>{u.startsWith(o)?s[u.replace(`${o}_`,"")]=n[u]:u.includes(b.rendererSymbolField)&&(s[u]=n[u]),s[b.boxPlot.boxPlotCategory]=o,r&&(s=Ht({dataItem:s,chartSubType:p.BoxPlotMultiFields}))}),a.set(o,s)}),Array.from(a.values())}function xn(i){let{data:e,splitByField:t,y:r}=i,n={[b.boxPlot.boxPlotCategory]:r};return e.forEach(a=>{let o=a[t];o!==void 0&&Object.keys(a).forEach(s=>{s===b.rendererSymbolField?n[`${s}_${o?.toString()}`]=a[s]:s===b.boxPlot.boxPlotMeanLineMarkerId?n[s]=a[s]:n[`${o?.toString()}_${s}`]=a[s]})}),[n]}function Bn(i){let{splitByField:e,data:t,yList:r,calculateZScore:n=!1,meanAndStdDevPerField:a}=i,o=new Map;return t.forEach(s=>{let u=s[e];r.forEach(l=>{let c={[b.boxPlot.boxPlotCategory]:l};Object.entries(s).forEach(([d,f])=>{d.startsWith(`${l}_`)?c[`${u}_${d.replace(`${l}_`,"")}`]=f:d.includes(b.rendererSymbolField)?c[`${d}_${u}`]=f:d===b.boxPlot.boxPlotMeanLineMarkerId&&(c[d]=s[d])}),n&&(c=Ht({dataItem:c,chartSubType:p.BoxPlotMultiFieldsAndSplitBy,splitByValue:u,meanPerField:a?.[Qe(l,T.Average)],stdDevPerField:a?.[Qe(l,T.StandardDeviation)]})),o.set(l,{...o.get(l)??{},...c})})}),Array.from(o.values())}function Nn(i){let{data:e,yList:t,calculateZScore:r=!1,meanAndStdDevPerField:n}=i,a=e;return r&&a.forEach(o=>{t.forEach(s=>{Ht({dataItem:o,chartSubType:p.BoxPlotMultiFieldsAndCategory,y:s,meanPerField:n?.[Qe(s,T.Average)],stdDevPerField:n?.[Qe(s,T.StandardDeviation)]})})}),a}function wn(i){let{splitByField:e,x:t,data:r}=i,n=new Map;return r.forEach(a=>{let o=a[t],s={[t]:o},u=a[e];Object.entries(a).forEach(([l,c])=>{if(l.includes(b.rendererSymbolField))s[`${b.rendererSymbolField}_${u?.toString()}`]=c;else if(l===b.boxPlot.boxPlotMeanLineMarkerId)s[l]=a[l];else if(l!==e&&l!==t){let d=l!==b.xAxisField&&l!==b.originalCategoryValue?`${u?.toString()}_${l}`:l;s[d]=c}}),n.set(o,{...n.get(o)??{},...s})}),Array.from(n.values())}function Mn(i,e){let{series:t}=i,r=t[0],{y:n}=r,a=I(i.series),o={y:a===p.BoxPlotMultiFieldsAndCategory?n:void 0,chartSubType:a},s=i.series.map(u=>{let l=ue({where:u.query?.where,normalize:!1,escape:!0});return l!==null&&`${l}`.startsWith("'")&&`${l}`.endsWith("'")&&(l=l.substring(1,l.length-1)),l});s.length===0&&s.push(" "),e.forEach(u=>{s.forEach(l=>{o.splitByValue=l;let c=z({...o,key:D.Min,showOutliers:!0}),d=z({...o,key:D.Min,showOutliers:!1}),f=z({...o,key:D.Max,showOutliers:!0}),m=z({...o,key:D.Max,showOutliers:!1});u[f]===void 0&&u[m]!==void 0&&(u[f]=u[m]),u[c]===void 0&&u[d]!==void 0&&(u[c]=u[d])})})}function An(i,e){let t,r,n=i[e[D.IQR]],a=i[e[D.FirstQuartile]],o=i[e[D.ThirdQuartile]];return Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(o)&&(t=a-n*1.5,r=o+n*1.5),{outlierMinThreshold:t,outlierMaxThreshold:r}}function Hi(i){let{yField:e,xField:t,xValue:r,splitByField:n,splitByValue:a,outlierMaxThreshold:o,outlierMinThreshold:s,target:u}=i,l;if(t!==void 0&&r!==void 0){let f=typeof r!="string"?r:`'${At(r)}'`;l=`${t}=${f.toString()}`}let c;if(n!==void 0&&a!==void 0){let f=typeof a!="string"?a:`'${At(a)}'`;c=`${n}=${f.toString()}`}let d;return u==="outliers"&&s!==o?d=`(${e}<${s} OR ${e}>${o})`:u==="alternativeData"&&(s===o?d=`(${e}=${s})`:d=`(${e}>=${s} AND ${e}<=${o})`),[l,c,d].filter(f=>f!==void 0).join(" AND ")}function nr(i){let{data:e,yField:t,x:r,chartSubType:n,splitByField:a}=i,o=n===p.BoxPlotMonoField||n===p.BoxPlotMonoFieldAndCategory||n===p.BoxPlotMonoFieldAndSplitBy||n===p.BoxPlotMonoFieldAndCategoryAndSplitBy?void 0:t,s=je(o),u=[],l=[],{maxOperandsPerWhereClause:c}=$e(),d=[],f=[],m=1;return e.forEach((g,y)=>{let{outlierMinThreshold:h,outlierMaxThreshold:F}=An(g,s);if(typeof h=="number"&&typeof F=="number"){let S={yField:t,outlierMinThreshold:h,outlierMaxThreshold:F};(n===p.BoxPlotMonoFieldAndCategory||n===p.BoxPlotMultiFieldsAndCategory||n===p.BoxPlotMonoFieldAndCategoryAndSplitBy)&&r!==void 0&&r in g&&(S.xField=r,S.xValue=Ze({value:g[r],dataContext:g,keepNullValues:!0,specificField:b.typeOrDomainIdValue})),(n===p.BoxPlotMonoFieldAndSplitBy||n===p.BoxPlotMultiFieldsAndSplitBy||n===p.BoxPlotMonoFieldAndCategoryAndSplitBy)&&a!==void 0&&a in g&&(S.splitByField=a,S.splitByValue=g[a]),d.push(Hi({...S,target:"outliers"})),f.push(Hi({...S,target:"alternativeData"})),(m%c===0||y===e.length-1)&&(u.push(K(d,"OR")),l.push(K(f,"OR")),d=[],f=[])}m+=1}),{outliersFilterBatches:u,dataWithoutOutliersFilterBatches:l}}function Tn(i){let{data:e,outlierDataItem:t,chartSubType:r,x:n,y:a,meanAndStdDevPerField:o,splitByField:s}=i,u=o?.[Qe(a,T.Average)],l=o?.[Qe(a,T.StandardDeviation)];if(u===void 0&&l===void 0)switch(r){case p.BoxPlotMultiFields:{let c=je(a),d=e[0];u=Number(d[c[D.Average]]),l=Number(d[c[D.StandardDeviation]]);break}case p.BoxPlotMultiFieldsAndCategory:{let c=e.find(d=>d[n]===t[n]);if(c!==void 0){let d=je(a);u=Number(c[d[D.Average]]),l=Number(c[d[D.StandardDeviation]])}break}case p.BoxPlotMultiFieldsAndSplitBy:{let c=e.find(d=>d[s]===t[s]);if(c!==void 0){let d=je(a);u=Number(c[d[D.Average]]),l=Number(c[d[D.StandardDeviation]])}break}}return{mean:u,stdDev:l}}async function qn(i){let{seriesConfig:e,data:t,uniqueQuery:r,queryObject:n,meanAndStdDevPerField:a,abortKey:o}=i,s=I(e),u=e[0],{x:l}=u,c=J(u.query?.where),d=W(n),f=se(e),m=[];for(let h=0;h<f.length;h+=1){let F=f[h],{outliersFilterBatches:S}=nr({data:t,yField:F,x:l,chartSubType:s,splitByField:c});for(let C=0;C<S.length;C+=1){let x=S[C];if(x!==""){let B=[];l!==b.boxPlot.boxPlotCategory&&B.push(l),B.push(F),c!==""&&B.push(c),B.push(d.objectIdField);let M={...r,where:K([r.where,x]),groupByFieldsForStatistics:void 0,outStatistics:void 0,orderByFields:void 0,num:void 0,outFields:B};m.push(ce({queryObject:n,queryConfig:M,featureCount:1,abortKey:o}))}}}let g=await Promise.all(m),y=new Map;for(let h=0;h<g.length;h+=1){let F=g[h],S=f[h];F.forEach(C=>{let x={...C.attributes};if(x[S]!==void 0){l===b.boxPlot.boxPlotCategory&&(x[b.boxPlot.boxPlotCategory]=S);let B={key:D.Outlier,chartSubType:s};switch(s){case p.BoxPlotMonoFieldAndSplitBy:case p.BoxPlotMultiFieldsAndSplitBy:case p.BoxPlotMonoFieldAndCategoryAndSplitBy:B={...B,splitByValue:x[c]};break;case p.BoxPlotMultiFieldsAndCategory:B={...B,y:S};break}let M=z(B),w=x[S];x[M]=w;let A=`${x[l]}-${x[c]}-${w}`,N=y.get(A);if(x[G.uniqueIdsName]=[...N?.[G.uniqueIdsName]??[],x[d.objectIdField]],delete x[d.objectIdField],di(s)){let P=z({...B,standardizeValues:!0}),{mean:L,stdDev:E}=Tn({data:t,outlierDataItem:x,chartSubType:s,x:l,y:S,splitByField:c,meanAndStdDevPerField:a});L!==void 0&&E!==void 0&&(x[P]=Wt({value:w,mean:L,stdDev:E}))}delete x[S],x[b.boxPlot.boxPlotOutlierId]=!0,y.set(A,x)}})}return Array.from(y.values())}async function Pn(i){let{data:e,queryObject:t,uniqueQuery:r,elementCount:n,chartConfig:a,chartLimits:o,abortKey:s}=i,u=[],{series:l,showMean:c}=a,d=ut({showMean:c,seriesConfig:l}),f=I(l),m=we(a),{x:g}=m,y=J(m.query?.where),h=[];for(let S=0;S<d.length;S+=1){let C=d[S],{dataWithoutOutliersFilterBatches:x}=nr({data:e,yField:C,x:g,chartSubType:f,splitByField:y});for(let B=0;B<x.length;B+=1){let M=x[B],w={...r,where:K([r.where,M])};w.outStatistics!==void 0&&(w.outStatistics=w.outStatistics?.filter(A=>(A.statisticType===T.Minimum||A.statisticType===T.Maximum)&&A.onStatisticField===C).map(A=>({...A,outStatisticFieldName:`${A.outStatisticFieldName}${b.boxPlot.boxPlotOutliersSuffix}`}))),h.push(vt({queryObject:t,uniqueQuery:w,chartConfig:a,elementCount:n,isTimeBinningSeries:!1,showMean:c,chartLimits:o,abortKey:s}))}}let F=await Promise.all(h);for(let S=0;S<F.length;S+=1)u.push(...F[S]);return f!==p.BoxPlotMonoFieldAndCategoryAndSplitBy&&(u=zt({data:u,x:y!==void 0&&y!==""?y:g})),u}async function Ln(i){let{queryObject:e,uniqueQuery:t,chartConfig:r,abortKey:n}=i,a,{series:o,showMean:s}=r,u=I(o);if(u===p.BoxPlotMultiFieldsAndCategory||u===p.BoxPlotMultiFieldsAndSplitBy){let l=ut({showMean:s,seriesConfig:o}),c={...t};delete c.outStatistics,delete c.groupByFieldsForStatistics,delete c.orderByFields;let d=[];for(let m=0;m<l.length;m+=1){let g=l[m];d.push({statisticType:T.Average,onStatisticField:g,outStatisticFieldName:`${T.Average}_${g}`},{statisticType:T.StandardDeviation,onStatisticField:g,outStatisticFieldName:`${T.StandardDeviation}_${g}`})}c.outStatistics=d;let f=await ce({queryObject:e,queryConfig:c,featureCount:1,abortKey:n});f.length>0&&(a=f[0].attributes)}return a}function On(i){let{data:e,additionalData:t,chartConfig:r}=i,n=r.series[0],{x:a}=n,o=J(n.query?.where);return e.map(s=>{let u=s,l=t.find(c=>c[a]===s[a]&&(o===""?!0:c[o]===s[o]));return l!==void 0&&(u={...s,...l}),u})}function ar(i){let{chartConfig:e,data:t,calculateZScore:r=!1,meanAndStdDevPerField:n}=i,{series:a,showMean:o}=e,s=we(e),u=I(e.series),{x:l}=s,c=ut({showMean:o,seriesConfig:a}),d=t;if((s.type===v.LineSeries||s.type===v.BoxPlotSeries)&&t?.[0]!==void 0){let f=J(s.query?.where);switch(u){case p.BoxPlotMonoField:d[0][b.boxPlot.boxPlotCategory]=c[0];break;case p.BoxPlotMultiFields:d=Cn({data:t,yList:c,calculateZScore:r});break;case p.BoxPlotMonoFieldAndSplitBy:d=xn({data:t,splitByField:f,y:c[0]});break;case p.BoxPlotMultiFieldsAndSplitBy:d=Bn({splitByField:f,data:t,yList:c,meanAndStdDevPerField:n,calculateZScore:r});break;case p.BoxPlotMultiFieldsAndCategory:d=Nn({data:t,yList:c,meanAndStdDevPerField:n,calculateZScore:r});break;case p.BoxPlotMonoFieldAndCategoryAndSplitBy:d=wn({splitByField:f,x:l,data:t});break;case p.BoxPlotMonoFieldAndCategory:}}return Mn(e,d),d}async function In(i){let{data:e,queryObject:t,uniqueQuery:r,fetchFullBoxPlotData:n,chartConfig:a,elementCount:o,chartLimits:s,abortKey:u}=i,l=e,c=[];if(l!==void 0){let{series:d}=a,f=await Ln({queryObject:t,uniqueQuery:r,chartConfig:a,abortKey:u});if(n!==!1){c=await qn({queryObject:t,uniqueQuery:r,seriesConfig:d,data:l,abortKey:u});let m=await Pn({queryObject:t,uniqueQuery:r,elementCount:o,data:e,chartConfig:a,chartLimits:s,abortKey:u});l=On({data:l,additionalData:m,chartConfig:a})}l=ar({chartConfig:a,data:l,meanAndStdDevPerField:f,calculateZScore:!0})}return{dataItems:l,outliers:c}}function En(i){let{whereValue:e,outStatistics:t,y:r}=i,n=G.outStatistics.outStatisticFieldName??"";return t?.outStatisticFieldName!==void 0?n=t.outStatisticFieldName:t?.onStatisticField!==void 0&&t.statisticType!==void 0?n=`${t.statisticType}_${t.onStatisticField}_${e}`:r!==void 0&&(n=[r].flat()[0]),n}function Dn(i){let e=new Map;for(let t=0;t<i.length;t+=1){let r=i[t],n=r.query?.where;if(n!==void 0&&"y"in r){let a=ue({where:n,normalize:!0,escape:!1});if(a!==""){let o=En({whereValue:a,outStatistics:r.query?.outStatistics?.[0],y:r.y});r.y=o,e.set(a,o)}}}return e}function Vn(i){let{uniqueQuery:e,splitByField:t,x:r}=i,n=[...e.groupByFieldsForStatistics??[],r,t].filter(a=>a!==void 0&&a.trim()!==""&&a!==xt);e.groupByFieldsForStatistics=Array.from(new Set(n))}function $n(i){return i.statisticType===T.ContinuousPercentile||i.statisticType===T.DiscretePercentile}function jn(i){let{uniqueQuery:e,y:t,useGenericOutStatFieldName:r,queryObject:n,chartSubType:a,isTimeBinningSeries:o,returnFeaturesExtent:s,splitByField:u}=i,l=G.outStatistics;if(e.outStatistics?.[0]!==void 0){a!==p.PieFromFields&&a!==p.BarAndLineFromFields&&(e.outStatistics[0].outStatisticFieldName=r?l.outStatisticFieldName:[t].flat()[0]);let{outStatistics:c}=e;for(let d=0;d<c.length;d+=1){let f=e.outStatistics[d];f!==void 0&&$n(f)&&(o&&!ke(n)?(c[d].statisticType=T.Count,delete c[d].statisticParameters):c[d]={...c[d],statisticParameters:c[d].statisticParameters??{value:b.defaultStatParameterValue}})}}else if(n!==void 0){let{objectIdField:c}=W(n);e.outStatistics=[{statisticType:l.statisticType,onStatisticField:c,outStatisticFieldName:r?l.outStatisticFieldName:[t].flat()[0]}]}s===!0&&(!o||X(u))&&e.outStatistics?.push({statisticType:T.EnvelopeAggregate,onStatisticField:"1"})}function kn(i){let{chartConfig:e,fetchFullBoxPlotData:t}=i,{series:r}=e,n=Ue(e),a=[{statisticType:T.Average,suffix:D.Average}];t===!0&&(a=[...a,{statisticType:T.Minimum,suffix:D.Min},{statisticType:T.ContinuousPercentile,statisticParameters:{value:.25},suffix:D.FirstQuartile},{statisticType:T.ContinuousPercentile,statisticParameters:{value:.5},suffix:D.Median},{statisticType:T.ContinuousPercentile,statisticParameters:{value:.75},suffix:D.ThirdQuartile},{statisticType:T.Maximum,suffix:D.Max},{statisticType:T.StandardDeviation,suffix:D.StandardDeviation}]);let o=new Set;return n&&"y"in r[0]?[r[0].y].flat().forEach(s=>o.add(s)):r.forEach(s=>{"y"in s&&[s.y].flat().forEach(u=>o.add(u))}),[...o].flatMap(s=>a.map(u=>{let l={onStatisticField:s,statisticType:u.statisticType,outStatisticFieldName:`${s}_${u.suffix}`};return u.statisticType===T.ContinuousPercentile&&(l.statisticParameters=u.statisticParameters),l}))}function Rn(i,e){for(let t=1;t<e.length;t+=1){let r={...e[t].query?.outStatistics?.[0]};r!==void 0&&i.outStatistics!==void 0&&i.outStatistics.push(r)}}function _n(i){let{uniqueQuery:e,x:t,splitByField:r,unit:n,chartSubType:a,objectIdField:o}=i;if(n!==void 0){let s=fi(t,n);e.orderByFields=s,e.groupByFieldsForStatistics=s,a===p.BarAndLineSplitBy&&!X(r)?e.groupByFieldsForStatistics.push(r):a===p.BarAndLineNoAggregation&&(e.groupByFieldsForStatistics.push(o),e.outStatistics=[{onStatisticField:o,outStatisticFieldName:`COUNT_${o}`,statisticType:T.Count}])}}function or(i){let{chartConfig:e,options:t,uniqueQuery:r}=i;if(t?.chartLimits?.behaviorAfterLimit===qe.RenderUpToTheLimit){let n=ir(e,t?.chartLimits);if(n!==void 0){let a=I(e.series);if(a===p.PieFromFields||a===p.BarAndLineFromFields){if(r.outStatistics?.[0]!==void 0){let o=(l,c)=>l.statisticType===T.EnvelopeAggregate===c,s=r.outStatistics.filter(l=>o(l,!0)),u=r.outStatistics.filter(l=>o(l,!1));u.splice(n),r.outStatistics=[...u,...s]}}else r.num=n}}}async function pt(i){let{chartConfig:e,queryConfig:t,options:r,queryObject:n,timeIntervalInfo:a,fetchFullBoxPlotData:o}=i,{setTimeBinningInfoWhenNotProvided:s,returnFeaturesExtent:u}=r??{},l=e.series,c=I(l),d=we(e),{query:f,x:m}=d,g="y"in d?d.y:void 0,y=xe({xAxisValueFormatType:be(e),setTimeBinningInfoWhenNotProvided:s,seriesConfig:d}),h=new Map,F=!1,S=!1,C=!1,x=!1,B=!1,M={};if(f!==void 0){M=Se(f);let $=J(f.where),O="";switch(t.fetchNullValues!==!0&&(m!==b.boxPlot.boxPlotCategory&&(O=`${m} IS NOT NULL`),$.trim()!==""&&$!==m&&!lt(f.where)&&(O=K([O,`${$} IS NOT NULL`]))),c){case p.BarAndLineSplitBy:{h=Dn(l),x=!0,F=!0,S=!0;break}case p.BarAndLineMultiFields:Rn(M,l),S=!0;break;case p.PieFromFields:case p.BarAndLineFromFields:O="",C=!0,S=!0;break;case p.BarAndLineMonoField:case p.PieFromCategory:S=!0;break;case p.BoxPlotMonoField:case p.BoxPlotMultiFields:C=!0,B=!0;break;case p.BoxPlotMonoFieldAndCategory:case p.BoxPlotMultiFieldsAndCategory:case p.BoxPlotMonoFieldAndSplitBy:case p.BoxPlotMonoFieldAndCategoryAndSplitBy:case p.BoxPlotMultiFieldsAndSplitBy:{B=!0,x=!0,C=!0;break}case p.PieNoAggregation:case p.BarAndLineNoAggregation:case p.BarAndLineSplitByNoAggregation:}if(S&&jn({uniqueQuery:M,y:g,useGenericOutStatFieldName:F,queryObject:n,chartSubType:c,isTimeBinningSeries:y,returnFeaturesExtent:u,splitByField:$}),x&&Vn({uniqueQuery:M,splitByField:$,x:m}),B&&(M.outStatistics=kn({chartConfig:e,fetchFullBoxPlotData:o})),C?delete M.orderByFields:t.orderByFields!==void 0&&(M.orderByFields=t.orderByFields.filter(Z=>{let ee=Z.split(" ");return!X(ee[0])})),y&&oe(l[0])){let Z=W(n),{objectIdField:ee}=Z;(await Be(n)).find(Y=>Y.name===m)?.type!==Ve.DateOnly&&_n({uniqueQuery:M,x:m,splitByField:J(f.where),unit:a?.unit??l[0].temporalBinning?.unit,chartSubType:c,objectIdField:ee})}M.where=O}or({chartConfig:e,options:r,uniqueQuery:M});let{gdbVersion:w,geometry:A,distance:N,units:P,timeExtent:L,where:E,objectIds:_,spatialRelationship:q}=t;return w!==void 0&&(M.gdbVersion=w),A!==void 0&&(M.geometry=A),N!==void 0&&(M.distance=N),P!==void 0&&(M.units=P),L!==void 0&&(M.timeExtent=L),_!==void 0&&(M.objectIds=_),q!==void 0&&(M.spatialRelationship=q),E!==void 0&&(M.where=K([M.where,E])),{uniqueQuery:M,mapToStatField:h}}async function Kn(i){let{queryObject:e,queryConfig:t,chartConfig:r,abortKey:n}=i,a=r.series[0],{x:o,valueConversion:s}=a,u=qt(r),l=await ce({queryObject:e,queryConfig:t,featureCount:t.num??1,abortKey:n}),c=[{[o]:null}];if(u)c=l.map(d=>{Jt(d.attributes,o);let f=Qi(d.attributes[o],s);return{...d.attributes,[o]:f}});else if(l.length>0){let d=l[0].attributes[o]??l[0].attributes[o.toUpperCase()]??l[0].attributes[o.toLowerCase()];d=Qi(d,s),c=[{[o]:d}]}return c}async function Wn(i){let{queryObject:e,chartConfig:t,queryConfig:r,options:n,abortKey:a}=i,{chartLimits:o}=n??{},s={valid:!0};if(e!==void 0){let{behaviorAfterLimit:u,maxGaugeByFeaturesLimit:l}=o??{},c=qt(t),d=!0,f;if(c&&(f=(await Fr({chartConfig:t,queryObject:e,queryConfig:r,behaviorAfterLimit:u,numberMaxOfFeaturesToFetch:l,isGaugeByFeature:c})).elementCount,n?.chartLimits?.behaviorAfterLimit!==qe.RenderUpToTheLimit&&(d=ye({count:f??0,seriesCount:t.series.length,chartType:v.GaugeSeries,chartLimits:o})),n&&(Number.isFinite(l)||Number.isFinite(f)))){let m=Math.min(l??Number.NaN,f??Number.NaN);Number.isFinite(m)&&(n.chartLimits={...o,maxGaugeByFeaturesLimit:m}),or({chartConfig:t,options:n,uniqueQuery:r})}if(Number.isNaN(d)||d){let m=await Kn({queryObject:e,chartConfig:t,queryConfig:r,abortKey:a});s.data={dataItems:m},s.count=m.length}else s.count=f,ht({dataInfo:s,chartType:v.GaugeSeries})}return s}async function il(i){let{queryObject:e,chartConfig:t,queryConfig:r}=i,{minimumFromField:n,maximumFromField:a}=t.axes[0],o=[],s="",u="";n!==void 0&&(typeof n=="string"?(s=`${T.Minimum}_${n}`,o.push({statisticType:T.Minimum,onStatisticField:n,outStatisticFieldName:s})):(s=`${n.statisticType}_${n.onStatisticField}`,o.push({...n,outStatisticFieldName:s}))),a!==void 0&&(typeof a=="string"?(u=`${T.Maximum}_${a}`,o.push({statisticType:T.Maximum,onStatisticField:a,outStatisticFieldName:u})):(u=`${a.statisticType}_${a.onStatisticField}`,o.push({...a,outStatisticFieldName:u})));let l={...r,outStatistics:o,orderByFields:void 0,groupByFieldsForStatistics:void 0,returnDistinctValues:void 0,fetchNullValues:void 0,num:void 0},c=await Re({queryObject:e,queryConfig:l}),d=c.get(s),f=c.get(u);return{minimumFromData:d,maximumFromData:f}}function Qn(i=H.None,e){return i===H.None||i===H.Log&&e>0||i===H.Sqrt&&e>=0}function sr(i,e){let t={valid:!1};return e===!0?t.invalidType=V.HistogramEmptyField:i===H.Log?t.invalidType=V.NegativeValueInLogCalculation:i===H.Sqrt&&(t.invalidType=V.NegativeValueInSqrtCalculation),t}function Hn(i,e){let t=i;switch(e){case H.Log:t=Math.log(i);break;case H.Sqrt:t=Math.sqrt(i);break}return t}function Gn(i){let e=i,t=i.toString().split(".");if(t[1]!==void 0){let r=10**-t[1].length;e=i-r}return e}function lr(i){let e="field";switch(i){case H.Log:e="natural-log";break;case H.Sqrt:e="square-root";break;case H.None:}return e}async function zn(i){let{queryObject:e,fieldName:t,queryConfig:r,abortKey:n}=i,a=W(e),{objectIdField:o}=a,s=`${T.Count}_${o}`,u=`${T.Count}_${t}`,l=`${T.Minimum}_${t}`,c=`${T.Maximum}_${t}`,d={...r,outStatistics:[{statisticType:T.Count,onStatisticField:o,outStatisticFieldName:s},{statisticType:T.Count,onStatisticField:t,outStatisticFieldName:u},{statisticType:T.Minimum,onStatisticField:t,outStatisticFieldName:l},{statisticType:T.Maximum,onStatisticField:t,outStatisticFieldName:c}]},f=await Re({queryObject:e,queryConfig:d,abortKey:n}),m=f.get(s)??Number.NaN,g=f.get(u)??Number.NaN,y=f.get(l)??Number.NaN,h=f.get(c)??Number.NaN;return{countExcludingNulls:g,countIncludingNulls:m,min:y,max:h}}async function Jn(i){let{queryConfig:e,chartConfig:t,queryObject:r,abortKey:n}=i,a=t.series[0],{x:o,dataTransformationType:s}=a,u=[],{countIncludingNulls:l,countExcludingNulls:c,min:d,max:f}=await zn({queryObject:r,queryConfig:e,fieldName:o,abortKey:n}),m=Qn(s,d),g=c<2||d===f,y={...e};return y.where=K([y.where,`${o} is not null`]),{rawData:u,dataCompatibleWithTransformation:m,dataCountIncompatible:g,countExcludingNulls:c,countIncludingNulls:l}}function Un(i){let e={...i};return e.avg=e.avg??Number.NaN,e.count=e.count??Number.NaN,e.max=e.max??Number.NaN,e.min=e.min??Number.NaN,e.stddev=e.stddev??Number.NaN,e.sum=e.sum??Number.NaN,e.variance=e.variance??Number.NaN,e.median=e.median??Number.NaN,e}function Zn(i){let{seriesConfig:e,layer:t,useFeaturesInView:r,view:n,queryConfig:a}=i,{x:o,dataTransformationType:s}=e,u={layer:t,view:n,field:o,sqlWhere:lt(a.where)?void 0:a.where,useFeaturesInView:r};return s!==H.None&&(u={...u,normalizationType:lr(s)}),u}function Yn(i){let{seriesConfig:e,layer:t,useFeaturesInView:r,view:n,minValue:a,maxValue:o,queryConfig:s}=i,{x:u,binCount:l,dataTransformationType:c}=e,d={layer:t,view:n,field:u,minValue:a,maxValue:o,numBins:l??si,classificationMethod:"equal-interval",sqlWhere:lt(s.where)?void 0:s.where,useFeaturesInView:r};return c!==H.None&&(d={...d,normalizationType:lr(c)}),d}function Xn(i,e){let t=Number.NaN;return i!==void 0&&e!==void 0&&(t=i-e),t}async function ea(i){let{chartConfig:e,queryConfig:t,queryObject:r,countExcludingNulls:n,countIncludingNulls:a,options:o,errorStrings:s}=i,u=e.series[0],{dataTransformationType:l}=u,c={valid:!0};if(r!==void 0){let d=W(r),f=Mi(t?.geometry)?.extent?.toJSON()!==void 0,m=o?.view,g=Zn({seriesConfig:u,layer:d,view:m,useFeaturesInView:f,queryConfig:t}),y;if(m!==void 0&&(y=new _i({geometry:m.extent}),m.extent!==void 0&&hi(d))){let{distance:A,units:N}=t;A!==void 0&&(y.distance=A),N!==void 0&&(y.units=N)}if(t.timeExtent){let A={start:t.timeExtent[0],end:t.timeExtent[1]};y===void 0?y=new _i({timeExtent:A}):y.timeExtent=A}g.filter=y;let h;g.outStatisticTypes={exclude:["median"]};try{h=await Ki(g)}catch(A){throw new ct(Lt.QueryFeaturesError,s.errors.queryError,A)}g.outStatisticTypes={include:["median"]};try{let A=await Ki(g);A?.median&&(h.median=A.median)}catch{}h=Un(h);let{avg:F,count:S,stddev:C,min:x,max:B,sum:M,median:w}=h;if(S===0)c={...sr(l)};else{let A=Yn({seriesConfig:u,layer:d,view:m,useFeaturesInView:f,minValue:Gn(x),maxValue:B,valueExpression:g.valueExpression,queryConfig:t});A.filter=y;let N;try{N=await Lr(A)}catch(L){throw new ct(Lt.QueryFeaturesError,s.errors.queryError,L)}let P=Xn(a,n);c.data={mean:F,stddev:C,min:x,max:B,median:Number(w),bins:N?.bins,count:n,nulls:P,sum:M??void 0},c.data.bins.length>0&&(c.data.bins[c.data.bins.length-1].isLastBin=!0)}}return c}async function ur(i){let{chartConfig:e,queryConfig:t,queryObject:r,options:n,abortKey:a,errorStrings:o}=i,{series:s}=e,u=s[0],{rawData:l,dataCompatibleWithTransformation:c,dataCountIncompatible:d,countIncludingNulls:f,countExcludingNulls:m}=await Jn({queryObject:r,chartConfig:e,queryConfig:t,abortKey:a}),g={valid:!0};return!c||d?g=sr(u.dataTransformationType,d):g=await ea({chartConfig:e,queryObject:r,queryConfig:t,countIncludingNulls:f,countExcludingNulls:m,options:n,errorStrings:o}),g}async function ta(i){let{queryObject:e,queryConfig:t,chartConfig:r,x:n}=i,{series:a}=r,{dataTransformationType:o}=a[0],s={...t,orderByFields:[n],outFields:[n]};return{valid:!0,data:{dataItems:(await ce({queryObject:e,queryConfig:s})).map(u=>({[n]:Hn(u.attributes[n],o)}))}}}var Oe={groupByCaseBegin:"CASE",groupByOutKeyword:"OUT",groupByCaseEnd:"ELSE 'OUT' END"},ia="{ groupByFieldsForStatistics } WHEN ({ y } { yMinOperand } { yValue } AND { y } { yMaxOperand } { yValuePlusStep } AND { x } { xMinOperand } { xValue } AND { x } { xMaxOperand } { xValuePlusStep }) THEN '{ xValue }|{ xValuePlusStep}|{ yValue }|{ yValuePlusStep }'";async function ra(i){let{chartConfig:e,queryObject:t,queryConfig:r,abortKey:n}=i,a=e.series[0],{x:o,y:s}=a,{dataContextCountDistinctX:u,dataContextCountDistinctY:l}=b.scatterplotAggregationFields,c={...r,outStatistics:[{statisticType:T.Count,outStatisticFieldName:u,onStatisticField:o},{statisticType:T.Count,outStatisticFieldName:l,onStatisticField:s}],returnDistinctValues:!0};return await Re({queryObject:t,queryConfig:c,abortKey:n})}async function na(i){let{statsMap:e,chartConfig:t,queryObject:r,options:n,queryConfig:a,abortKey:o}=i,{dataContextXMinField:s,dataContextXMaxField:u,dataContextYMinField:l,dataContextYMaxField:c,dataContextCountDistinctX:d,dataContextCountDistinctY:f}=b.scatterplotAggregationFields,m,g,y,h,F,S=e.get(s),C=e.get(u),x=e.get(l),B=e.get(c);if(S!=null&&x!==void 0&&x!==null&&C!==void 0&&C!==null&&B!==void 0&&B!==null&&!Number.isNaN(S+C+x+B)){let{maxScatterPointsAfterAggregation:M}=Pe(n?.chartLimits),w=Math.floor(Math.sqrt(M)),A=await ra({queryObject:r,chartConfig:t,queryConfig:a,abortKey:o});y=Math.min(A.get(f)??Number.NaN,w),h=Math.min(A.get(d)??Number.NaN,w),F=h*y,m=C===S?0:(C-S)/(h-1),g=B===x?0:(B-x)/(y-1),e.set(b.scatterplotAggregationFields.xStep,m),e.set(b.scatterplotAggregationFields.yStep,g),e.set(b.scatterplotAggregationFields.rowCount,y),e.set(b.scatterplotAggregationFields.columnCount,h),e.set(b.scatterplotAggregationFields.realGridSize,F)}}function aa(i){let{groupByFieldsForStatistics:e,x:t,y:r,xValue:n,yValue:a,xStep:o,yStep:s,endOfRow:u,endOfColumn:l}=i,c=e===""?Oe.groupByCaseBegin:e;return c=pe(ia,{groupByFieldsForStatistics:c,x:t,y:r,xValue:`${n}`,yValue:`${a}`,xValuePlusStep:`${n+(l?0:o)}`,yValuePlusStep:`${a+(u?0:s)}`,xMinOperand:l?"=":">=",yMinOperand:u?"=":">=",xMaxOperand:l?"=":"<",yMaxOperand:u?"=":"<"}),c}async function oa(i){let{chartConfig:e,queryConfig:t,queryObject:r,xMin:n,xMax:a,yMin:o,yMax:s,abortKey:u}=i,l=e.series[0],{x:c,y:d}=l,f={...t};return f.where=K([f.where,`${c}>=${n}`,`${c}<=${a}`]),c!==d&&(f.where=K([f.where,`${d}>=${o}`,`${d}<=${s}`])),await ce({queryObject:r,queryConfig:f,noBatch:!0,featureCount:1,abortKey:u})}async function sa(i){let{statsMap:e,chartConfig:t,queryObject:r,queryConfig:n,useQueryAttributeBins:a,errorStrings:o,abortKey:s}=i,u=t.series[0],{x:l,y:c}=u,{dataContextXMinField:d,dataContextXMaxField:f,dataContextYMinField:m,dataContextYMaxField:g,queryNumberOfFeatures:y,queryNumberOfAggregatedFeatures:h}=b.scatterplotAggregationFields,F,S=e?.get(d)??Number.NaN,C=e?.get(f)??Number.NaN,x=e?.get(y)??Number.NaN,B=e?.get(m)??S,M=e?.get(g)??C;if(S!=null&&B!==void 0&&B!==null&&C!==void 0&&C!==null&&M!==void 0&&M!==null&&!Number.isNaN(S+C+B+M)){let w=W(r),{objectIdField:A}=w,N=e?.get(b.scatterplotAggregationFields.xStep),P=e?.get(b.scatterplotAggregationFields.yStep),L=e?.get(b.scatterplotAggregationFields.realGridSize),E=e?.get(b.scatterplotAggregationFields.rowCount),_=e?.get(b.scatterplotAggregationFields.columnCount),q=new Map,$=await Be(r);if($?.forEach(O=>{_e(O)&&q.set(O.name,{onStatisticField:O.name,outStatisticFieldName:O.name,statisticType:T.Maximum})}),($.filter(O=>u?.additionalTooltipFields?.includes(O.name))??[])?.forEach(O=>{_e(O)||q.set(O.name,{onStatisticField:O.name,outStatisticFieldName:O.name,statisticType:T.Maximum})}),(await Vt(w)).forEach(O=>{q.set(O,{onStatisticField:O,outStatisticFieldName:O,statisticType:T.Maximum})}),q.set(A,{onStatisticField:A,outStatisticFieldName:h,statisticType:T.Count}).set(l,{onStatisticField:l,outStatisticFieldName:l,statisticType:T.Maximum}).set(c,{onStatisticField:c,outStatisticFieldName:c,statisticType:T.Maximum}),N!==void 0&&P!==void 0){if(a){let O={...n,outStatistics:[...q.values()]};F=await Ci({queryObject:r,queryConfig:O,xStep:N,xMin:S,xMax:C,x:l,y:c,yStep:P,errorStrings:o})}else if(E!==void 0&&_!==void 0){let O=0,{maxScatterCellsPerQuery:Z,maxScatterCellsPerQueryForStandard:ee}=$e(),Y=await Li(w)?ee:Z,me=[],te=!0,Ie=S,Te=B,Ee="",et=1,bt=1,tt=Number.MAX_SAFE_INTEGER,it=Number.MIN_SAFE_INTEGER,rt=Number.MAX_SAFE_INTEGER,nt=Number.MIN_SAFE_INTEGER;for(;bt<=_&&te;){for(Te=B,et=1;et<=E&&te;){if(Ee=aa({groupByFieldsForStatistics:Ee,x:l,y:c,xValue:Ie,yValue:Te,xStep:N,yStep:P,endOfRow:et===E,endOfColumn:bt===_}),Ie<tt&&(tt=Ie),Ie+N>it&&(it=Ie+N),Te<rt&&(rt=Te),Te+N>nt&&(nt=Te+P),O+=1,O%Y===0||O===L||O===x){Ee=`${Ee} ${Oe.groupByCaseEnd}`;let wr={...n,groupByFieldsForStatistics:[Ee],outStatistics:[...q.values()]};me.push(oa({chartConfig:t,queryConfig:wr,queryObject:r,xMin:tt,xMax:it,yMin:rt,yMax:nt,abortKey:s})),tt=Number.MAX_SAFE_INTEGER,it=Number.MIN_SAFE_INTEGER,rt=Number.MAX_SAFE_INTEGER,nt=Number.MIN_SAFE_INTEGER,Ee="",O===L&&(te=!1)}Te+=P,et+=1}Ie+=N,bt+=1}F=(await Promise.all(me)).flat()}}}return F}var la={dataFormat:"json",outputFormat:"json",typeKey:"analyticType",typeValue:"LinRegR2",fieldValue:"onAnalyticField",slopePropertyList:["Slope","SLOPE","slope"],interceptPropertyList:["Intercept","INTERCEPT","intercept"],r2PropertyList:["R2","r2"]};async function ua(i){let{queryObject:e}=i,t=!1,r=yi(e),n=W(e),a=Ot(n);if(r&&a.url!==void 0&&a.url!==null){let o=`${a.url}/${a.layerId}?f=json`;try{let s=(await qr(o)).data,u=s?.advancedQueryCapabilities?.supportsQueryAnalytic===!0,l=s?.sqlParserVersion===void 0||a.version!=null&&a.version>=10.91;t=u&&l}catch{}}return t}function ca(i){let{x:e,y:t,trendlineXToY:r,data:n}=i,[a,o]=n?ti(n,s=>s[e]):[Number.NaN,Number.NaN];return[{[e]:a??Number.NaN,[t]:r(a??Number.NaN)},{[e]:o??Number.NaN,[t]:r(o??Number.NaN)}]}function da(i){let{data:e,x:t,y:r}=i,n=[];return e!==void 0&&(n=e.filter(a=>Number.isFinite(a[t])&&Number.isFinite(a[r])).map(a=>[a[t],a[r]])),n}async function fa(i){let{statsMap:e,queryObject:t,chartConfig:r,queryConfig:n}=i,a=r.series[0],{x:o,y:s}=a,u=Number.NaN,l=[{[o]:Number.NaN,[s]:Number.NaN},{[o]:Number.NaN,[s]:Number.NaN}],{dataFormat:c,outputFormat:d,typeKey:f,typeValue:m,fieldValue:g,slopePropertyList:y,interceptPropertyList:h,r2PropertyList:F}=la,S=`[{"${f}": "${m}", "${g}":"${o},${s}"}]`,C=await vi({queryObject:t,queryConfig:n,outputFormat:d,dataFormat:c,outAnalytics:S});if(C!==void 0){let x=Number.NaN,B=Number.NaN,{expr:M}=st(C,y),{expr:w}=st(C,h),{expr:A}=st(C,F);M!==void 0&&Number.isFinite(C[M])&&(x=C[M]),w!==void 0&&Number.isFinite(C[w])&&(B=C[w]),A!==void 0&&Number.isFinite(C[A])&&(u=C[A]);let{dataContextXMinField:N,dataContextXMaxField:P,dataContextYMinField:L,dataContextYMaxField:E}=b.scatterplotAggregationFields,_=e.get(N)??Number.NaN,q=e.get(P)??Number.NaN,$=e.get(L)??Number.NaN,O=e.get(E)??Number.NaN,Z=(q-_)/100,ee=_-Z,Y=Number.NaN;for(;!(Y>=$&&Y<=O)&&ee<=q;)ee+=Z,Y=x*ee+B;let me=q+Z,te=Number.NaN;for(;!(te>=$&&te<=O)&&me>=_;)me-=Z,te=x*me+B;l=[{[o]:ee,[s]:Y},{[o]:me,[s]:te}]}return{r2:u,trendLinePoints:l}}function cr(i){let{data:e,chartConfig:t}=i,r=t.series[0],{x:n,y:a}=r,{r2:o,trendLinePoints:s}=b.scatterplotSeries,u=da({data:e,x:n,y:a});if(u!==void 0){let l=Vi(u),c=$i(l);o=ji(u,c),s=ca({x:n,y:a,trendlineXToY:c,data:e})}return{r2:o,trendLinePoints:s}}async function ma(i){let e=await ua(i),{chartConfig:t}=i,r=t.series[0],{x:n,y:a}=r,{r2:o}=b.scatterplotSeries,s=[{[n]:Number.NaN,[a]:Number.NaN},{[n]:Number.NaN,[a]:Number.NaN}],u={r2:o,trendLinePoints:s},l=!1;if(e)try{u=await fa(i)}catch{l=!0}return(!e||l)&&(u=cr(i)),u}async function ga(i){let{chartConfig:e,queryConfig:t,queryObject:r,abortKey:n}=i,a=e.series[0],{x:o,y:s}=a,u=new Map,{dataContextXMinField:l,dataContextXMaxField:c,dataContextYMinField:d,dataContextYMaxField:f,queryNumberOfFeatures:m}=b.scatterplotAggregationFields,{objectIdField:g}=W(r),y=[{statisticType:T.Count,onStatisticField:g,outStatisticFieldName:m},{statisticType:T.Minimum,outStatisticFieldName:l,onStatisticField:o},{statisticType:T.Maximum,outStatisticFieldName:c,onStatisticField:o}];o!==s&&y.push({statisticType:T.Minimum,outStatisticFieldName:d,onStatisticField:s},{statisticType:T.Maximum,outStatisticFieldName:f,onStatisticField:s});let h={...t};return h.outStatistics=y,u=await Re({queryObject:r,queryConfig:h,abortKey:n}),o===s&&(u.set(d,u.get(l)??Number.NaN),u.set(f,u.get(c)??Number.NaN)),u}function gt(i){let{value:e,valueMin:t,valueMax:r}=i;return e===t||e===r?e:Math.random()*(r-t)+t}function ya(i){let{useQueryAttributeBins:e,graphic:t,x:r,y:n,yStep:a}=i,{groupByOutKeyword:o}=Oe,{dataContextXMinField:s,dataContextXMaxField:u,dataContextYMinField:l,dataContextYMaxField:c}=b.scatterplotAggregationFields,d=[];if(e&&"stackedAttributes"in t&&t.stackedAttributes){let f=bi(r,n),m=t.attributes[f.lowerBoundaryAlias],g=t.attributes[f.upperBoundaryAlias];t.stackedAttributes.forEach(y=>{let h=y[f.stackAlias],F;typeof h=="number"&&typeof a=="number"&&(h*=a),typeof h=="number"&&typeof a=="number"&&(F=h+a);let S=y[r],C=y[n];typeof h=="number"&&typeof F=="number"&&typeof S=="number"&&typeof C=="number"&&d.push({...y,[r]:gt({value:S,valueMin:m,valueMax:g}),[n]:gt({value:C,valueMin:h,valueMax:F}),[s]:Math.min(m,g),[u]:Math.max(m,g),[l]:h,[c]:F})})}else{let{expr:f,isInItem:m}=Je(t.attributes);if(m&&f&&t.attributes[f]!==o){let[g,y,h,F]=t.attributes[f].split("|");g=Math.min(g,y),y=Math.max(g,y),h=Math.min(h,F),F=Math.max(h,F);let S={...t.attributes,[s]:g,[u]:y,[l]:h,[c]:F};S[r]=gt({value:S[r],valueMin:g,valueMax:y}),S[n]=gt({value:S[n],valueMin:h,valueMax:F}),d=[S]}}return d}async function ha(i){let{queryObject:e,chartConfig:t,rawData:r,isAggregationMode:n,yStep:a,useQueryAttributeBins:o}=i,s=t.series[0],{x:u,y:l}=s,c=W(e).objectIdField,d=(Array.isArray(r)?r:r?.features)?.flatMap(f=>{let m=[{...f.attributes}];return Jt(m[0],[u,l]),n?m=ya({useQueryAttributeBins:o,graphic:f,x:u,y:l,yStep:a}):m[0][G.uniqueIdsName]=m[0][c],m});return d=d?.filter(f=>{let{expr:m}=Je(f);return Number.isFinite(f[u])&&Number.isFinite(f[l])&&(m===void 0||f[m]!==Oe.groupByOutKeyword)}),d??[]}async function pa(i){let{queryObject:e,queryConfig:t,chartConfig:r,featureCount:n,abortKey:a}=i,o=r.series[0],{x:s,y:u}=o,l=W(e),c=[],d=((await Be(e))?.filter(y=>_e(y)&&y.name!==s&&y.name!==u)??[]).map(y=>y.name)??[],f=o?.additionalTooltipFields??[],m=Array.from(new Set([s,u,l.objectIdField,...d,...f]));if(!Ot(l).isTable){let{rendererField:y,rendererNormalizationField:h}=Ai(l?.renderer??void 0);X(y)||m.push(y),X(h)||m.push(h)}let g={...t,orderByFields:[`${s} ${le.Ascending}`],outFields:m};return c=await ce({queryObject:e,queryConfig:g,featureCount:n,abortKey:a}),c}async function va(i){let e,{chartConfig:t,queryConfig:r,queryObject:n,statsMap:a,numberOfFeatures:o,isAggregationMode:s,useQueryAttributeBins:u,errorStrings:l,abortKey:c}=i,d=t.series[0],{x:f,y:m}=d;if(!Number.isNaN(o)&&o>0){let g={...r};g.where=K([g.where,`${f} IS NOT NULL`,`${m} IS NOT NULL`]),s?e=await sa({chartConfig:t,queryObject:n,queryConfig:g,statsMap:a,useQueryAttributeBins:u,errorStrings:l,abortKey:c}):e=await pa({queryObject:n,chartConfig:t,queryConfig:g,featureCount:o,abortKey:c})}return e}async function dr(i){let{chartConfig:e,queryConfig:t,queryObject:r,sortData:n,calculateTrendLine:a,options:o,abortKey:s}=i,u=await ga({chartConfig:e,queryConfig:t,queryObject:r,abortKey:s}),{queryNumberOfFeatures:l,yStep:c}=b.scatterplotAggregationFields,{maxScatterPointsBeforeAggregation:d}=Pe(o?.chartLimits),f=u?.get(l)??Number.NaN,m=f>=d,g=pi(r);m&&await na({statsMap:u,chartConfig:e,queryObject:r,options:o,queryConfig:t,abortKey:s});let y=await va({...i,statsMap:u,numberOfFeatures:f,isAggregationMode:m,useQueryAttributeBins:g}),h=await ha({queryObject:r,chartConfig:e,rawData:y,isAggregationMode:m,yStep:u.get(c),useQueryAttributeBins:g});n!==!1&&Ye({arrayToSort:h,sortingField:e.series[0].x,orderBy:le.Ascending});let{r2:F,trendLinePoints:S}=a!==!1?await ma({data:h,statsMap:u,queryConfig:t,options:o,queryObject:r,chartConfig:e}):b.scatterplotSeries;return{dataItems:h,r2:F,trendLinePoints:S,aggregated:m}}function ba(i){let{itemsA:e,itemsB:t,isPieFromFields:r,x:n,y:a,outStatisticFieldName:o}=i,s=Se(e),u=Se(t),l=!1;if(s===void 0&&u!==void 0||s!==void 0&&u===void 0)l=!0;else if(!r){let c=[b.originalCategoryValue,b.originalDateValue,b.xAxisField,b.technicalSortingFieldBySum,b.technicalSortingFieldByPercent,b.pieChart.technicalFieldSlicePercent,b.pieChart.technicalFieldGroupedSlices,b.pieChart.technicalFieldSliceId,b.typeOrDomainFieldName,b.typeOrDomainIdValue,b.originalServerBinningRange,b.lastTemporalBin,b.technicalFieldSplitByField,G.uniqueIdsName,j.valueField,...li],d=(y,h)=>{let F=h[b.typeOrDomainFieldName];typeof F=="string"&&h[F]!==void 0&&(h[F]=h[b.typeOrDomainIdValue]),n&&h[j.xField]!==void 0&&(h[n]=h[j.xField],delete h[j.xField]),a&&h[j.yField]!==void 0&&(h[a]=h[j.yField],delete h[j.yField]),o&&h[j.valueField]!==void 0&&(h[o]=h[j.valueField],delete h[j.valueField]);let S={};return Object.keys(h).forEach(C=>{!c.includes(C)&&!C.includes(b.rendererSymbolField)&&(S[C]=h[C])}),y.push(S),y},f=(y,h)=>JSON.stringify(y).localeCompare(JSON.stringify(h)),m=s?.reduce(d,[])?.sort(f),g=u?.reduce(d,[])?.sort(f);l=m?.length!==g?.length||!Ne(m,g)}return l}function Sa(i){let{chartConfig:e,currentSelectionDataItems:t,options:r}=i,{selectionData:n}=r??{},a=[];if(e!==void 0){let o=e.series,s=I(o),{selectionItems:u}=n??{};if(u!==void 0&&ba({itemsA:u,itemsB:t,isPieFromFields:I(e.series)===p.PieFromFields,x:e.series[0].x,y:"y"in e.series[0]?e.series[0].y.toString():void 0,outStatisticFieldName:e.series[0].query?.outStatistics?.[0]?.outStatisticFieldName})?a=u:a=t??[],o.length>1&&s!==p.BarAndLineNoAggregation&&s!==p.BarAndLineSplitByNoAggregation){let l=J(o[0].query?.where);a=zt({data:a,x:o[0].x,splitByField:l})}Xe({arrayToSort:a,chartConfig:e})}return a??[]}function Me(i,e){let t="";if(i.trim()!==""&&e!==void 0)if(e===null)t=`${i} IS NULL`;else{let r=typeof e!="number"?"'":"";t=`${i}=${r}${e.toString()}${r}`}return t}function Fa(i){let{dataContext:e,xAxisField:t,yAxisField:r,options:n}=i,a="",{dataContextXMinField:o,dataContextXMaxField:s,dataContextYMinField:u,dataContextYMaxField:l}=b.scatterplotAggregationFields;if(er({dataContext:e,chartLimits:n?.chartLimits})){let{[o]:c,[s]:d}=e,f=t!==r?e[u]:c,m=t!==r?e[l]:d;if(!Number.isNaN(c)&&!Number.isNaN(d)&&!Number.isNaN(f)&&!Number.isNaN(m)){let g=[];c===d?g.push(`${t}=${c?.toString()}`):(g.push(`${t}>=${c?.toString()}`),g.push(`${t}<=${d?.toString()}`)),f===m?g.push(`${r}=${f?.toString()}`):(g.push(`${r}>=${f?.toString()}`),g.push(`${r}<=${m?.toString()}`)),a=K(g)}}else a=K([he({where:Me(t,e[t])}),r!==void 0?he({where:Me(r,e[r])}):""]);return a}function fr(i,e){let t="",r=e[b.originalServerBinningRange]??e[b.dateBinningRange];if(at(r)&&r.length===2){let[n,a]=r;typeof n=="number"&&typeof a=="number"&&Number.isFinite(n)&&Number.isFinite(a)&&(n=We(n),a=We(a));let o=e[b.lastTemporalBin]===!0?"<=":"<";t=`${i}>='${n}' AND ${i}${o}'${a}'`}return t}function mr(i,e){let t="";if(Number.isFinite(i)){let r=1/10**b.queryMaxFloatPrecision;t=`${e}>=${i-r} AND ${e}<=${i+r}`}return t}function gr(i){let{xAxisField:e,yAxisField:t,splitBy:r,dataContext:n,xAxisFieldType:a,chartConfig:o}=i,s="";if(e!==void 0&&e!==b.boxPlot.boxPlotCategory){let c=Ze({value:n[e],dataContext:n,keepNullValues:!0,specificField:b.typeOrDomainIdValue});a===Ve.Double?s=mr(c,e):(Le(o.axes?.[0].valueFormat)&&(c=We(c)),s=he({where:Me(e,c),normalize:!1,escape:!0}))}let u=he({where:r??"",normalize:!1,escape:!0}),l="";if(Hr(o)===!0){let c=I(o.series)===p.BoxPlotMultiFieldsAndCategory?t:void 0,d=z({key:D.Min,showOutliers:!0,splitBy:r,y:c}),f=z({key:D.Max,showOutliers:!0,splitBy:r,y:c}),m=e===b.boxPlot.boxPlotCategory?n[e]:t;if(!X(m)){let g=n[d],y=n[f];Number.isFinite(g)&&Number.isFinite(y)&&(l=`${m?.toString()}>=${g?.toString()} AND ${m?.toString()}<=${y?.toString()}`)}}return K([s,u,l])}function Ca(i){let{xAxisField:e,splitBy:t,dataContext:r,xAxisFieldType:n,chartConfig:a}=i,o="";if(b.dateBinningRange in r)o=fr(e,r);else if(I(a.series)!==p.BarAndLineFromFields){let u=Ze({value:r[e],dataContext:r,keepNullValues:!0,specificField:b.typeOrDomainIdValue});n===Ve.Double?o=mr(u,e):(Le(a.axes?.[0].valueFormat)&&(u=We(u)),o=he({where:Me(e,u),normalize:!1,escape:!0}))}let s=he({where:t??"",normalize:!1,escape:!0});return K([o,s])}function xa(i){let{xAxisField:e,dataContext:t,chartConfig:r}=i,n=b.typeOrDomainIdValue in t?t[b.typeOrDomainIdValue]:t[b.originalCategoryValue];return n===void 0&&(n=t[e]),I(r.series)===p.PieFromFields?"":he({where:Me(e,n),normalize:!1,escape:!0})}function Gi(i){let{field:e,fieldType:t,fieldValue:r,unit:n,outTimeZone:a,dataTimeZone:o,runsOnClientQueryEngine:s}=i,u,{expression:l}=Et({field:e,fieldType:t,unit:n,addIntervalStatement:!0,outTimeZone:a,dataTimeZone:o,runsOnClientQueryEngine:s});return l&&(u=`${l}=${r}`),u}function Ba(i){let{xAxisFieldType:e,yAxisFieldType:t,dataContext:r,chartConfig:n,outTimeZone:a,dataTimeZone:o,runsOnClientQueryEngine:s}=i,u=n.series[0],l="";if(u.type===v.HeatSeries){let c,d,f=r[j.xField],m=r[j.yField],g=n.axes?.[0]?.valueFormat?.type,y=n.axes?.[1]?.valueFormat?.type;g===v.CategoryAxisFormat?c=he({where:Me(u.x,f),normalize:!1,escape:!0}):c=Gi({field:u.x,fieldType:e,fieldValue:f,unit:u.xTemporalBinning?.unit,outTimeZone:a,dataTimeZone:o,runsOnClientQueryEngine:s}),y===v.CategoryAxisFormat?d=he({where:Me(u.y,m),normalize:!1,escape:!0}):d=Gi({field:u.y,fieldType:t,fieldValue:m,unit:u.yTemporalBinning?.unit}),c&&(l=K([l,c])),d&&(l=K([l,d]))}return l}function Na(i){let{xAxisField:e,dataContext:t,chartConfig:r}=i,n="",a=r.series[0],{minValue:o,maxValue:s}=t;if(Number.isFinite(o)&&Number.isFinite(s)&&a.type===v.HistogramSeries){let u=en(e,a.dataTransformationType),l=t.isLastBin?"<=":"<";n=K([`${u}>=${o?.toString()}`,`${u}${l}${s?.toString()}`])}return n}function rl(i){let{chartConfig:e}=i,t=R(e.series),r="";switch(t){case v.ScatterSeries:r=Fa(i);break;case v.HeatSeries:r=Ba(i);break;case v.RadarSeries:case v.BarSeries:case v.LineSeries:case v.ComboLineAndBarSeries:r=Ca(i);break;case v.BoxPlotSeries:r=gr(i);break;case v.HistogramSeries:r=Na(i);break;case v.PieSeries:r=xa(i);break}return r}async function wa(i){let{numberOfQueries:e,selectionOIDs:t,chartConfig:r,queryConfig:n,options:a,errorStrings:o,queryObject:s}=i,{setTimeBinningInfoWhenNotProvided:u}=a??{},{series:l}=r,c=R(l),d=[],{maxOIDsPerSelectionQuery:f}=$e();for(let m=0;m<e;m+=1){let g=m*f,y=(m+1)*f-1,h=t.slice(g===0?0:g-1,y),F={...n};switch(F.objectIds=h,c){case v.HeatSeries:d.push(Cr({completeHeatChartDataset:!1,chartConfig:r,queryConfig:F,queryObject:s,errorStrings:o,options:a}));break;case v.PieSeries:case v.BarSeries:case v.LineSeries:case v.RadarSeries:case v.ComboLineAndBarSeries:if(xe({xAxisValueFormatType:be(r),setTimeBinningInfoWhenNotProvided:u,seriesConfig:l[0]})){let S=r;"temporalBinning"in S.series[0]&&S.series[0].temporalBinning&&(S.series[0].temporalBinning.trimIncompleteTimeInterval=!1,ke(s)&&(delete S.series[0].temporalBinning.start,delete S.series[0].temporalBinning.end)),d.push(Ut({chartConfig:S,queryConfig:F,queryObject:s,options:a}))}else d.push(ho({queryObject:s,chartConfig:r,options:a,queryConfig:F}));break;case v.BoxPlotSeries:d.push(po({queryObject:s,chartConfig:r,options:a,errorStrings:o,queryConfig:F}));break;case v.ScatterSeries:d.push(dr({queryObject:s,chartConfig:r,queryConfig:F,options:a,errorStrings:o,sortData:!1,calculateTrendLine:!1}));break;case v.HistogramSeries:d.push(ta({queryObject:s,queryConfig:F,chartConfig:r,x:l[0].x}));break}}return await Promise.all(d)}function Ma(i){let{dataFetchingResults:e,numberOfQueries:t,series:r}=i,n=R(r),a=I(r),o=[],s=new Map;for(let u=0;u<t;u+=1){let l=e[u];if(l!==void 0){let c;if(n===v.ScatterSeries)c=l.dataItems;else if("data"in l&&l.data){let d=l.data;"dataItems"in d&&(c=d.dataItems),"outliers"in d&&d.outliers&&o.push(...d.outliers),"meanLines"in d&&d.meanLines&&o.push(...d.meanLines)}if(c)if(r[0].type===v.HeatSeries)t>0&&c.forEach(d=>{s.set(`${d[j.xField]}-${d[j.yField]}`,d)});else if(r[0].type===v.ScatterSeries){let{x:d,y:f}=r[0];o.push(...c.map(m=>({[d]:m[d],[f]:m[f]})))}else l.valid&&(a===p.PieFromFields?o=yt({dataToConvert:c[0],x:ne,y:ge}):a===p.BarAndLineFromFields?o=yt({dataToConvert:c[0],x:r[0].x,y:r[0].y}):o.push(...c))}}return s.size>0&&(o=Array.from(s.values())),o}async function Aa(i){let{chartConfig:e,queryConfig:t,chartData:r,currentSelectionOIDs:n,dataWasUpdated:a,queryObject:o,options:s,errorStrings:u}=i,{series:l}=e,{selectionData:c,viewExtentUpdated:d,returnSelectionOIDs:f,chartLimits:m}=s??{},{selectionItems:g,selectionOIDs:y}=c??{},h,F=R(l),S=F!==v.HistogramSeries&&F!==v.HeatSeries&&g!==void 0&&g.length>0&&!(l[0].x in g[0])&&!(ne in g[0])&&!(b.boxPlot.boxPlotCategory in g[0]);if(d!==!0&&f!==!1&&y!==void 0&&y.length>0&&(a===!0||S||y.length!==n?.length||!Ne(y,n))){let C=Pt(r);if(C!==void 0&&!Xr({dataContext:C[0],chartConfig:e,chartLimits:m}))h=C.filter(x=>{let B=x[G.uniqueIdsName];return typeof B=="number"?y?.includes(B):!1});else if(y?.[0]!==void 0&&t!==void 0){let{maxOIDsPerSelectionQuery:x}=$e(),B=Math.ceil(y.length/x),M=await wa({numberOfQueries:B,selectionOIDs:y,queryConfig:t,queryObject:o,options:s,errorStrings:u,chartConfig:e});h=Ma({dataFetchingResults:M,numberOfQueries:B,series:l})}}return h}function*Ta(i){let{filterList:e,queryObject:t,queryConfig:r}=i;for(let n=0;n<e.length;n+=1){let a={...r};a.where=K([a.where,e[n]]),yield Bi({queryObject:t,queryConfig:a,uniqueFeature:!0})}}async function nl(i){let{whereList:e,queryObject:t,queryFilter:r,queryConfig:n}=i,a=[];if(e.length>0){let o=$e().maxElementsPerSelectionQuery,s=[],u=Math.ceil(e.length/o);for(let c=0;c<u;c+=1){let d=c*o,f=(c+1)*o,m=e.slice(d===0?0:d-1,f),g=K(m,"OR");g=K([r,g]),s.push(g)}let l=Ta({filterList:s,queryObject:t,queryConfig:n});a=(await Promise.all(l)).flat(),a=Array.from(new Set(a))}return a}async function qa(i){let{queryObject:e,queryConfig:t,chartConfig:r,currentSelectionDataItems:n,options:a,errorStrings:o,abortKey:s}=i,u=I(r.series),l={valid:!0,data:{dataItems:[]}};if(n!==void 0&&n.length>0){let c=we(r),{x:d}=c,f="y"in c?c.y:"",m;e!==void 0&&(m=(await Be(e)).find(C=>C.name===d)?.type);let g=[],y=n.reduce((C,x)=>{let B=[];if(G.uniqueIdsName in x)g.push(x[G.uniqueIdsName]);else{switch(u){case p.BoxPlotMonoFieldAndSplitBy:case p.BoxPlotMultiFieldsAndSplitBy:case p.BoxPlotMonoFieldAndCategoryAndSplitBy:{let A=J(c.query?.where??""),N=`_${D.Average}`;Object.keys(x).forEach(P=>{if(P.includes(N)){let L=P.replace(N,"");L.trim()!==""&&B.push(Me(A,L))}});break}}let M=[f].flat(),w=M.length===1?M[0]:"";if(u===p.BoxPlotMultiFieldsAndCategory){let A=`_${D.FirstQuartile}`,N=Object.keys(x).find(P=>P.includes(A));N!==void 0&&(w=N.replace(A,""))}B.length===0&&B.push(""),B.forEach(A=>{let N=gr({chartConfig:r,xAxisField:d,yAxisField:w,splitBy:A,dataContext:x,xAxisFieldType:m});C.push(N)})}return C},[]),h=W(e);if(h!==void 0&&g.length>0){let{objectIdField:C}=h;y.push(`${C} IN (${g.join(",")})`)}let F=y.join(" OR "),S={...t};S.where=K([S.where,F]),l=await Gt({queryObject:e,chartConfig:r,queryConfig:S,options:a,errorStrings:o,abortKey:s})}return l}async function Pa(i){let{queryObject:e,queryConfig:t,chartConfig:r,currentSelectionDataItems:n,currentSelectionOIDs:a,currentChartData:o,options:s,errorStrings:u,abortKey:l}=i,{series:c}=r,d=R(c),f=be(r),m={valid:!0},g;tr({currentSelectionOIDs:a,options:s})?g=await Aa({chartConfig:r,queryConfig:t,chartData:o,currentSelectionOIDs:a,dataWasUpdated:!0,queryObject:e,options:s,errorStrings:u})??[]:g=Sa({chartConfig:r,currentSelectionDataItems:n,options:s});let y=!1;switch(d){case v.HeatSeries:m.data={dataItems:g};break;case v.PieSeries:if(I(r.series)===p.PieFromFields){let{x:h,y:F}=r.series[0],S=Se(g);S.forEach(C=>{h in C&&(C[ne]=C[h],delete C[h]),F in C&&(C[ge]=C[F],delete C[F])}),m.data={dataItems:S}}else m.data={dataItems:g};m.count=g.length,y=!0;break;case v.BoxPlotSeries:m=await qa(i);break;case v.BarSeries:case v.ComboLineAndBarSeries:case v.RadarSeries:case v.LineSeries:if(g.length===0||!xe({xAxisValueFormatType:f,setTimeBinningInfoWhenNotProvided:s?.setTimeBinningInfoWhenNotProvided,seriesConfig:c[0]}))m.data={dataItems:g},m.count=g.length*c.length,y=!0;else{let h={...t};if(n!==void 0&&n.length>0){let F=n.map(C=>fr(c[0].x,C)),S=K(F,"OR");h.where=K([h.where,S])}m=await Ut({queryObject:e,queryConfig:h,chartConfig:r,options:s})}break;case v.HistogramSeries:{if(g.length===0)m.data={mean:Number.NaN,median:Number.NaN,stddev:Number.NaN,max:Number.NaN,min:Number.NaN,bins:[]},m.count=0;else{let{x:h}=c[0],F=g.map((x,B)=>{let{minValue:M,maxValue:w}=x,A=B===g.length-1?"<=":"<";return`${h} >= ${M} AND ${h} ${A} ${w}`}),S=K(F,"OR"),C={...t};C.where=K([C.where,S]),m=await ur({queryObject:e,chartConfig:r,queryConfig:C,options:s,errorStrings:u,abortKey:l})}break}case v.ScatterSeries:{if(g.length===0){let{r2:h,trendLinePoints:F}=b.scatterplotSeries;m.data={dataItems:[],r2:h,trendLinePoints:F,count:0},m.count=0}else{let{r2:h,trendLinePoints:F}=cr({data:g,chartConfig:r});m.data={dataItems:g,r2:h,trendLinePoints:F},m.count=g.length}break}}return y&&m.data!==void 0&&Xe({arrayToSort:"dataItems"in m.data?m.data.dataItems:m.data,chartConfig:r}),m}async function Gt(i){let{queryObject:e,chartConfig:t,queryConfig:r,options:n,errorStrings:a,abortKey:o}=i,s={valid:!0},u=Ue(t),l=await Qt({queryObject:e,queryConfig:r,fetchFullBoxPlotData:!u,options:n,chartConfig:t,abortKey:o});if(!u)s=l;else{let c={dataItems:[]};c.meanLines=l.data.dataItems;let d=Sn(t),f=(await Qt({queryObject:e,queryConfig:r,fetchFullBoxPlotData:!0,options:n,chartConfig:d,abortKey:o})).data;c.dataItems=f.dataItems,c.outliers=f.outliers,s.data=c}return s}async function La(i){let{queryObject:e,chartConfig:t,queryConfig:r,binnedServerData:n,options:a,errorStrings:o,abortKey:s,fieldList:u}=i,{series:l}=t,{filterBySelection:c}=a??{},d=R(l),f={valid:!0};if(c===!0)f=await Pa(i);else switch(d){case v.HeatSeries:f=await Cr(i);break;case v.BoxPlotSeries:f=await Gt(i);break;case v.BarSeries:case v.ComboLineAndBarSeries:case v.PieSeries:case v.RadarSeries:case v.LineSeries:{let m={queryObject:e,queryConfig:r,chartConfig:t,options:a,abortKey:s,fieldList:u};xe({xAxisValueFormatType:be(t),setTimeBinningInfoWhenNotProvided:a?.setTimeBinningInfoWhenNotProvided,seriesConfig:l[0]})?(n!==void 0&&(m.binnedServerData=n),f=await Ut(m)):f=await Qt(m);break}case v.ScatterSeries:f.data=await dr({queryObject:e,queryConfig:r,options:a,chartConfig:t,errorStrings:o,abortKey:s});break;case v.HistogramSeries:f=await ur({queryObject:e,queryConfig:r,chartConfig:t,options:a,abortKey:s,errorStrings:o});break;case v.GaugeSeries:f=await Wn({queryObject:e,chartConfig:t,queryConfig:r,options:a,abortKey:s});break}return f}async function al(i){let{queryObject:e,chartConfig:t,abortKey:r,currentSelectionDataItems:n,currentSelectionOIDs:a,currentChartData:o,binnedServerData:s,options:u,errorStrings:l,fieldList:c}=i,d={valid:!0},f=$t({queryObject:e,chartConfig:t,runtimeDataFilters:u?.runtimeDataFilters,ignoreViewExtent:u?.ignoreViewExtent});return Ni(r),d=await La({chartConfig:t,queryObject:e,queryConfig:f,currentChartData:o,currentSelectionDataItems:n,currentSelectionOIDs:a,binnedServerData:s,options:u,abortKey:r,errorStrings:l,fieldList:c}),d.queryConfig=f,d}function Oa(i,e,t){let r=new Map;for(let n=0;n<i.length;n+=1)r.set(i[n],{[t]:i[n]});for(let n=0;n<e.length;n+=1){let a=e[n][t];(typeof a=="string"||typeof a=="number")&&r.set(a,e[n])}return[...r.values()]}async function Ia(i){let{seriesData:e,chartConfig:t,queryConfig:r,queryObject:n,categoryOrDateCount:a,behaviorAfterLimit:o,abortKey:s}=i,{series:u}=t,l=e,c=I(u),d=be(t);if(o!==qe.RenderUpToTheLimit&&n!==void 0&&a!==void 0&&a>e.length&&c!==p.BarAndLineFromFields&&c!==p.BarAndLineNoAggregation&&c!==p.PieNoAggregation&&d===v.CategoryAxisFormat){let{x:f}=u[0],m={...r,returnDistinctValues:!0,outFields:[f]};delete m.outStatistics,delete m.orderByFields,delete m.groupByFieldsForStatistics;let g=(await ce({queryObject:n,queryConfig:m,featureCount:a,abortKey:s})).map(y=>y.attributes[f]).filter(y=>y!=null);g.length>e.length&&(l=Oa(g,e,f))}return l}function Ea(i,e){let t=i,{series:r}=e;if(be(e)===v.CategoryAxisFormat&&r[0].query?.outStatistics?.[0].statisticType===T.Count){let n=r.reduce((a,o)=>{let s=o.query?.outStatistics?.[0].outStatisticFieldName??[o.y].flat()[0];return a[s]=0,a},{});for(let a=0;a<i.length;a+=1)i[a]={...n,...i[a]}}return t}var yr=[p.BarAndLineMonoField,p.BarAndLineMultiFields,p.PieNoAggregation,p.PieFromCategory,p.BoxPlotMonoFieldAndCategory,p.BoxPlotMultiFieldsAndCategory,p.BoxPlotMonoFieldAndCategoryAndSplitBy],Da=8e3;function hr(i,e){let t=i;return e===k.Week?t/=7:e===k.Month?t/=30:e===k.Year&&(t/=365),t=Math.ceil(t),t}function Ae(i){let{date:e,unit:t,nextOrPrevious:r,size:n}=i;if(n!==void 0&&Number.isFinite(n)){let a=r==="next"?n:-n;switch(t){case k.Second:return ae.fromMillis(e).plus({seconds:a}).valueOf();case k.Minute:return ae.fromMillis(e).plus({minutes:a}).valueOf();case k.Hour:return ae.fromMillis(e).plus({hours:a}).valueOf();case k.Week:case k.Day:return ae.fromMillis(e).plus({days:a}).valueOf();case k.Month:return ae.fromMillis(e).plus({months:a}).valueOf();case k.Year:return ae.fromMillis(e).plus({years:a}).valueOf()}}return e}function Va(i){let{binFirstOrLastIndex:e,data:t,x:r,timeIntervalInfo:n}=i,{unit:a,size:o}=n,s=a===k.Week?(o??1)*7:o,u=t[e][r],l=e,c=Ae({date:u,unit:a,size:s,nextOrPrevious:"next"}),d=t[l][r];for(;l+1<t.length&&d<c;)l+=1,d=t[l]?.[r];let f=l+1>=t.length,m=l;f&&t[m]!==void 0&&(m+=1);let g=f?Ae({date:u,unit:a,size:s,nextOrPrevious:"next"}):t[l][r];return{binStartDate:u,binEndDate:g,last:f,nextBinFirstOrLastIndex:l,sliceStartIndex:e,sliceEndIndex:m}}function $a(i){let{binFirstOrLastIndex:e,data:t,x:r,timeIntervalInfo:n}=i,{unit:a,size:o}=n,s=a===k.Week?(o??1)*7:o,u=t[e][r],l=e,c=Ae({date:u,unit:a,size:s,nextOrPrevious:"previous"}),d=t[l][r];for(;l-1>=0&&d>c;)l-=1,d=t[l]?.[r];let f=l-1<=0,m=e;return f&&t[m]!==void 0&&(m-=1),f&&(l=0),{binStartDate:f?Ae({date:u,unit:a,size:s,nextOrPrevious:"previous"}):t[l][r],binEndDate:u,nextBinFirstOrLastIndex:l,sliceStartIndex:l,sliceEndIndex:m,last:f}}function ja(i){let{binsToRegroup:e,statisticType:t,y:r,nullPolicy:n}=i,a;n!==ie.Interpolate&&(a=n===ie.Zero?0:null);let o=e.filter(s=>Number.isFinite(s[r]));if(o.length>0)switch(t){case T.Count:case T.Sum:a=oi(o,s=>s[r]);break;case T.Minimum:a=ni(o,s=>s[r]);break;case T.Maximum:a=ri(o,s=>s[r]);break;case T.Average:a=ai(o,s=>s[r]);break;case T.ContinuousPercentile:}return a}function ka(i){let{data:e,seriesConfig:t,timeIntervalInfo:r,dateMinTimestamp:n,dateMaxTimestamp:a}=i,o=[],{unit:s}=r,u=r.size??1,l=t[0],{x:c}=l,d,f;if(oe(l)&&(f=l.temporalBinning?.nullPolicy,d=l.temporalBinning?.timeAggregationType),u>1||s===k.Week||s===k.Month||s===k.Year){let{query:m}=t[0],g=se(t),{statisticType:y}=m?.outStatistics?.[0]??Ft,h=!1,F=d===Q.End?e.length-1:0,S={binFirstOrLastIndex:F,data:e,x:c,timeIntervalInfo:r};for(;!h;){let C={},{binStartDate:x,binEndDate:B,last:M,nextBinFirstOrLastIndex:w,sliceStartIndex:A,sliceEndIndex:N}=d===Q.End?$a(S):Va(S);if(h=M,C=d===Q.End?C=e[N-1]:C=e[F],B>a&&x<a||x<n&&B>n||x>=n&&B<=a){let P=e.slice(A,N).filter(_=>!(b.dateBinModel in _));g.forEach(_=>{C[_]=ja({binsToRegroup:P,statisticType:y,y:_,nullPolicy:f})});let L=P.map(_=>_[Ce]).filter(_=>_!==void 0),E=Gr(L);E!==void 0&&(C[Ce]=E),C[c]=x,C[b.xAxisField]=x,C[b.dateBinningRange]=[x,B],delete C[b.dateBinModel],o.push(C)}else M&&d!==Q.End&&o.length>0&&(o[o.length-1][b.dateBinningRange][1]=o[o.length-1][b.dateBinningRange][1]+1);F=w,S.binFirstOrLastIndex=w}d===Q.End&&(o=o.reverse())}else u===1?o=e.map((m,g)=>{let y=m[c],h=e[g+1]?.[c];return h=typeof h=="number"?h-1:Ae({date:y,unit:s,size:u,nextOrPrevious:"next"}),{...m,[b.dateBinningRange]:[y,h]}}):o=e;return o}function pr(i){let{dateMinTimestamp:e,dateMaxTimestamp:t,timeIntervalInfo:r}=i,{size:n,unit:a}=r,o=0,s=0;if(n!==void 0&&Number.isFinite(n)&&Number.isFinite(e)&&Number.isFinite(t)){let u=-1,l=ae.fromMillis(e),c=ae.fromMillis(t);switch(a){case k.Second:u=c.diff(l,"seconds").get("seconds");break;case k.Minute:u=c.diff(l,"minutes").get("minutes");break;case k.Hour:u=c.diff(l,"hours").get("hours");break;case k.Day:case k.Month:case k.Year:u=c.diff(l,"days").get("days");break;case k.Week:u=c.diff(l,"weeks").get("weeks");break}Number.isFinite(u)&&(s=Math.ceil(u)+1,o=n===1?s:Math.ceil(s/n))}return{numberOfFinalBinsWithinDataRange:o,numberOfSingleBinsWithinDataRange:s}}function vr(i){let e=i[0].temporalBinning?.nullPolicy;return i.reduce((t,r)=>{t[b.dateBinModel]=void 0;let n=r.query?.outStatistics?.[0].outStatisticFieldName??[r.y].flat()[0];return e!==ie.Interpolate&&(t[n]=e===ie.Zero?0:null),t},{})}function Ra(i){let{dateMaxTimestamp:e,numberOfFinalBinsWithinDataRange:t,numberOfSingleBinsWithinDataRange:r,data:n,seriesConfig:a,timeIntervalInfo:o}=i,{size:s,unit:u}=o,{x:l}=a[0],c=a[0].temporalBinning?.timeAggregationType,d=n[0][l],f=e;if(s!==void 0&&Number.isFinite(s)&&r/t!==s){let m=Math.ceil(r/t)*t-r;u===k.Week&&(m*=7);let g=vr(a);if(c===Q.End){let y=n[0][l];for(let h=0;h<m;h+=1)y=Ae({date:y,unit:u,size:1,nextOrPrevious:"previous"}),n.push({...g,[l]:y,[b.xAxisField]:y});m>0&&(d=n[n.length-1][l])}else{let y=n[n.length-1][l];for(let h=0;h<m;h+=1)y=Ae({date:y,unit:u,size:1,nextOrPrevious:"next"}),n.push({...g,[l]:y,[b.xAxisField]:y});f=n[n.length-1][l]}}return{newDateMin:d,newDateMax:f}}function _a(i){let{numberOfSingleBinsWithinDataRange:e,dataLength:t,unit:r}=i;return hr(t,r)>=e}async function Ka(i){let{queryObject:e,queryConfig:t,x:r}=i,n=`MIN_${r}`,a=`MAX_${r}`,o=`COUNT_${r}`,s={...t,outStatistics:[{statisticType:T.Minimum,onStatisticField:r,outStatisticFieldName:n},{statisticType:T.Maximum,onStatisticField:r,outStatisticFieldName:a},{statisticType:T.Count,onStatisticField:r,outStatisticFieldName:o}]};delete s.groupByFieldsForStatistics,delete s.orderByFields;let u=await Re({queryObject:e,queryConfig:s}),l=u.get(n),c=u.get(a),d=u.get(o);return typeof l=="string"&&(l=new Date(l).valueOf()),typeof c=="string"&&(c=new Date(c).valueOf()),{dateRange:{dateMinTimestamp:l,dateMaxTimestamp:c},numberOfFeatures:d}}function Wa(i){let{newDateMin:e,newDateMax:t,seriesConfig:r,data:n,numberOfSingleBinsWithinDataRange:a,initialNumberOfBins:o,timeIntervalInfo:s}=i,{unit:u}=s,l=n;if(!_a({numberOfSingleBinsWithinDataRange:a,dataLength:o,unit:u})){let{x:c}=r[0],d=r[0].temporalBinning?.timeAggregationType,f=vr(r),m=d===Q.End?t:e,g=d===Q.End?n.length-1:0;for(;g<n.length&&(d===Q.End&&m>e||d!==Q.End&&m<t);)m!==n[g][c]?l.push({...f,[c]:m,[b.xAxisField]:m}):g=d===Q.End?g-1:g+1,m=Ae({date:m,unit:u===k.Month||u===k.Year?k.Day:u,size:1,nextOrPrevious:d===Q.End?"previous":"next"})}return l}function Qa(i){let{data:e,seriesConfig:t,dateMinTimestamp:r,dateMaxTimestamp:n}=i,a=e;if(t[0].temporalBinning?.trimIncompleteTimeInterval!==!1){let{timeAggregationType:o}=t[0].temporalBinning??{},s=e[0]?.[b.dateBinningRange]?.[0],u=e[e.length-1]?.[b.dateBinningRange]?.[1];if(o===Q.End?s<r:u>n)if(o===Q.End){let l=s;for(;l<r&&e.length>0;)e.shift(),e.length>0&&(l=e[0][b.dateBinningRange]?.[0])}else{let l=u;for(;l>n&&e.length>0;)e.pop(),e.length>0&&(l=e[e.length-1][b.dateBinningRange]?.[1])}}return a}function Ha(i){let{groupByFieldsForStatistics:e,dateField:t,queryStartDate:r,queryEndDate:n,y:a,binIndex:o,lastBin:s}=i,u=e===""?Oe.groupByCaseBegin:e;return u=pe(Oi,{groupByFieldsForStatistics:u,dateField:t,startDate:`${r}`,endDate:`${n}`,y:[a].flat()[0],binIndex:`${o}`,endDateOperand:s?"<=":"<"}),u}function*Ga(i){let{queryObject:e,seriesConfig:t,queryConfig:r,completeData:n}=i;for(let a=0;a<t.length;a+=1){let o=t[a],{query:s,x:u,y:l}=o,c=[{onStatisticField:s?.outStatistics?.[0]?.onStatisticField??"",outStatisticFieldName:T.ContinuousPercentile,statisticType:T.ContinuousPercentile,statisticParameters:{value:.5}}],d=Oe.groupByCaseBegin;for(let m=0;m<n.length;m+=1){let g=n[m],[y,h]=g[b.dateBinningRange],F=We(y),S=We(h);d=Ha({groupByFieldsForStatistics:d,queryStartDate:F,queryEndDate:S,dateField:u,y:[l].flat()[0],binIndex:m,lastBin:m===n.length-1})}d=`${d} ${Oe.groupByCaseEnd}`;let f={...r,groupByFieldsForStatistics:[d],outStatistics:c,orderByFields:void 0};yield ce({queryObject:e,queryConfig:f,noBatch:!0})}}async function za(i){let{queryObject:e,data:t,seriesConfig:r,queryConfig:n}=i,a=t,{statisticType:o}=r[0].query?.outStatistics?.[0]??Ft;if(o===T.ContinuousPercentile&&a.length>0){let s=Ga({queryObject:e,completeData:a,seriesConfig:r,queryConfig:n}),u=(await Promise.all(s)).flat();if(u.length>0){let{isInItem:l,expr:c}=Je(u[0].attributes);l&&u.forEach(d=>{let f=d.attributes[`${c}`];if(f!==void 0){let[m,g]=f.split("|");if(g!==void 0){let y=d.attributes[T.ContinuousPercentile];a[g][`${m}`]=y}}})}}return a}async function Ja(i){let{chartConfig:e,queryResults:t,mapToStatField:r,splitByField:n,x:a,y:o,nullPolicy:s,queryObject:u}=i,l=wi(a),c=(await Be(u)).find(y=>y.name===a)?.type,d=[],f=e.series[0],m="temporalBinning"in f?f.temporalBinning?.trimIncompleteTimeInterval:!1,g="temporalBinning"in f?f.temporalBinning?.timeAggregationType:!1;return t.forEach((y,h)=>{if(!(m&&(h===0&&g===Q.End||h===t.length-1&&g===Q.Start))){let{attributes:F,stackedAttributes:S}=y,C=F[l.lowerBoundaryAlias],x=F[l.upperBoundaryAlias],B=C,M=x,w=(N,P)=>{let L=N;if(P===Ve.DateOnly&&(typeof N=="string"&&N.length===10||typeof N=="number"))if(typeof N=="string"){let E=N.split("-");E.length===3&&(L=ae.local(Number(E[0]),Number(E[1]),Number(E[2])).valueOf())}else L=new Date(N),L=new Date(L.valueOf()+L.getTimezoneOffset()*6e4),L=ae.local(L.getFullYear(),L.getMonth()+1,L.getDate()).valueOf();else typeof N=="string"&&["+","-"].forEach(E=>{E&&N.lastIndexOf(E)===N.length-6&&(L=new Date(N.slice(0,N.lastIndexOf(E))).valueOf())});return L};C=w(C,c),x=w(x,c);let A=(N,P)=>{if(P)switch(!0){case(s===ie.Zero&&(N[P]===void 0||N[P]===null)):N[P]=0;break;case s===ie.Null:break;case(s===ie.Interpolate&&(N[P]===void 0||N[P]===null)):delete N[P];break}};if(typeof C=="number"&&typeof x=="number"){let N={...F};N[b.originalServerBinningRange]=[B,M],N[a]=C,N[b.xAxisField]=C,N[b.dateBinningRange]=[C,x],delete N[l.lowerBoundaryAlias],delete N[l.upperBoundaryAlias],S&&n&&!X(n)&&r?S.forEach(E=>{let _=E[n];if(_===null||typeof _=="string"||typeof _=="number"){let q=r?.get(_);q!==void 0&&(N[q]=E[G.outStatistics?.outStatisticFieldName??""],A(N,q))}}):A(N,o);let{featureExtent:P,featureExtentKey:L}=br({feature:y,splitByField:n});P&&(N[L]=P),d.push(N)}}}),d}async function Ua(i){let{queryObject:e,queryResults:t,x:r,queryConfig:n,seriesConfig:a,dateRange:o,timeIntervalInfo:s}=i,u=t,{dateMinTimestamp:l,dateMaxTimestamp:c}=o;if(l&&c){let d=t.length;if(Ye({arrayToSort:u,sortingField:r}),d>1){let{numberOfFinalBinsWithinDataRange:f,numberOfSingleBinsWithinDataRange:m}=pr({dateMinTimestamp:l,dateMaxTimestamp:c,timeIntervalInfo:s}),{newDateMin:g,newDateMax:y}=Ra({dateMaxTimestamp:c,data:u,numberOfFinalBinsWithinDataRange:f,numberOfSingleBinsWithinDataRange:m,seriesConfig:a,timeIntervalInfo:s});u=Wa({newDateMin:g,newDateMax:y,seriesConfig:a,data:u,initialNumberOfBins:d,numberOfSingleBinsWithinDataRange:m,timeIntervalInfo:s}),Ye({arrayToSort:u,sortingField:r}),u=ka({data:u,seriesConfig:a,dateMinTimestamp:l,dateMaxTimestamp:c,timeIntervalInfo:s}),u=Qa({data:u,seriesConfig:a,dateMinTimestamp:l,dateMaxTimestamp:c}),u=await za({queryObject:e,data:u,seriesConfig:a,queryConfig:n})}}return u}function Za(i){return Math.floor(Math.min(Math.max(8,Math.sqrt(i??8)),128)+.5)}function Ya(i){let{dateRange:e,numberOfFeatures:t}=i,r,n,{dateMinTimestamp:a,dateMaxTimestamp:o}=e;if(a&&o){typeof a=="string"&&(a=new Date(a).valueOf()),typeof o=="string"&&(o=new Date(o).valueOf());let s=Za(t),u=(o-a)/s,l=jt.findIndex(F=>F.threshold>u),c=jt[l],{unitMs:d,preferredIntervalSize:f}=c;({unit:r}=c);let m=u/d,g=f.findIndex(F=>F>=m),y=f[g],h=g===0?f[0]:f[g-1];n=y-m<m-h?y:h}return{size:n,unit:r}}function Xa(i){let{series:e,isTimeBinningSeries:t,setTimeBinningInfoWhenNotProvided:r}=i,n=!1;if(oe(e)&&t){let{unit:a,size:o}=e.temporalBinning??{};n=!kt(a,o)&&r===!0}return n}function eo(i){let e=[];for(let t=1;t<=6;t+=1){let r=i[`EXPR_${t}`]??i[`Expr${t}`]??i[`expr${t}`]??i[`EXPR${t}`];r!==null&&e.push(r)}return ae.local(Number(e[0]??1969),Number(e[1]??1),Number(e[2]??1),Number(e[3]??0),Number(e[4]??0),Number(e[5]??0)).valueOf()}function br(i){let{feature:e,splitByField:t,chartSubType:r}=i,n;e.aggregateGeometries&&"Extent"in e.aggregateGeometries?n=e.aggregateGeometries.Extent:{extent:n}=e.aggregateGeometries??e.geometry??{};let a=n?.toJSON(),o=Ce;return a!==void 0&&t!==void 0&&r!==void 0&&r===p.BarAndLineSplitBy&&(o=e.attributes[t]!==void 0?`${Ce}_${e.attributes[t]}`:Ce),{featureExtent:a,featureExtentKey:o}}function to(i){let{input:e,x:t,splitByField:r}=i;return e.reduce((n,a)=>(r!==void 0&&r!==t&&!(b.technicalFieldSplitByField in a)&&delete a[r],Object.assign(n,a)),{})}function zt(i){let{data:e,x:t,splitByField:r}=i,n=e;return e!==void 0&&e.length>0&&(n=[...ii(e,a=>to({input:a,x:t,splitByField:r}),a=>a[t]).values()]),n}function io(i,e){let t=i,r=R(e);if(r!==v.PieSeries&&r!==v.BoxPlotSeries){let n=se(e),a=e[0].y;i.forEach(o=>{let s=0;if(n.forEach(u=>{let l=o[u];Number.isFinite(l)&&(s+=l)}),o[b.technicalSortingFieldBySum]=s,Number.isFinite(s)&&s>0){let u=o[a];if(Number.isFinite(u)){let l=u/s;o[b.technicalSortingFieldByPercent]=l}}})}return t}function ro(i,e){let t=e,r=se(i),n=r.length===1;return r.forEach(a=>{let o=je(n?void 0:a),s=t[o[D.FirstQuartile]],u=t[o[D.ThirdQuartile]];Number.isFinite(s)&&Number.isFinite(u)&&u>=s&&(t[o[D.IQR]]=u-s)}),t}function no(i,e){let t=e.series[0],r=i;if(t.type===v.HeatSeries){let{x:n,y:a}=t;r[j.xField]=r[n]?.toString(),delete r[n],r[j.yField]=r[a]?.toString(),delete r[a];let o=t.query?.outStatistics?.[0]?.outStatisticFieldName;o&&(r[j.valueField]=r[o],delete r[o])}return r}function Jt(i,e){[e].flat().forEach(t=>{t&&(i[t]===void 0&&(i[t]=i[t.toUpperCase()]!==void 0?i[t.toUpperCase()]:i[t.toLowerCase()]),i[t]!==void 0?(t!==t.toUpperCase()&&delete i[t.toUpperCase()],t!==t.toLowerCase()&&delete i[t.toLowerCase()]):delete i[t])})}function ao(i,e){let t=Array.from(new Set(e.flatMap(r=>r.query?.outStatistics?.map(n=>n.outStatisticFieldName))));t.push(G.outStatistics.outStatisticFieldName),Jt(i,t)}function oo(i,e){let t={...i};return i!==void 0&&e[0]!==void 0&&(t=Object.keys(i).reduce((r,n)=>{let a=e.find(o=>o.outStatisticFieldName?.toLowerCase()===n.toLowerCase())?.onStatisticField;return a!==void 0&&i[n]!==void 0&&a!==n?r[a]=i[n]:r[n]=i[n],r},{})),t}function so(i){let{dataItem:e,splitByField:t,y:r}=i;if(e!==void 0&&!X(t)&&!X(r)){let n=e[t],a=`${r}_${n?.toString()}`;e[a]=e[r],delete e[r]}}function lo(i,e){Object.keys(i).forEach(t=>{if(t.startsWith(`${e}_`)){let r=t.slice(e.length+1);i[r]=i[t],delete i[t]}})}function uo(i,e){let t=1;switch(i){case p.BarAndLineFromFields:case p.PieFromFields:t=e.series[0].query?.outStatistics?.length??1;break;case p.BoxPlotMultiFields:case p.BoxPlotMultiFieldsAndSplitBy:t=e.series[0].y.length;break;case p.BarAndLineNoAggregation:case p.BoxPlotMonoField:case p.BoxPlotMonoFieldAndCategory:case p.BoxPlotMultiFieldsAndCategory:case p.BoxPlotMonoFieldAndSplitBy:case p.BoxPlotMonoFieldAndCategoryAndSplitBy:case p.PieFromCategory:case p.BarAndLineSplitByNoAggregation:case p.PieNoAggregation:case p.BarAndLineSplitBy:case p.BarAndLineMonoField:case p.BarAndLineMultiFields:case p.NonSpecific:}return t}function co(i){let{attributes:e,showMean:t,chartSubType:r}=i;t&&(r===p.BoxPlotMonoFieldAndSplitBy||r===p.BoxPlotMultiFieldsAndSplitBy||r===p.BoxPlotMonoFieldAndCategoryAndSplitBy)&&(e[b.boxPlot.boxPlotMeanLineMarkerId]=!0)}function fo(i){let{queryResponse:e,chartConfig:t,maxCategoryCount:r}=i,n=I(t.series);return r&&Number.isFinite(r)&&r<e.length&&yr.includes(n)?e.slice(0,r):e}function mo(i){let{attributes:e,uniqueCategoryList:t,maxCategoryCount:r,x:n,chartSubType:a}=i,o=!1;if(n&&r&&Number.isFinite(r)&&!yr.includes(a))if((a===p.BarAndLineFromFields||a===p.PieFromFields)&&Object.keys(e).length>r)Object.keys(e).filter(s=>s!==T.EnvelopeAggregate).forEach((s,u)=>{u>=r&&delete e[s]});else{let s=e[n];s!==void 0&&(t.size===r&&!t.has(s)?o=!0:t.add(s))}return o}function Sr(i){let{queryResponse:e,chartConfig:t,mapToStatField:r,splitByField:n,fieldOID:a,isDateField:o,isTimeBinningSeries:s,subtypeInfo:u,resultLimit:l,showMean:c,chartLimits:d,fieldList:f}=i,{series:m}=t,g=I(m),y=R(m),{x:h}=m[0],F="y"in m[0]?m[0].y:void 0,S=m[0].query?.outStatistics??[],{originalCategoryValue:C,originalDateValue:x,typeOrDomainFieldName:B,typeOrDomainIdValue:M}=b,w=[],A=0,N=new Set,{maxCategoryCount:P}=Pe(d),L=fo({queryResponse:e,chartConfig:t,maxCategoryCount:P});for(let E=0;L[E]&&E<L.length&&!(l!==void 0&&A>=l);E+=1){A+=uo(g,t);let _=L[E],q={..._.attributes};if(mo({attributes:q,uniqueCategoryList:N,maxCategoryCount:P,x:h,chartSubType:g}))continue;ao(q,m),g===p.PieFromFields||g===p.BarAndLineFromFields?q=oo(q,S):typeof F=="string"&&g===p.BarAndLineSplitByNoAggregation?so({dataItem:q,splitByField:n,y:F}):F&&(g===p.BoxPlotMonoField||g===p.BoxPlotMonoFieldAndCategory||g===p.BoxPlotMonoFieldAndSplitBy||g===p.BoxPlotMonoFieldAndCategoryAndSplitBy)&&lo(q,typeof F=="string"?F:F[0]),co({attributes:q,showMean:c,chartSubType:g});let $=q[h];$===null&&m[0]?.query?.fetchNullValues===!0&&g!==p.PieFromFields&&(q[C]=null,$=b.nullValue),o&&typeof $=="string"?$=new Date($).valueOf():s&&($=eo(q));let{outStatisticFieldName:O}=G.outStatistics??{},{featureExtent:Z,featureExtentKey:ee}=br({feature:_,splitByField:n,chartSubType:g});if(Z&&(q[ee]=Z),g===p.BarAndLineSplitBy&&O!==void 0){let me=q[n],te=r?.get(me);te!==void 0&&(me===n&&(q[b.technicalFieldSplitByField]=q[te]),q[te]=q[O]),delete q[O]}else(g===p.PieNoAggregation||g===p.BarAndLineNoAggregation||g===p.BarAndLineSplitByNoAggregation)&&(o?q[x]=$:$!==b.nullValue&&(q[C]=$),_r({isXAxis:!0,chartType:y,valueFormat:t.axes?.[0]?.valueFormat})&&(q[b.xAxisField]=`${$}-${E}`),q[G.uniqueIdsName]=q[a]);let Y=Pi({subtypeInfo:u,fieldList:f,fieldName:h,fieldValueToMatch:$});Y!==void 0&&Y!==$&&g!==p.PieFromFields&&(q[C]=Y,q[B]=h,q[M]=$),y===v.BoxPlotSeries&&(q=ro(m,q)),y===v.PieSeries&&typeof $=="number"&&(q[C]===void 0&&(q[C]=q[h]),$=`${$}`),$!==void 0&&(q[C]===void 0&&(q[C]=q[h]),q[h]=Y??$,q[h]===null&&(q[h]=b.nullValue),q[b.xAxisField]===void 0&&(q[b.xAxisField]=q[M]??q[h])),q=no(q,t),w.push(q)}return w}async function vt(i){let{queryObject:e,uniqueQuery:t,chartConfig:r,mapToStatField:n,abortKey:a,elementCount:o,isTimeBinningSeries:s,showMean:u,chartLimits:l,usePopupTemplateFieldsInfo:c}=i,{series:d}=r,f=I(d),m=[],g=f===p.BarAndLineSplitBy||f===p.BarAndLineSplitByNoAggregation?J(d[0].query?.where):"",y=await ce({queryObject:e,queryConfig:t,featureCount:o,abortKey:a}),h=await Be(e,c),F=W(e).objectIdField,S=qi(h),{x:C}=d[0],x=S.includes(C),B=Dt(e);return m=Sr({queryResponse:y,chartConfig:r,mapToStatField:n,splitByField:g,fieldOID:F,isDateField:x,isTimeBinningSeries:s,subtypeInfo:B,fieldList:h,resultLimit:t.num,showMean:u,chartLimits:l}),f!==p.BarAndLineSplitByNoAggregation&&f!==p.BarAndLineFromFields&&(g!==""&&(m=zt({data:m,x:C,splitByField:g})),m=io(m,d)),m}async function Fr(i){let{chartConfig:e,queryObject:t,queryConfig:r,numberMaxOfFeaturesToFetch:n,behaviorAfterLimit:a,isGaugeByFeature:o}=i,{series:s}=e,u=I(s),{x:l}=s[0],c=s.length,d,f;if(u===p.BoxPlotMonoField||u===p.BoxPlotMonoFieldAndSplitBy?(f=c,d=f):u===p.BoxPlotMultiFields||u===p.BoxPlotMultiFieldsAndSplitBy?(f=e.series[0].y.length,d=f):u===p.PieFromFields||u===p.BarAndLineFromFields?(f=s[0].query?.outStatistics?.filter(m=>m.statisticType!==T.EnvelopeAggregate).length??0,d=f):d=await xi({queryObject:t,x:l,chartSubType:u,queryConfig:r,isGaugeByFeature:o}),d!==void 0){let m=u===p.BoxPlotMonoField||u===p.BoxPlotMonoFieldAndCategory||u===p.BoxPlotMonoFieldAndSplitBy;f=Rt(u)&&!m?d*c:d}return a===qe.RenderUpToTheLimit&&f!==void 0&&n!==void 0&&n<f&&(f=n,d=Math.ceil(f/c)),{categoryOrDateCount:d,elementCount:f}}function Xe(i){let{arrayToSort:e,chartConfig:t,fieldList:r,isTimeBinningSeries:n}=i;if(n!==!0){let{series:a}=t,o=I(a),s=R(a),u=be(t),l=Kt(t);if(s===v.HeatSeries)l!==void 0&&Ye({arrayToSort:e,orderBy:l.orderBy,sortingField:l.sortingField});else if(l!==void 0&&e!==void 0&&e.length>1){let{orderBy:c}=l,{sortingField:d}=l,f=t.orderOptions?.data?.orderType===Fe.Category,m=l.preferLabel!==!1,g=o===p.BarAndLineFromFields||o===p.PieFromFields||o===p.BoxPlotMultiFields||o===p.BoxPlotMultiFieldsAndSplitBy,y=g||s===v.PieSeries,h=o===p.PieNoAggregation||o===p.BarAndLineNoAggregation||o===p.BarAndLineSplitByNoAggregation,F=g?!1:e?.length>0&&e.some(S=>Object.hasOwn(S,b.typeOrDomainIdValue));if(f&&(!m||s===v.LineSeries&&u===v.NumberAxisFormat)&&(F?d=b.typeOrDomainIdValue:y&&(d=b.originalCategoryValue)),Array.isArray(c))Jr({arrayToSort:e,orderBy:c,sortingField:d,fieldList:r,isByFieldsChart:g,preferLabel:m});else{let S=u===v.DateAxisFormat&&f;Ye({arrayToSort:e,orderBy:c,sortingField:d,forceAscendingOrder:S,isNonAggregated:h,sortByCategory:f,preferLabel:m,isPieOrByFieldsChart:y})}}}}async function Qt(i){let{chartConfig:e,queryConfig:t,fetchFullBoxPlotData:r,options:n,queryObject:a,abortKey:o,fieldList:s}=i,u="showMean"in e&&typeof e.showMean=="boolean"?e.showMean:!1,{chartLimits:l,usePopupTemplateFieldsInfo:c}=n??{},d=n?.replaceNoValueCategoryWithZero??b.options.replaceNoValueCategoryWithZero,{behaviorAfterLimit:f}=l??{},m={valid:!0},g,y=!1,h=e.series,F=h[0],S=I(e.series);if(F!==void 0&&a!==void 0){let C=R(h),{uniqueQuery:x,mapToStatField:B}=await pt({chartConfig:e,queryObject:a,queryConfig:t,fetchFullBoxPlotData:r,options:n}),{categoryOrDateCount:M,elementCount:w}=await Fr({chartConfig:e,queryObject:a,queryConfig:t,behaviorAfterLimit:f,numberMaxOfFeaturesToFetch:x.num}),A=!Number.isFinite(w),N=A||ye({count:w??0,seriesCount:h.length,chartType:C,chartLimits:l});if(N&&(g=await vt({queryObject:a,uniqueQuery:x,chartConfig:e,mapToStatField:B,elementCount:w,isTimeBinningSeries:!1,showMean:u,chartLimits:l,usePopupTemplateFieldsInfo:c,abortKey:o}),C===v.BoxPlotSeries&&(m.data=await In({data:g,queryObject:a,fetchFullBoxPlotData:r,uniqueQuery:x,chartConfig:e,elementCount:w,chartLimits:l,abortKey:o}),l?.maxBoxPlotOutlierLimit!==void 0&&(N=(m.data.outliers??[]).length<=l.maxBoxPlotOutlierLimit,y=!N)),A&&(M=g.length,w=Rt(S)?M*h.length:M,N=ye({count:w,seriesCount:h.length,chartType:C,chartLimits:l})),N)){if(C===v.PieSeries){S===p.PieFromFields&&(g=yt({dataToConvert:g[0],x:ne,y:ge,fieldList:s}));let P="";S===p.PieFromFields?P=ge:"y"in F&&typeof F.y=="string"&&(P=F.y),fn(g,P)?m.data={dataItems:g}:Fn(m,V.PieChartMixOfNegativePositiveSlices)}else if((C===v.RadarSeries||C===v.BarSeries||C===v.LineSeries||C===v.ComboLineAndBarSeries)&&(S===p.BarAndLineFromFields&&"y"in F&&typeof F.y=="string"?g=yt({dataToConvert:g[0],x:F.x,y:F.y,fieldList:s}):g=await Ia({queryObject:a,seriesData:g,chartConfig:e,queryConfig:t,categoryOrDateCount:M,behaviorAfterLimit:f,abortKey:o}),w=Rt(S)?g.length*h.length:g.length,N=ye({count:w,seriesCount:h.length,chartType:C,chartLimits:l}),N)){d&&(g=Ea(g,e)),Xe({arrayToSort:g,chartConfig:e,fieldList:s});let P={};if(oe(F)){let{size:L,unit:E}=F.temporalBinning??{};L!==void 0&&E!==void 0&&(P={size:L,unit:E})}m.data={dataItems:g,timeIntervalInfo:P}}}N||ht({dataInfo:m,chartType:C,subError:{outlierLimit:y}}),m.count=w}return m}function go(i){let e,{start:t,end:r}=Et({field:"",unit:i,addIntervalStatement:!1});return r&&(e=Array.from({length:r+(t===0?1:0)},(n,a)=>(a+(t??1)).toString())),e}async function Cr(i){let{chartConfig:e,queryConfig:t,queryObject:r,completeHeatChartDataset:n=!0,errorStrings:a,options:o,abortKey:s}=i,u={valid:!0},l,c=e.series[0],{nullPolicy:d}="nullPolicy"in e?e:{};if(c.type===v.HeatSeries){let{x:f,y:m,query:g,yTemporalBinning:y}=c,h=g?.outStatistics?.[0]?.outStatisticFieldName??"";if(rr(e)){let F=await Fi({chartConfig:e,queryObject:r,queryConfig:t,returnFeaturesExtent:o?.returnFeaturesExtent,errorStrings:a,abortKey:s});if(!ye({count:F?.length??0,seriesCount:1,chartType:v.HeatSeries,chartLimits:o?.chartLimits}))ht({dataInfo:u,chartType:v.HeatSeries});else if(typeof F?.[0]=="object"){let S=await Be(r,o?.usePopupTemplateFieldsInfo),C=Dt(r);l=Sr({queryResponse:F,chartConfig:e,splitByField:"",fieldOID:W(r).objectIdField,isDateField:!1,isTimeBinningSeries:!1,chartLimits:o?.chartLimits,resultLimit:t.num,subtypeInfo:C,fieldList:S});let x=await dt({queryObject:r,queryConfig:t,category:f,abortKey:s}),B=await dt({queryObject:r,queryConfig:t,category:m,abortKey:s});if(l.length!==x?.length*B?.length){let M=x.flatMap(w=>B.map(A=>({[j.xField]:w,[j.yField]:A,[j.valueField]:d===ie.Zero?0:null})));l=[...l,...M.filter(w=>!l.some(A=>`${A[j.xField]}${A[j.yField]}`==`${w[j.xField]}${w[j.yField]}`))]}}}else{let F=await Si({chartConfig:e,queryObject:r,queryConfig:t,errorStrings:a}),S=y?go(y.unit):await dt({queryObject:r,queryConfig:t,category:m,abortKey:s}),C=0;l=F?.features.flatMap(x=>{let B=[],{attributes:M,stackedAttributes:w}=x,A=[];return w?.forEach(N=>{let P=`${N[m]}`;A.push(P),B.push({[j.xField]:`${M.lowerBoundary}`,[j.yField]:P,[j.valueField]:N[h]})}),n&&S&&A.length!==S?.length&&S.filter(N=>!A.includes(N.toString())).forEach(N=>{B.push({[j.xField]:`${M.lowerBoundary}`,[j.yField]:N,[j.valueField]:d===ie.Zero?0:null})}),C+=B.length,B}),ye({count:C,seriesCount:1,chartType:v.HeatSeries,chartLimits:o?.chartLimits})?l&&Xe({arrayToSort:l,chartConfig:e}):ht({dataInfo:u,chartType:v.HeatSeries})}}return l&&(u.data={dataItems:l}),u}function yo(i){let{chartConfig:e,options:t,data:r}=i,n=e.series,a=r,o=ir(e,t?.chartLimits);if(o!==void 0){let s=se(n);if(s.length===1)a=r.filter(u=>Number.isFinite(u[s[0]])).slice(0,o);else if(r.length*s.length>o){let u=[],l=0,c=0;for(;l<=o&&c<r.length;){let d=r[c];if(u.push(d),l+=s.filter(f=>Number.isFinite(d[f])).length,l>o){let f=l-o,m=s.length-1;for(;f!==0&&m>=0;){let g=s[m];Number.isFinite(d[g])&&(delete d[g],f-=1),m-=1}}c+=1}a=u}}return a}async function Ut(i){let{chartConfig:e,queryConfig:t,queryObject:r,abortKey:n,binnedServerData:a,options:o}=i,{chartLimits:s,usePopupTemplateFieldsInfo:u}=o??{},{behaviorAfterLimit:l}=s??{},c=e.series,d=c[0],{x:f}=d,m=J(d.query?.where),g={valid:!0},y;if(oe(d)){let{temporalBinning:h}=d;if(r&&h){let{unit:F,size:S}=h,C=1,x={unit:F,size:S},B=!1,M=Xa({series:d,isTimeBinningSeries:!0,setTimeBinningInfoWhenNotProvided:o?.setTimeBinningInfoWhenNotProvided}),w=a?.timeBinningStats;!w&&(!ke(r)||M)&&(w=await Ka({queryObject:r,queryConfig:t,x:f})),M&&w&&w.numberOfFeatures>0&&w.dateRange.dateMaxTimestamp!==void 0&&w.dateRange.dateMinTimestamp!==void 0&&(x=Ya(w),(await Be(r)).find(L=>L.name===f)?.type===Ve.DateOnly&&x.unit!==void 0&&[k.Hour,k.Minute,k.Second].includes(x.unit)&&(x.unit=k.Day,x.size=1),h.size=x.size,h.unit=x.unit);let{uniqueQuery:A,mapToStatField:N}=await pt({chartConfig:e,queryConfig:t,queryObject:r,timeIntervalInfo:x,options:o}),P=ye({count:C??0,seriesCount:c.length,chartType:v.LineSeries,chartLimits:s});if(P){if(ke(r)){let L=await It({queryObject:r,dateField:f,splitByField:m,queryConfig:A,temporalBinning:h}),E="y"in d&&typeof d.y=="string"?d.y:void 0;if(y=await Ja({chartConfig:e,queryResults:L,mapToStatField:N,splitByField:m,x:f,y:E,nullPolicy:h.nullPolicy,queryObject:r}),!ye({count:y.length,seriesCount:c.length,chartType:v.LineSeries,chartLimits:s})){let _=se(c),q=y.filter($=>_.some(O=>O in $&&Number.isFinite($[O]))).length;ye({count:q,seriesCount:c.length,chartType:v.LineSeries,chartLimits:s})||(P=!1)}}else if(w?.dateRange.dateMinTimestamp&&w.dateRange.dateMaxTimestamp){let{numberOfFinalBinsWithinDataRange:L}=pr({dateMinTimestamp:w.dateRange.dateMinTimestamp,dateMaxTimestamp:w.dateRange.dateMaxTimestamp,timeIntervalInfo:x});C=L*c.length,C=hr(C,x.unit),y=a?.data??await vt({queryObject:r,uniqueQuery:A,chartConfig:e,mapToStatField:N,elementCount:C,chartLimits:s,isTimeBinningSeries:!0,usePopupTemplateFieldsInfo:u,abortKey:n}),g.binnedServerData={data:Se(y),timeBinningStats:w},y=await Ua({queryObject:r,queryConfig:t,queryResults:y,x:f,seriesConfig:c,dateRange:w.dateRange,timeIntervalInfo:x})}gi(r)&&y&&y?.length===Da&&(B=!0),l===qe.RenderUpToTheLimit&&y&&(y=yo({chartConfig:e,options:o,data:y}))}P||(g.valid=!1,g.invalidType=V.LineChartExceedsLimit),y&&y.length>0&&(y[y.length-1][b.lastTemporalBin]=!0),g.data={dataItems:y,timeIntervalInfo:x,serverLimitReached:B},g.count=C}}return g}async function ho(i){let{chartConfig:e,queryConfig:t,queryObject:r,abortKey:n,options:a}=i,o=Ue(e),{setTimeBinningInfoWhenNotProvided:s,chartLimits:u,usePopupTemplateFieldsInfo:l}=a??{},c={valid:!0};if(r!==void 0){let d=e.series,f=xe({seriesConfig:d[0],xAxisValueFormatType:be(e),setTimeBinningInfoWhenNotProvided:s}),{uniqueQuery:m,mapToStatField:g}=await pt({chartConfig:e,queryObject:r,queryConfig:t,fetchFullBoxPlotData:!o,options:a}),y=await vt({queryObject:r,uniqueQuery:m,elementCount:1,chartConfig:e,mapToStatField:g,isTimeBinningSeries:f,showMean:o,chartLimits:u,usePopupTemplateFieldsInfo:l,abortKey:n});R(e.series)===v.BoxPlotSeries&&(y=ar({chartConfig:e,data:y,calculateZScore:!1})),c.data={dataItems:y}}return c}async function po(i){let{chartConfig:e,queryConfig:t,queryObject:r,abortKey:n,options:a,errorStrings:o}=i,s="showMean"in e?e.showMean:!1,u=await Gt({queryObject:r,chartConfig:e,queryConfig:t,options:a,errorStrings:o,abortKey:n});return s&&u.data&&"dataItems"in u.data&&"meanLines"in u.data&&u.data.meanLines&&(u.data.dataItems=[...u.data.dataItems,...u.data.meanLines]),u}function xr(i){return i?.[ze.defaultGroupOfSlicesId]===!0}function ol(i,e){let t=i.filter(r=>!xr(r));return!Ne(t,e)}function vo(i,e){let t=i.reduce((r,n)=>{if(n[ze.defaultGroupOfSlicesId]===!0){let a=n[b.pieChart.technicalFieldGroupedSlices];a!==void 0&&a.forEach(o=>{r.push(o)})}else r.push(n);return r},[]);return Xe({arrayToSort:t,chartConfig:e}),t=Xi({data:{dataItems:t},seriesConfig:e.series})?.dataItems??[],t}function bo(i){let{stringToTruncate:e,characterLimit:t,ellipsis:r=b.chartEllipsis}=i,n=e;return typeof t=="number"&&Number.isFinite(t)&&t>0&&t<e.length&&(n=e.slice(0,t),n=`${n}${r}`),n}function sl(i,e=":"){return i?`\u200F${e}`:`\u200E${e}`}function ll(i){return e=>{let t=typeof e!="string"?e?.toString()??"":e;return!X(t)&&t!==b.htmlEmptyContent&&(t=bo({stringToTruncate:t,characterLimit:i})),t}}function So(i){let e=/[[]/gu,t=/[\]]/gu,r=/[{]/gu,n=/[}]/gu,a=/[']/gu;return i=i.replace(e,"[["),i=i.replace(t,"]]"),i=i.replace(r,"{{"),i=i.replace(n,"}}"),i=i.replace(a,"''"),i}function Fo(i,e){let t="";return i!==void 0&&(t=`${e==="amChartsV5"?"fontStyle":"font-style"}:${i};`),t}function Co(i,e){let t="";return i===!0&&(t=`${e==="amChartsV5"?"letterSpacing":"letter-spacing"}:1px;`),t}function ul(i){let{textSymbol:e,placeholderString:t,format:r,axisLabelsBehavior:n,defaults:a}=i,o=Fo(e?.font?.style,r),s=Co(e?.kerning,r),u=t??e?.text??"";if(r==="html"){let{wrap:l,maxWidth:c}=a??{};n===Xt.Wrap&&(l=!0,c=c??b.xAxisLabelMaxWidth);let d=l===!0&&Number.isFinite(c)?`max-width: ${c}px; word-break: break-word;`:"";u=`<p style="margin:0;${o}${s}${d}">${u}</p>`}else u=So(u),(o!==""||s!=="")&&(u=`[${o}${s}]${u}[/]`);return u}function xo(i){return i?i.replace(/[A-Z]/gu,e=>`-${e.toLowerCase()}`):void 0}var Ke={ChartRenderer:1,LayerRenderer:2};function cl(i){let{chartConfig:e,queryObject:t}=i,r=!1;if(e.chartRenderer)r=!0;else{let{series:n}=e,a=R(n),o=I(n),s=we(e),u=xe({seriesConfig:s}),l=W(t)?.renderer;switch(l?.type){case re.Simple:r=a===v.HistogramSeries||a===v.ScatterSeries||o===p.BarAndLineMonoField||o===p.BoxPlotMonoField||o===p.BoxPlotMultiFields||o===p.BoxPlotMonoFieldAndCategory||o===p.BarAndLineNoAggregation&&n.length===1&&!u;break;case re.UniqueValue:{let c=l?.field,d=J(s.query?.where),{x:f}=s;r=(o===p.BoxPlotMonoFieldAndSplitBy||o===p.BoxPlotMultiFieldsAndSplitBy||o===p.BoxPlotMonoFieldAndCategoryAndSplitBy||o===p.BarAndLineSplitByNoAggregation||o===p.BarAndLineSplitBy)&&c===d||(o===p.BoxPlotMonoFieldAndCategory||o===p.PieFromCategory||o===p.BarAndLineMonoField)&&c===f||o===p.BarAndLineNoAggregation||o===p.PieNoAggregation||a===v.ScatterSeries}break;case re.PieChart:r=o===p.PieFromFields||o===p.BarAndLineFromFields||o===p.BarAndLineMultiFields||o===p.BarAndLineMonoField||o===p.BoxPlotMonoField||o===p.BoxPlotMultiFields||o===p.BoxPlotMonoFieldAndCategory||o===p.BoxPlotMultiFieldsAndCategory;break;case re.ClassBreaks:r=a===v.ScatterSeries||o===p.BarAndLineNoAggregation||o===p.PieNoAggregation;break;case re.Dictionary:case re.DotDensity:case re.Heatmap:break}}return r}function Bo(i,e){return xo(i?.type)??e?.type}function No(i){let e=b.rendererSymbolField,t=e in i?e:void 0;if(!t){let r=i[b.originalCategoryValue];t=Object.keys(i).find(n=>{let a=i[n];return n.includes(e)&&a?.label&&a?.uniqueValue===r}),t||(t=Object.keys(i).find(n=>n.includes(e))??"")}return i[t]?.label}function wo(i){return i?.type!==void 0&&(i.color!==void 0||i.label!==void 0||i.style!==void 0||i.outline!==void 0)}function Br(i){let{symbolField:e,dataItem:t,rendererSymbol:r,rendererOrigin:n}=i,a=!1;if(!wo(r))delete t[e];else{let o={...r};o.color!==void 0&&n===Ke.LayerRenderer&&(o.color[3]=Ct*255),n===Ke.LayerRenderer&&(delete o.style,delete o.outline,delete o.label),t[e]=o,a=!0}return a}function Mo(i){let{renderer:e,seriesConfig:t,chartSubType:r,dataItem:n,rendererOrigin:a}=i,o,s=!1,u=R(t),{outline:l,attributes:c}=e;return c.forEach(d=>{let{field:f}=d,{color:m,label:g}=d,y;Array.isArray(m)&&m?.length===4?y=m:m&&"toRgba"in m&&(y=m.toRgba());let h=!1,F=!0;switch(u){case v.BarSeries:case v.LineSeries:case v.ComboLineAndBarSeries:case v.RadarSeries:if(r!==p.BarAndLineFromFields){let S=t.find(C=>C.query?.outStatistics?.[0]?.onStatisticField===f);S!==void 0&&"y"in S?f=[S.y].flat()[0]:f=""}h=r!==p.BarAndLineFromFields||f===n[b.originalCategoryValue];break;case v.PieSeries:h=r===p.PieFromFields&&f===n[b.originalCategoryValue];break;case v.BoxPlotSeries:r===p.BoxPlotMonoField||r===p.BoxPlotMonoFieldAndCategory?h=f===t[0].y:f&&(r===p.BoxPlotMultiFields||r===p.BoxPlotMultiFieldsAndCategory)&&(h=t.map(S=>S.y).flat().includes(f)),F=!1;break}h&&y&&(o={type:Ge.SMS,color:y,label:F&&g?g:void 0},l!=null&&(o.outline=l),Br({dataItem:n,symbolField:r===p.BarAndLineFromFields||r===p.PieFromFields?b.rendererSymbolField:`${b.rendererSymbolField}_${f}`,rendererSymbol:o,rendererOrigin:a})&&(s=!0))}),{rendererSymbol:o,colorMatchApplied:s}}function Ao(i){let{seriesConfig:e,chartSubType:t,rendererType:r}=i,n=b.rendererSymbolField;if(r===re.UniqueValue){if(Tt(t)){let a=ue({where:e.query?.where,keepSurroundingQuotes:!1,escape:!1});a===null?n=b.nullValue:t===p.BarAndLineSplitBy&&typeof e.y=="string"?n=e.y:t===p.BarAndLineSplitByNoAggregation&&typeof e.y=="string"?n=`${e.y}_${a}`:n=`${a}`}}else if(r===re.PieChart)switch(t){case p.BoxPlotMultiFields:n=Array.isArray(e.y)?e.y.flat():e.y;break;case p.BarAndLineMonoField:case p.BarAndLineMultiFields:case p.BoxPlotMonoField:case p.BoxPlotMonoFieldAndCategory:case p.BoxPlotMultiFieldsAndCategory:n=e.y;break}return n}function Nr(i){let{seriesConfig:e,chartSubType:t,rendererType:r,dataItem:n}=i,a=Ao({seriesConfig:e,chartSubType:t,rendererType:r});return a instanceof Array&&e.type===v.BoxPlotSeries&&r===re.PieChart&&n!==void 0&&(a=a.find(o=>o===n[xt])??a[0]),a=a!==b.rendererSymbolField?`${b.rendererSymbolField}_${a.toString()}`:a,a}function To(i){let{chartRenderer:e,queryObject:t}=i,r=e!==void 0?{...W(t),renderer:Ji.fromJSON(e)}:W(t);return new Pr({layer:r})}async function qo(i){let{seriesConfig:e,dataItem:t,renderer:r,rendererType:n,rendererOrigin:a,chartSubType:o,splitByField:s,graphicTemplate:u,rendererFieldNames:l,mapAttributesToSymbol:c}=i,d,f=!1;if(n===re.PieChart){let m=Mo({renderer:r,seriesConfig:e,chartSubType:o,dataItem:t,rendererOrigin:a});d=m.rendererSymbol,f=m.colorMatchApplied}else if(!xr(t)){let{x:m}=e[0],g=new Map;s&&s.trim()!==""?e.forEach(y=>{if(y.type===v.BarSeries||y.type===v.LineSeries||y.type===v.BoxPlotSeries||y.type===v.RadarSeries){let h=Nr({seriesConfig:y,chartSubType:o,rendererType:n,dataItem:t}),F=ue({where:y.query?.where,normalize:!0,keepSurroundingQuotes:!1,escape:!1});g.set(h,{...t,[s]:F})}}):g.set(b.rendererSymbolField,{...t,[m]:zr(t)});try{let y=Array.from(g.entries()),h=u.clone();h.layer=u.layer;let F=r?.uniqueValueInfos;for(let S=0;S<y.length;S+=1){let[C,x]=y[S];if(zi({mode:"encode",x:m,splitByField:s,attributes:x}),l&&l.length>0&&Object.keys(x).forEach(B=>{l.includes(B)||delete x[B]}),h.attributes=x,c?.has(JSON.stringify(x)))d=c.get(JSON.stringify(x));else{if(d=(await He.getDisplayedSymbol(h))?.toJSON(),d!=null){d.color===void 0&&(d.color=(await He.getDisplayedColor(h))?.toJSON());let B=await He.getLegendLabel(h);B!=null&&B!==""&&(d.label=B,d.uniqueValue=F?.find(M=>M.label===B)?.value??void 0)}c?.set(JSON.stringify(x),d)}zi({mode:"revert",x:m,splitByField:s,attributes:t}),Br({dataItem:t,symbolField:C,rendererSymbol:d,rendererOrigin:a})&&(f=!0)}}catch{}}return{rendererSymbol:d,colorMatchApplied:f}}function Po(i){let e=i;return i?.type==="uniqueValue"&&(i.uniqueValueInfos=i.uniqueValueInfos.map(t=>{let r=t.value===null?b.nullValue:t.value;return{...t,value:r}})),e}function zi(i){let{splitByField:e,attributes:t,x:r,mode:n}=i;[r,e??""].forEach(a=>{t[a]===(n==="encode"?null:b.nullValue)&&(t[a]=n==="encode"?b.nullValue:null)})}async function dl(i){let{data:e,queryObject:t,chartConfig:r,allowColorMatch:n}=i,a=!1,o=[];if(n){let{series:s,chartRenderer:u}=r,l=Po(u),c=l?Ke.ChartRenderer:Ke.LayerRenderer,d=t?W(t):void 0,f=l??d?.renderer,m;d&&c===Ke.LayerRenderer?o=await Vt(d):c===Ke.ChartRenderer&&(o=Io(f));let g=Bo(l,d?.renderer),y=To({chartRenderer:u,queryObject:t}),h=I(s),F=we(r),S=J(F.query?.where);m=new Map;for(let C=0;C<e.length;C+=1){let x=e[C],B=await qo({seriesConfig:r.series,dataItem:x,renderer:f,rendererType:g,rendererOrigin:c,chartSubType:h,splitByField:S,graphicTemplate:y,mapAttributesToSymbol:m,rendererFieldNames:o});a=a||B.colorMatchApplied}}return{dataItems:e,colorMatchApplied:a,rendererFieldNames:o}}function Lo(i){let{dataItem:e,seriesConfig:t,chartSubType:r,colorMatch:n,rendererType:a}=i,o;if(n&&e!==void 0){let s=Nr({seriesConfig:t,chartSubType:r,rendererType:a,dataItem:e});o=e[s]}return o}function fl(i){let{seriesSymbol:e,rendererSymbol:t,colorIndex:r}=i,n=t?.color??e.color;n=n??Bt({colorIndex:r,opacity:Ct});let a={...e,color:n};return t?.type===e.type&&t.style!==void 0&&(a.style=t.style),a.type!==Ge.SLS&&(a.outline={type:Ge.SLS,style:t?.outline?.style??a.outline?.style,width:t?.outline?.width??a.outline?.width,color:t?.outline?.color??a.outline?.color??t?.color}),a}function Oo(i){let e=[];return i&&(e=i.series.flatMap(t=>t.query?.outStatistics?.map(r=>r.onStatisticField)).filter(t=>t!==void 0),e.length===0&&(e=se(i.series))),e}function ml(i,e){let t=!1;if(i&&e&&e.length>0&&Nt(i)){let r=Qr(i),n=we(i);r?t=Oo(i).some(a=>e.includes(a)):t=e.includes(n.x)}return t}function Io(i){let e=[];if(i&&"type"in i&&typeof i.type=="string")switch(i.type){case"uniqueValue":"field1"in i&&typeof i.field1=="string"&&(e=[i.field1]);break;case"classBreaks":"field"in i&&typeof i.field=="string"&&(e=[i.field]);break;case"pieChart":"attributes"in i&&Array.isArray(i.attributes)&&(e=i.attributes.map(t=>t.field));break}return e}function gl(i,e){let t;return e!==void 0&&(t={...e},t.legend!==void 0&&(t.legend.position=i)),t}function yl(i,e){let t;return e!==void 0&&(t={...e},t.legend!==void 0&&(t.legend.visible=i)),t}function hl(i){let e;return i!==void 0&&(e={...i},delete e.axes?.[0]?.minimum,delete e.axes?.[0]?.maximum,delete e.axes?.[1]?.minimum,delete e.axes?.[1]?.maximum),e}function pl(i,e){return e!=null||Ii(i)}async function Eo(i){let{queryObject:e,chartConfig:t,options:r,splitByField:n}=i,a=[],o=t.series[0],s=await Ei(t,e),u=$t({queryObject:e,chartConfig:s,runtimeDataFilters:r?.runtimeDataFilters,ignoreViewExtent:r?.ignoreViewExtent});if(u.outStatistics?.[0]?.outStatisticFieldName&&(u.outStatistics[0].outStatisticFieldName=G.outStatistics.outStatisticFieldName),oe(o)&&xe({xAxisValueFormatType:be(s),setTimeBinningInfoWhenNotProvided:r?.setTimeBinningInfoWhenNotProvided,seriesConfig:o})&&ke(e)){let{temporalBinning:l,x:c}=o,d=await It({queryObject:e,dateField:c,splitByField:n,queryConfig:u,temporalBinning:l});a=Array.from(new Set(d.flatMap(f=>{let{stackedAttributes:m}=f,g=[];return m&&(g=m.map(y=>y[n]).filter(y=>y!==void 0)),g})).values())}else{let{uniqueQuery:l}=await pt({chartConfig:s,queryObject:e,queryConfig:u,options:r}),c=await ce({queryObject:e,queryConfig:l,featureCount:1});a=Array.from(new Set(c.map(d=>d.attributes[n]).filter(d=>d!==void 0)).values())}return a}function Do(i,e){let t=new Map;return i.series.forEach(r=>{let n=ue({where:r.query?.where,normalize:!0,escape:!1});e&&n!==null&&(n=Number(n));let a=R([r]);a!==void 0&&t.set(a,[...t.get(a)??[],n])}),t}function Vo(i){let{allValues:e,configUniqueValuesPerSeriesType:t,initialConfigWasEmpty:r}=i,n=new Map;return Array.from(t.keys()).forEach(a=>{let o=t.get(a)??[],s=[];r?s=e:e.forEach(u=>{o.includes(u)||s.push(u)}),n.set(a,s)}),n}function $o(i){let{chartConfig:e,missingValue:t,splitByField:r,seriesTemplate:n}=i,a=JSON.parse(JSON.stringify({...e.series[0],...n}));if(a.query){if(a.id=`${t}-${e.series.length}-${Date.now()}`,a.name=`${t}`,a.query.outStatistics?.[0]!==void 0){let s=a.id;a.query.outStatistics[0].outStatisticFieldName=s,"y"in a&&(a.y=s)}let o=typeof t=="number"||t===null?t:`'${t}'`;a.query.where=`${r}=${o}`}return a}async function vl(i,e,t){let{updateSplitBySeries:r}=i,{seriesTemplate:n}=r??{};if(r!==void 0&&e!==void 0&&(e.series.length>0||n!==void 0)&&r.addMissingSeries){let a=e.series.length===0;e.series.length===0&&n!==void 0&&e.series.push(n);let o=I(e.series);if(o===p.BoxPlotMonoFieldAndSplitBy||o===p.BoxPlotMultiFieldsAndSplitBy||o===p.BoxPlotMonoFieldAndCategoryAndSplitBy||o===p.BarAndLineSplitBy||o===p.BarAndLineSplitByNoAggregation){let s=await Ti({chartConfig:e,layer:i.layer,view:i.view});if(s!==void 0){let u=J(e.series[0]?.query?.where),l=W(s);await l.load();let c=l.getField(u)?.toJSON(),d=_e(c),f=await Eo({queryObject:s,chartConfig:e,splitByField:u,options:t});if(f.length>0){let m=Do(e,d),g=Vo({allValues:f,configUniqueValuesPerSeriesType:m,initialConfigWasEmpty:a});Array.from(g.keys()).forEach(y=>{(g.get(y)??[]).forEach(h=>{e.series.push($o({chartConfig:e,seriesTemplate:n,missingValue:h,splitByField:u}))}),a&&e.series.shift()})}}}}}return{a:Or,b:be,c:ms,d:U,e:gs,f:ve,g:Le,h:ys,i:hs,j:_r,k:ps,l:Ui,m:vs,n:bs,o:Rt,p:Ue,q:Hr,r:Ss,s:Ze,t:zr,u:Xi,v:er,w:Xr,x:Fs,y:Cs,z:xs,A:Bs,B:Ns,C:ws,D:Ms,E:As,F:Qi,G:Ts,H:qs,I:Ps,J:Ls,K:Os,L:Is,M:Es,N:Ds,O:Vs,P:$s,Q:js,R:ks,S:Rs,T:_s,U:Ks,V:Ws,W:Qs,X:Hs,Y:Gs,Z:zs,_:Js,$:Us,aa:Zs,ba:Ys,ca:Xs,da:el,ea:Sn,fa:tl,ga:il,ha:ba,ia:rl,ja:Aa,ka:nl,la:al,ma:zt,na:Xe,oa:xr,pa:ol,qa:bo,ra:sl,sa:ll,ta:So,ua:ul,va:Ke,wa:cl,xa:Bo,ya:To,za:qo,Aa:dl,Ba:Lo,Ca:fl,Da:ml,Ea:gl,Fa:yl,Ga:hl,Ha:pl,Ia:vl}},"geometry/support/jsonUtils","rest/support/AttributeBinsQuery","rest/support/Query","rest/support/StatisticDefinition","time/TimeExtent","core/promiseUtils","request","renderers/support/jsonUtils","symbols/support/symbolUtils","Graphic","intl","layers/support/FeatureFilter","smartMapping/statistics/histogram","smartMapping/statistics/summaryStatistics",a,b,c,d,e)